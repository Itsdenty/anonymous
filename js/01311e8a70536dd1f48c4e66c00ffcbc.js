angular.module("rt.encodeuri",[]).filter("encodeUri",["$window",function(a){return a.encodeURIComponent}]);!function(a,b){return"function"==typeof define&&define.amd?void define("angular-file-upload",["angular"],function(a){return b(a)}):b(a)}("undefined"==typeof angular?null:angular,function(a){var b=a.module("angularFileUpload",[]);return b.value("fileUploaderOptions",{url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:!1,removeAfterUpload:!1,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:!1}).factory("FileUploader",["fileUploaderOptions","$rootScope","$http","$window","$compile",function(b,c,d,e,f){function g(c){var d=a.copy(b);a.extend(this,d,c,{isUploading:!1,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}}),this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter}),this.filters.unshift({name:"folder",fn:this._folderFilter})}function h(b){var c=a.isElement(b),d=c?b.value:b,e=a.isString(d)?"FakePath":"Object",f="_createFrom"+e;this[f](d)}function i(b,c,d){var e=a.isElement(c),f=e?a.element(c):null,h=e?null:c;a.extend(this,{url:b.url,alias:b.alias,headers:a.copy(b.headers),formData:a.copy(b.formData),removeAfterUpload:b.removeAfterUpload,withCredentials:b.withCredentials,method:b.method},d,{uploader:b,file:new g.FileLikeObject(c),isReady:!1,isUploading:!1,isUploaded:!1,isSuccess:!1,isCancel:!1,isError:!1,progress:0,index:null,_file:h,_input:f}),f&&this._replaceNode(f)}function j(b){a.extend(this,b),this.uploader._directives[this.prop].push(this),this._saveLinks(),this.bind()}function k(){k.super_.apply(this,arguments),this.uploader.isHTML5||this.element.removeAttr("multiple"),this.element.prop("value",null)}function l(){l.super_.apply(this,arguments)}function m(){m.super_.apply(this,arguments)}return g.prototype.isHTML5=!(!e.File||!e.FormData),g.prototype.addToQueue=function(b,c,d){var e=this.isArrayLikeObject(b)?b:[b],f=this._getFilters(d),h=this.queue.length,i=[];a.forEach(e,function(a){var b=new g.FileLikeObject(a);if(this._isValidFile(b,f,c)){var d=new g.FileItem(this,a,c);i.push(d),this.queue.push(d),this._onAfterAddingFile(d)}else{var e=this.filters[this._failFilterIndex];this._onWhenAddingFileFailed(b,e,c)}},this),this.queue.length!==h&&(this._onAfterAddingAll(i),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},g.prototype.removeFromQueue=function(a){var b=this.getIndexOfItem(a),c=this.queue[b];c.isUploading&&c.cancel(),this.queue.splice(b,1),c._destroy(),this.progress=this._getTotalProgress()},g.prototype.clearQueue=function(){for(;this.queue.length;)this.queue[0].remove();this.progress=0},g.prototype.uploadItem=function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhrTransport":"_iframeTransport";c._prepareToUploading(),this.isUploading||(this.isUploading=!0,this[d](c))},g.prototype.cancelItem=function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhr":"_form";c&&c.isUploading&&c[d].abort()},g.prototype.uploadAll=function(){var b=this.getNotUploadedItems().filter(function(a){return!a.isUploading});b.length&&(a.forEach(b,function(a){a._prepareToUploading()}),b[0].upload())},g.prototype.cancelAll=function(){var b=this.getNotUploadedItems();a.forEach(b,function(a){a.cancel()})},g.prototype.isFile=function(a){var b=e.File;return b&&a instanceof b},g.prototype.isFileLikeObject=function(a){return a instanceof g.FileLikeObject},g.prototype.isArrayLikeObject=function(b){return a.isObject(b)&&"length"in b},g.prototype.getIndexOfItem=function(b){return a.isNumber(b)?b:this.queue.indexOf(b)},g.prototype.getNotUploadedItems=function(){return this.queue.filter(function(a){return!a.isUploaded})},g.prototype.getReadyItems=function(){return this.queue.filter(function(a){return a.isReady&&!a.isUploading}).sort(function(a,b){return a.index-b.index})},g.prototype.destroy=function(){a.forEach(this._directives,function(b){a.forEach(this._directives[b],function(a){a.destroy()},this)},this)},g.prototype.onAfterAddingAll=function(){},g.prototype.onAfterAddingFile=function(){},g.prototype.onWhenAddingFileFailed=function(){},g.prototype.onBeforeUploadItem=function(){},g.prototype.onProgressItem=function(){},g.prototype.onProgressAll=function(){},g.prototype.onSuccessItem=function(){},g.prototype.onErrorItem=function(){},g.prototype.onCancelItem=function(){},g.prototype.onCompleteItem=function(){},g.prototype.onCompleteAll=function(){},g.prototype._getTotalProgress=function(a){if(this.removeAfterUpload)return a||0;var b=this.getNotUploadedItems().length,c=b?this.queue.length-b:this.queue.length,d=100/this.queue.length,e=(a||0)*d/100;return Math.round(c*d+e)},g.prototype._getFilters=function(b){if(a.isUndefined(b))return this.filters;if(a.isArray(b))return b;var c=b.match(/[^\s,]+/g);return this.filters.filter(function(a){return-1!==c.indexOf(a.name)},this)},g.prototype._render=function(){c.$$phase||c.$apply()},g.prototype._folderFilter=function(a){return!(!a.size&&!a.type)},g.prototype._queueLimitFilter=function(){return this.queue.length<this.queueLimit},g.prototype._isValidFile=function(a,b,c){return this._failFilterIndex=-1,b.length?b.every(function(b){return this._failFilterIndex++,b.fn.call(this,a,c)},this):!0},g.prototype._isSuccessCode=function(a){return a>=200&&300>a||304===a},g.prototype._transformResponse=function(b){return a.forEach(d.defaults.transformResponse,function(a){b=a(b)}),b},g.prototype._parseHeaders=function(b){function c(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function d(a){return a.toLowerCase()}var e,f,g,h={};return b?(a.forEach(b.split("\n"),function(a){g=a.indexOf(":"),e=d(c(a.substr(0,g))),f=c(a.substr(g+1)),e&&(h[e]=h[e]?h[e]+", "+f:f)}),h):h},g.prototype._xhrTransport=function(b){var c=b._xhr=new XMLHttpRequest,d=new FormData,e=this;e._onBeforeUploadItem(b),a.forEach(b.formData,function(b){a.forEach(b,function(a,b){d.append(b,a)})}),d.append(b.alias,b._file,b.file.name),c.upload.onprogress=function(a){var c=Math.round(a.lengthComputable?100*a.loaded/a.total:0);e._onProgressItem(b,c)},c.onload=function(){var a=e._parseHeaders(c.getAllResponseHeaders()),d=e._transformResponse(c.response),f=e._isSuccessCode(c.status)?"Success":"Error",g="_on"+f+"Item";e[g](b,d,c.status,a),e._onCompleteItem(b,d,c.status,a)},c.onerror=function(){var a=e._parseHeaders(c.getAllResponseHeaders()),d=e._transformResponse(c.response);e._onErrorItem(b,d,c.status,a),e._onCompleteItem(b,d,c.status,a)},c.onabort=function(){var a=e._parseHeaders(c.getAllResponseHeaders()),d=e._transformResponse(c.response);e._onCancelItem(b,d,c.status,a),e._onCompleteItem(b,d,c.status,a)},c.open(b.method,b.url,!0),c.withCredentials=b.withCredentials,a.forEach(b.headers,function(a,b){c.setRequestHeader(b,a)}),c.send(d),this._render()},g.prototype._iframeTransport=function(b){var c=a.element('<form style="display: none;" />'),d=a.element('<iframe name="iframeTransport'+Date.now()+'">'),e=b._input,f=this;b._form&&b._form.replaceWith(e),b._form=c,f._onBeforeUploadItem(b),e.prop("name",b.alias),a.forEach(b.formData,function(b){a.forEach(b,function(b,d){c.append(a.element('<input type="hidden" name="'+d+'" value="'+b+'" />'))})}),c.prop({action:b.url,method:"POST",target:d.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"}),d.bind("load",function(){try{var a=d[0].contentDocument.body.innerHTML}catch(c){}var e={response:a,status:200,dummy:!0},g=f._transformResponse(e.response),h={};f._onSuccessItem(b,g,e.status,h),f._onCompleteItem(b,g,e.status,h)}),c.abort=function(){var a,g={status:0,dummy:!0},h={};d.unbind("load").prop("src","javascript:false;"),c.replaceWith(e),f._onCancelItem(b,a,g.status,h),f._onCompleteItem(b,a,g.status,h)},e.after(c),c.append(e).append(d),c[0].submit(),this._render()},g.prototype._onWhenAddingFileFailed=function(a,b,c){this.onWhenAddingFileFailed(a,b,c)},g.prototype._onAfterAddingFile=function(a){this.onAfterAddingFile(a)},g.prototype._onAfterAddingAll=function(a){this.onAfterAddingAll(a)},g.prototype._onBeforeUploadItem=function(a){a._onBeforeUpload(),this.onBeforeUploadItem(a)},g.prototype._onProgressItem=function(a,b){var c=this._getTotalProgress(b);this.progress=c,a._onProgress(b),this.onProgressItem(a,b),this.onProgressAll(c),this._render()},g.prototype._onSuccessItem=function(a,b,c,d){a._onSuccess(b,c,d),this.onSuccessItem(a,b,c,d)},g.prototype._onErrorItem=function(a,b,c,d){a._onError(b,c,d),this.onErrorItem(a,b,c,d)},g.prototype._onCancelItem=function(a,b,c,d){a._onCancel(b,c,d),this.onCancelItem(a,b,c,d)},g.prototype._onCompleteItem=function(b,c,d,e){b._onComplete(c,d,e),this.onCompleteItem(b,c,d,e);var f=this.getReadyItems()[0];return this.isUploading=!1,a.isDefined(f)?void f.upload():(this.onCompleteAll(),this.progress=this._getTotalProgress(),void this._render())},g.isFile=g.prototype.isFile,g.isFileLikeObject=g.prototype.isFileLikeObject,g.isArrayLikeObject=g.prototype.isArrayLikeObject,g.isHTML5=g.prototype.isHTML5,g.inherit=function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a,a.super_=b},g.FileLikeObject=h,g.FileItem=i,g.FileDirective=j,g.FileSelect=k,g.FileDrop=l,g.FileOver=m,h.prototype._createFromFakePath=function(a){this.lastModifiedDate=null,this.size=null,this.type="like/"+a.slice(a.lastIndexOf(".")+1).toLowerCase(),this.name=a.slice(a.lastIndexOf("/")+a.lastIndexOf("\\")+2)},h.prototype._createFromObject=function(b){this.lastModifiedDate=a.copy(b.lastModifiedDate),this.size=b.size,this.type=b.type,this.name=b.name},i.prototype.upload=function(){this.uploader.uploadItem(this)},i.prototype.cancel=function(){this.uploader.cancelItem(this)},i.prototype.remove=function(){this.uploader.removeFromQueue(this)},i.prototype.onBeforeUpload=function(){},i.prototype.onProgress=function(){},i.prototype.onSuccess=function(){},i.prototype.onError=function(){},i.prototype.onCancel=function(){},i.prototype.onComplete=function(){},i.prototype._onBeforeUpload=function(){this.isReady=!0,this.isUploading=!0,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()},i.prototype._onProgress=function(a){this.progress=a,this.onProgress(a)},i.prototype._onSuccess=function(a,b,c){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(a,b,c)},i.prototype._onError=function(a,b,c){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(a,b,c)},i.prototype._onCancel=function(a,b,c){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(a,b,c)},i.prototype._onComplete=function(a,b,c){this.onComplete(a,b,c),this.removeAfterUpload&&this.remove()},i.prototype._destroy=function(){this._input&&this._input.remove(),this._form&&this._form.remove(),delete this._form,delete this._input},i.prototype._prepareToUploading=function(){this.index=this.index||++this.uploader._nextIndex,this.isReady=!0},i.prototype._replaceNode=function(a){var b=f(a.clone())(a.scope());b.prop("value",null),a.css("display","none"),a.after(b)},j.prototype.events={},j.prototype.bind=function(){for(var a in this.events){var b=this.events[a];this.element.bind(a,this[b])}},j.prototype.unbind=function(){for(var a in this.events)this.element.unbind(a,this.events[a])},j.prototype.destroy=function(){var a=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(a,1),this.unbind()},j.prototype._saveLinks=function(){for(var a in this.events){var b=this.events[a];this[b]=this[b].bind(this)}},g.inherit(k,j),k.prototype.events={$destroy:"destroy",change:"onChange"},k.prototype.prop="select",k.prototype.getOptions=function(){},k.prototype.getFilters=function(){},k.prototype.isEmptyAfterSelection=function(){return!!this.element.attr("multiple")},k.prototype.onChange=function(){var a=this.uploader.isHTML5?this.element[0].files:this.element[0],b=this.getOptions(),c=this.getFilters();this.uploader.isHTML5||this.destroy(),this.uploader.addToQueue(a,b,c),this.isEmptyAfterSelection()&&this.element.prop("value",null)},g.inherit(l,j),l.prototype.events={$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"},l.prototype.prop="drop",l.prototype.getOptions=function(){},l.prototype.getFilters=function(){},l.prototype.onDrop=function(b){var c=this._getTransfer(b);if(c){var d=this.getOptions(),e=this.getFilters();this._preventAndStop(b),a.forEach(this.uploader._directives.over,this._removeOverClass,this),this.uploader.addToQueue(c.files,d,e)}},l.prototype.onDragOver=function(b){var c=this._getTransfer(b);this._haveFiles(c.types)&&(c.dropEffect="copy",this._preventAndStop(b),a.forEach(this.uploader._directives.over,this._addOverClass,this))},l.prototype.onDragLeave=function(b){b.target===this.element[0]&&(this._preventAndStop(b),a.forEach(this.uploader._directives.over,this._removeOverClass,this))},l.prototype._getTransfer=function(a){return a.dataTransfer?a.dataTransfer:a.originalEvent.dataTransfer},l.prototype._preventAndStop=function(a){a.preventDefault(),a.stopPropagation()},l.prototype._haveFiles=function(a){return a?a.indexOf?-1!==a.indexOf("Files"):a.contains?a.contains("Files"):!1:!1},l.prototype._addOverClass=function(a){a.addOverClass()},l.prototype._removeOverClass=function(a){a.removeOverClass()},g.inherit(m,j),m.prototype.events={$destroy:"destroy"},m.prototype.prop="over",m.prototype.overClass="nv-file-over",m.prototype.addOverClass=function(){this.element.addClass(this.getOverClass())},m.prototype.removeOverClass=function(){this.element.removeClass(this.getOverClass())},m.prototype.getOverClass=function(){return this.overClass},g}]).directive("nvFileSelect",["$parse","FileUploader",function(a,b){return{link:function(c,d,e){var f=c.$eval(e.uploader);if(!(f instanceof b))throw new TypeError('"Uploader" must be an instance of FileUploader');var g=new b.FileSelect({uploader:f,element:d});g.getOptions=a(e.options).bind(g,c),g.getFilters=function(){return e.filters}}}}]).directive("nvFileDrop",["$parse","FileUploader",function(a,b){return{link:function(c,d,e){var f=c.$eval(e.uploader);if(!(f instanceof b))throw new TypeError('"Uploader" must be an instance of FileUploader');if(f.isHTML5){var g=new b.FileDrop({uploader:f,element:d});g.getOptions=a(e.options).bind(g,c),g.getFilters=function(){return e.filters}}}}}]).directive("nvFileOver",["FileUploader",function(a){return{link:function(b,c,d){var e=b.$eval(d.uploader);if(!(e instanceof a))throw new TypeError('"Uploader" must be an instance of FileUploader');var f=new a.FileOver({uploader:e,element:c});f.getOverClass=function(){return d.overClass||this.overClass}}}}]),b});(function(window,angular,undefined){angular.module("angular-md5",["gdi2290.md5"]);angular.module("ngMd5",["gdi2290.md5"]);angular.module("gdi2290.md5",["gdi2290.gravatar-filter","gdi2290.md5-service","gdi2290.md5-filter"]);"use strict";angular.module("gdi2290.gravatar-filter",[]).filter("gravatar",["md5",function(md5){var cache={};return function(text,defaultText){if(!cache[text]){defaultText=defaultText?md5.createHash(defaultText.toString().toLowerCase()):"";cache[text]=text?md5.createHash(text.toString().toLowerCase()):defaultText}return cache[text]}}]);"use strict";angular.module("gdi2290.md5-filter",[]).filter("md5",["md5",function(md5){return function(text){return text?md5.createHash(text.toString().toLowerCase()):text}}]);"use strict";angular.module("gdi2290.md5-service",[]).factory("md5",[function(){var md5={createHash:function(str){var xl;var rotateLeft=function(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits};var addUnsigned=function(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}};var _F=function(x,y,z){return x&y|~x&z};var _G=function(x,y,z){return x&z|y&~z};var _H=function(x,y,z){return x^y^z};var _I=function(x,y,z){return y^(x|~z)};var _FF=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(_F(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var _GG=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(_G(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var _HH=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(_H(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var _II=function(a,b,c,d,x,s,ac){a=addUnsigned(a,addUnsigned(addUnsigned(_I(b,c,d),x),ac));return addUnsigned(rotateLeft(a,s),b)};var convertToWordArray=function(str){var lWordCount;var lMessageLength=str.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=new Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|str.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray};var wordToHex=function(lValue){var wordToHexValue="",wordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;wordToHexValue_temp="0"+lByte.toString(16);wordToHexValue=wordToHexValue+wordToHexValue_temp.substr(wordToHexValue_temp.length-2,2)}return wordToHexValue};var x=[],k,AA,BB,CC,DD,a,b,c,d,S11=7,S12=12,S13=17,S14=22,S21=5,S22=9,S23=14,S24=20,S31=4,S32=11,S33=16,S34=23,S41=6,S42=10,S43=15,S44=21;x=convertToWordArray(str);a=1732584193;b=4023233417;c=2562383102;d=271733878;xl=x.length;for(k=0;k<xl;k+=16){AA=a;BB=b;CC=c;DD=d;a=_FF(a,b,c,d,x[k+0],S11,3614090360);d=_FF(d,a,b,c,x[k+1],S12,3905402710);c=_FF(c,d,a,b,x[k+2],S13,606105819);b=_FF(b,c,d,a,x[k+3],S14,3250441966);a=_FF(a,b,c,d,x[k+4],S11,4118548399);d=_FF(d,a,b,c,x[k+5],S12,1200080426);c=_FF(c,d,a,b,x[k+6],S13,2821735955);b=_FF(b,c,d,a,x[k+7],S14,4249261313);a=_FF(a,b,c,d,x[k+8],S11,1770035416);d=_FF(d,a,b,c,x[k+9],S12,2336552879);c=_FF(c,d,a,b,x[k+10],S13,4294925233);b=_FF(b,c,d,a,x[k+11],S14,2304563134);a=_FF(a,b,c,d,x[k+12],S11,1804603682);d=_FF(d,a,b,c,x[k+13],S12,4254626195);c=_FF(c,d,a,b,x[k+14],S13,2792965006);b=_FF(b,c,d,a,x[k+15],S14,1236535329);a=_GG(a,b,c,d,x[k+1],S21,4129170786);d=_GG(d,a,b,c,x[k+6],S22,3225465664);c=_GG(c,d,a,b,x[k+11],S23,643717713);b=_GG(b,c,d,a,x[k+0],S24,3921069994);a=_GG(a,b,c,d,x[k+5],S21,3593408605);d=_GG(d,a,b,c,x[k+10],S22,38016083);c=_GG(c,d,a,b,x[k+15],S23,3634488961);b=_GG(b,c,d,a,x[k+4],S24,3889429448);a=_GG(a,b,c,d,x[k+9],S21,568446438);d=_GG(d,a,b,c,x[k+14],S22,3275163606);c=_GG(c,d,a,b,x[k+3],S23,4107603335);b=_GG(b,c,d,a,x[k+8],S24,1163531501);a=_GG(a,b,c,d,x[k+13],S21,2850285829);d=_GG(d,a,b,c,x[k+2],S22,4243563512);c=_GG(c,d,a,b,x[k+7],S23,1735328473);b=_GG(b,c,d,a,x[k+12],S24,2368359562);a=_HH(a,b,c,d,x[k+5],S31,4294588738);d=_HH(d,a,b,c,x[k+8],S32,2272392833);c=_HH(c,d,a,b,x[k+11],S33,1839030562);b=_HH(b,c,d,a,x[k+14],S34,4259657740);a=_HH(a,b,c,d,x[k+1],S31,2763975236);d=_HH(d,a,b,c,x[k+4],S32,1272893353);c=_HH(c,d,a,b,x[k+7],S33,4139469664);b=_HH(b,c,d,a,x[k+10],S34,3200236656);a=_HH(a,b,c,d,x[k+13],S31,681279174);d=_HH(d,a,b,c,x[k+0],S32,3936430074);c=_HH(c,d,a,b,x[k+3],S33,3572445317);b=_HH(b,c,d,a,x[k+6],S34,76029189);a=_HH(a,b,c,d,x[k+9],S31,3654602809);d=_HH(d,a,b,c,x[k+12],S32,3873151461);c=_HH(c,d,a,b,x[k+15],S33,530742520);b=_HH(b,c,d,a,x[k+2],S34,3299628645);a=_II(a,b,c,d,x[k+0],S41,4096336452);d=_II(d,a,b,c,x[k+7],S42,1126891415);c=_II(c,d,a,b,x[k+14],S43,2878612391);b=_II(b,c,d,a,x[k+5],S44,4237533241);a=_II(a,b,c,d,x[k+12],S41,1700485571);d=_II(d,a,b,c,x[k+3],S42,2399980690);c=_II(c,d,a,b,x[k+10],S43,4293915773);b=_II(b,c,d,a,x[k+1],S44,2240044497);a=_II(a,b,c,d,x[k+8],S41,1873313359);d=_II(d,a,b,c,x[k+15],S42,4264355552);c=_II(c,d,a,b,x[k+6],S43,2734768916);b=_II(b,c,d,a,x[k+13],S44,1309151649);a=_II(a,b,c,d,x[k+4],S41,4149444226);d=_II(d,a,b,c,x[k+11],S42,3174756917);c=_II(c,d,a,b,x[k+2],S43,718787259);b=_II(b,c,d,a,x[k+9],S44,3951481745);a=addUnsigned(a,AA);b=addUnsigned(b,BB);c=addUnsigned(c,CC);d=addUnsigned(d,DD)}var temp=wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d);return temp.toLowerCase()}};return md5}])})(this,this.angular,void 0);var duScrollDefaultEasing=function(e){"use strict";return.5>e?Math.pow(2*e,2)/2:1-Math.pow(2*(1-e),2)/2};angular.module("duScroll",["duScroll.scrollspy","duScroll.smoothScroll","duScroll.scrollContainer","duScroll.spyContext","duScroll.scrollHelpers"]).value("duScrollDuration",350).value("duScrollSpyWait",100).value("duScrollGreedy",!1).value("duScrollOffset",0).value("duScrollEasing",duScrollDefaultEasing).value("duScrollCancelOnEvents","scroll mousedown mousewheel touchmove keydown").value("duScrollBottomSpy",!1),angular.module("duScroll.scrollHelpers",["duScroll.requestAnimation"]).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset","duScrollCancelOnEvents",function(e,t,n,r,o,l,u,i){"use strict";var c={},a=function(e){return"undefined"!=typeof HTMLDocument&&e instanceof HTMLDocument||e.nodeType&&e.nodeType===e.DOCUMENT_NODE},s=function(e){return"undefined"!=typeof HTMLElement&&e instanceof HTMLElement||e.nodeType&&e.nodeType===e.ELEMENT_NODE},d=function(e){return s(e)||a(e)?e:e[0]};c.duScrollTo=function(t,n,r,o){var l;if(angular.isElement(t)?l=this.duScrollToElement:angular.isDefined(r)&&(l=this.duScrollToAnimated),l)return l.apply(this,arguments);var u=d(this);return a(u)?e.scrollTo(t,n):(u.scrollLeft=t,void(u.scrollTop=n))};var f,p;c.duScrollToAnimated=function(e,l,u,c){u&&!c&&(c=o);var a=this.duScrollLeft(),s=this.duScrollTop(),d=Math.round(e-a),m=Math.round(l-s),S=null,g=0,h=this,v=function(e){(!e||g&&e.which>0)&&(i&&h.unbind(i,v),n(f),p.reject(),f=null)};if(f&&v(),p=t.defer(),0===u||!d&&!m)return 0===u&&h.duScrollTo(e,l),p.resolve(),p.promise;var y=function(e){null===S&&(S=e),g=e-S;var t=g>=u?1:c(g/u);h.scrollTo(a+Math.ceil(d*t),s+Math.ceil(m*t)),1>t?f=r(y):(i&&h.unbind(i,v),f=null,p.resolve())};return h.duScrollTo(a,s),i&&h.bind(i,v),f=r(y),p.promise},c.duScrollToElement=function(e,t,n,r){var o=d(this);(!angular.isNumber(t)||isNaN(t))&&(t=u);var l=this.duScrollTop()+d(e).getBoundingClientRect().top-t;return s(o)&&(l-=o.getBoundingClientRect().top),this.duScrollTo(0,l,n,r)},c.duScrollLeft=function(t,n,r){if(angular.isNumber(t))return this.duScrollTo(t,this.duScrollTop(),n,r);var o=d(this);return a(o)?e.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft:o.scrollLeft},c.duScrollTop=function(t,n,r){if(angular.isNumber(t))return this.duScrollTo(this.duScrollLeft(),t,n,r);var o=d(this);return a(o)?e.scrollY||document.documentElement.scrollTop||document.body.scrollTop:o.scrollTop},c.duScrollToElementAnimated=function(e,t,n,r){return this.duScrollToElement(e,t,n||l,r)},c.duScrollTopAnimated=function(e,t,n){return this.duScrollTop(e,t||l,n)},c.duScrollLeftAnimated=function(e,t,n){return this.duScrollLeft(e,t||l,n)},angular.forEach(c,function(e,t){angular.element.prototype[t]=e;var n=t.replace(/^duScroll/,"scroll");angular.isUndefined(angular.element.prototype[n])&&(angular.element.prototype[n]=e)})}]),angular.module("duScroll.polyfill",[]).factory("polyfill",["$window",function(e){"use strict";var t=["webkit","moz","o","ms"];return function(n,r){if(e[n])return e[n];for(var o,l=n.substr(0,1).toUpperCase()+n.substr(1),u=0;u<t.length;u++)if(o=t[u]+l,e[o])return e[o];return r}}]),angular.module("duScroll.requestAnimation",["duScroll.polyfill"]).factory("requestAnimation",["polyfill","$timeout",function(e,t){"use strict";var n=0,r=function(e,r){var o=(new Date).getTime(),l=Math.max(0,16-(o-n)),u=t(function(){e(o+l)},l);return n=o+l,u};return e("requestAnimationFrame",r)}]).factory("cancelAnimation",["polyfill","$timeout",function(e,t){"use strict";var n=function(e){t.cancel(e)};return e("cancelAnimationFrame",n)}]),angular.module("duScroll.spyAPI",["duScroll.scrollContainerAPI"]).factory("spyAPI",["$rootScope","$timeout","$window","$document","scrollContainerAPI","duScrollGreedy","duScrollSpyWait","duScrollBottomSpy",function(e,t,n,r,o,l,u,i){"use strict";var c=function(o){var c=!1,a=!1,s=function(){a=!1;var t,u=o.container,c=u[0],s=0;"undefined"!=typeof HTMLElement&&c instanceof HTMLElement||c.nodeType&&c.nodeType===c.ELEMENT_NODE?(s=c.getBoundingClientRect().top,t=Math.round(c.scrollTop+c.clientHeight)>=c.scrollHeight):t=Math.round(n.pageYOffset+n.innerHeight)>=r[0].body.scrollHeight;var d,f,p,m,S,g,h=i&&t?"bottom":"top";for(m=o.spies,f=o.currentlyActive,p=void 0,d=0;d<m.length;d++)S=m[d],g=S.getTargetPosition(),g&&(i&&t||g.top+S.offset-s<20&&(l||-1*g.top+s)<g.height)&&(!p||p[h]<g[h])&&(p={spy:S},p[h]=g[h]);p&&(p=p.spy),f===p||l&&!p||(f&&(f.$element.removeClass("active"),e.$broadcast("duScrollspy:becameInactive",f.$element)),p&&(p.$element.addClass("active"),e.$broadcast("duScrollspy:becameActive",p.$element)),o.currentlyActive=p)};return u?function(){c?a=!0:(s(),c=t(function(){c=!1,a&&s()},u,!1))}:s},a={},s=function(e){var t=e.$id,n={spies:[]};return n.handler=c(n),a[t]=n,e.$on("$destroy",function(){d(e)}),t},d=function(e){var t=e.$id,n=a[t],r=n.container;r&&r.off("scroll",n.handler),delete a[t]},f=s(e),p=function(e){return a[e.$id]?a[e.$id]:e.$parent?p(e.$parent):a[f]},m=function(e){var t,n,r=e.$scope;if(r)return p(r);for(n in a)if(t=a[n],-1!==t.spies.indexOf(e))return t},S=function(e){for(;e.parentNode;)if(e=e.parentNode,e===document)return!0;return!1},g=function(e){var t=m(e);t&&(t.spies.push(e),t.container&&S(t.container)||(t.container&&t.container.off("scroll",t.handler),t.container=o.getContainer(e.$scope),t.container.on("scroll",t.handler).triggerHandler("scroll")))},h=function(e){var t=m(e);e===t.currentlyActive&&(t.currentlyActive=null);var n=t.spies.indexOf(e);-1!==n&&t.spies.splice(n,1),e.$element=null};return{addSpy:g,removeSpy:h,createContext:s,destroyContext:d,getContextForScope:p}}]),angular.module("duScroll.scrollContainerAPI",[]).factory("scrollContainerAPI",["$document",function(e){"use strict";var t={},n=function(e,n){var r=e.$id;return t[r]=n,r},r=function(e){return t[e.$id]?e.$id:e.$parent?r(e.$parent):void 0},o=function(n){var o=r(n);return o?t[o]:e},l=function(e){var n=r(e);n&&delete t[n]};return{getContainerId:r,getContainer:o,setContainer:n,removeContainer:l}}]),angular.module("duScroll.smoothScroll",["duScroll.scrollHelpers","duScroll.scrollContainerAPI"]).directive("duSmoothScroll",["duScrollDuration","duScrollOffset","scrollContainerAPI",function(e,t,n){"use strict";return{link:function(r,o,l){o.on("click",function(o){if(l.href&&-1!==l.href.indexOf("#")||""!==l.duSmoothScroll){var u=l.href?l.href.replace(/.*(?=#[^\s]+$)/,"").substring(1):l.duSmoothScroll,i=document.getElementById(u)||document.getElementsByName(u)[0];if(i&&i.getBoundingClientRect){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var c=l.offset?parseInt(l.offset,10):t,a=l.duration?parseInt(l.duration,10):e,s=n.getContainer(r);s.duScrollToElement(angular.element(i),isNaN(c)?0:c,isNaN(a)?0:a)}}})}}}]),angular.module("duScroll.spyContext",["duScroll.spyAPI"]).directive("duSpyContext",["spyAPI",function(e){"use strict";return{restrict:"A",scope:!0,compile:function(t,n,r){return{pre:function(t,n,r,o){e.createContext(t)}}}}}]),angular.module("duScroll.scrollContainer",["duScroll.scrollContainerAPI"]).directive("duScrollContainer",["scrollContainerAPI",function(e){"use strict";return{restrict:"A",scope:!0,compile:function(t,n,r){return{pre:function(t,n,r,o){r.$observe("duScrollContainer",function(r){angular.isString(r)&&(r=document.getElementById(r)),r=angular.isElement(r)?angular.element(r):n,e.setContainer(t,r),t.$on("$destroy",function(){e.removeContainer(t)})})}}}}}]),angular.module("duScroll.scrollspy",["duScroll.spyAPI"]).directive("duScrollspy",["spyAPI","duScrollOffset","$timeout","$rootScope",function(e,t,n,r){"use strict";var o=function(e,t,n,r){angular.isElement(e)?this.target=e:angular.isString(e)&&(this.targetId=e),this.$scope=t,this.$element=n,this.offset=r};return o.prototype.getTargetElement=function(){return!this.target&&this.targetId&&(this.target=document.getElementById(this.targetId)||document.getElementsByName(this.targetId)[0]),this.target},o.prototype.getTargetPosition=function(){var e=this.getTargetElement();return e?e.getBoundingClientRect():void 0},o.prototype.flushTargetCache=function(){this.targetId&&(this.target=void 0)},{link:function(l,u,i){var c,a=i.ngHref||i.href;a&&-1!==a.indexOf("#")?c=a.replace(/.*(?=#[^\s]+$)/,"").substring(1):i.duScrollspy?c=i.duScrollspy:i.duSmoothScroll&&(c=i.duSmoothScroll),c&&n(function(){var n=new o(c,l,u,-(i.offset?parseInt(i.offset,10):t));e.addSpy(n),l.$on("$locationChangeSuccess",n.flushTargetCache.bind(n));var a=r.$on("$stateChangeSuccess",n.flushTargetCache.bind(n));l.$on("$destroy",function(){e.removeSpy(n),a()})},0,!1)}}}]);angular.module("codemirror",[]).directive("codemirror",["$timeout",function($timeout){return{require:"?ngModel",scope:{config:"=codemirror",htmlFilters:"="},link:function(scope,elem,attrs,controller){var codemirror;controller.$render=function(){if(scope.config.viewportMargin==="Infinity"){scope.config.viewportMargin=Infinity}codemirror=CodeMirror.fromTextArea(elem[0],scope.config||{});$timeout(function(){codemirror.refresh()});var safeViewValue=controller.$viewValue||"";codemirror.setValue(safeViewValue);codemirror.on("change",function(instance){var newValue=instance.getValue();if(newValue!==controller.$viewValue){scope.$evalAsync(function(){controller.$setViewValue(newValue)})}});if(scope.htmlFilters.length){codemirror.on("blur",function(instance){var html=instance.getValue();if(scope.htmlFilters.indexOf("style")!==-1){var extracted_styles=[];html=filterStyle(html,extracted_styles)}if(scope.htmlFilters.indexOf("body")!==-1){html=filterBody(html)}html=filterOtherTags(html,scope.htmlFilters);if(scope.htmlFilters.indexOf("style")!==-1&&extracted_styles.length){html+=extracted_styles.join("")}instance.setValue(html)})}}}}}]);function filterStyle(html,extracted_styles){var regex=/<style.*?>[\s\S]*?<\/style>/gi;html=html.replace(regex,function(match){extracted_styles.push(match);return""});return html}function filterBody(html){html=html.replace(/[\s\S]*<body.*?>|<\/body>[\s\S]*/gi,"");return html}function filterOtherTags(html,tagsArray){var tagsString=tagsArray.join("|");var regex=new RegExp("<("+tagsString+").*?>[\\s\\S]*?</\\1>","gi");html=html.replace(regex,"");regex=new RegExp("<("+tagsString+").*?[/]?>","gi");html=html.replace(regex,"");return html}if(typeof module!=="undefined"&&typeof exports!=="undefined"&&module.exports===exports){module.exports="monospaced.elastic"}angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function($timeout,$window,config){"use strict";return{require:"ngModel",restrict:"A, C",link:function(scope,element,attrs,ngModel){var ta=element[0],$ta=element;if(ta.nodeName!=="TEXTAREA"||!$window.getComputedStyle){return}$ta.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var text=ta.value;ta.value="";ta.value=text
;var append=attrs.msdElastic?attrs.msdElastic.replace(/\\n/g,"\n"):config.append,$win=angular.element($window),mirrorInitStyle="position: absolute; top: -999px; right: auto; bottom: auto;"+"left: 0; overflow: hidden; -webkit-box-sizing: content-box;"+"-moz-box-sizing: content-box; box-sizing: content-box;"+"min-height: 0 !important; height: 0 !important; padding: 0;"+"word-wrap: break-word; border: 0;",$mirror=angular.element('<textarea aria-hidden="true" tabindex="-1" '+'style="'+mirrorInitStyle+'"/>').data("elastic",true),mirror=$mirror[0],taStyle=getComputedStyle(ta),resize=taStyle.getPropertyValue("resize"),borderBox=taStyle.getPropertyValue("box-sizing")==="border-box"||taStyle.getPropertyValue("-moz-box-sizing")==="border-box"||taStyle.getPropertyValue("-webkit-box-sizing")==="border-box",boxOuter=!borderBox?{width:0,height:0}:{width:parseInt(taStyle.getPropertyValue("border-right-width"),10)+parseInt(taStyle.getPropertyValue("padding-right"),10)+parseInt(taStyle.getPropertyValue("padding-left"),10)+parseInt(taStyle.getPropertyValue("border-left-width"),10),height:parseInt(taStyle.getPropertyValue("border-top-width"),10)+parseInt(taStyle.getPropertyValue("padding-top"),10)+parseInt(taStyle.getPropertyValue("padding-bottom"),10)+parseInt(taStyle.getPropertyValue("border-bottom-width"),10)},minHeightValue=parseInt(taStyle.getPropertyValue("min-height"),10),heightValue=parseInt(taStyle.getPropertyValue("height"),10),minHeight=Math.max(minHeightValue,heightValue)-boxOuter.height,maxHeight=parseInt(taStyle.getPropertyValue("max-height"),10),mirrored,active,copyStyle=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];if($ta.data("elastic")){return}maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4;if(mirror.parentNode!==document.body){angular.element(document.body).append(mirror)}$ta.css({resize:resize==="none"||resize==="vertical"?"none":"horizontal"}).data("elastic",true);function initMirror(){var mirrorStyle=mirrorInitStyle;mirrored=ta;taStyle=getComputedStyle(ta);angular.forEach(copyStyle,function(val){mirrorStyle+=val+":"+taStyle.getPropertyValue(val)+";"});mirror.setAttribute("style",mirrorStyle)}function adjust(){var taHeight,taComputedStyleWidth,mirrorHeight,width,overflow;if(mirrored!==ta){initMirror()}if(!active){active=true;mirror.value=ta.value+append;mirror.style.overflowY=ta.style.overflowY;taHeight=ta.style.height===""?"auto":parseInt(ta.style.height,10);taComputedStyleWidth=getComputedStyle(ta).getPropertyValue("width");if(taComputedStyleWidth.substr(taComputedStyleWidth.length-2,2)==="px"){width=parseInt(taComputedStyleWidth,10)-boxOuter.width;mirror.style.width=width+"px"}mirrorHeight=mirror.scrollHeight;if(mirrorHeight>maxHeight){mirrorHeight=maxHeight;overflow="scroll"}else if(mirrorHeight<minHeight){mirrorHeight=minHeight}mirrorHeight+=boxOuter.height;ta.style.overflowY=overflow||"hidden";if(taHeight!==mirrorHeight){scope.$emit("elastic:resize",$ta,taHeight,mirrorHeight);ta.style.height=mirrorHeight+"px"}$timeout(function(){active=false},1,false)}}function forceAdjust(){active=false;adjust()}if("onpropertychange"in ta&&"oninput"in ta){ta["oninput"]=ta.onkeyup=adjust}else{ta["oninput"]=adjust}$win.bind("resize",forceAdjust);scope.$watch(function(){return ngModel.$modelValue},function(newValue){forceAdjust()});scope.$on("elastic:adjust",function(){initMirror();forceAdjust()});$timeout(adjust,0,false);scope.$on("$destroy",function(){$mirror.remove();$win.unbind("resize",forceAdjust)})}}}]);var mod;mod=angular.module("infinite-scroll",[]),mod.directive("infiniteScroll",["$rootScope","$window","$timeout",function(i,n,e){return{link:function(t,l,o){var r,c,f,a;return n=angular.element(n),f=0,null!=o.infiniteScrollDistance&&t.$watch(o.infiniteScrollDistance,function(i){return f=parseInt(i,10)}),a=!0,r=!1,null!=o.infiniteScrollDisabled&&t.$watch(o.infiniteScrollDisabled,function(i){return a=!i,a&&r?(r=!1,c()):void 0}),c=function(){var e,c,u,d;return d=n.height()+n.scrollTop(),e=l.offset().top+l.height(),c=e-d,u=n.height()*f>=c,u&&a?i.$$phase?t.$eval(o.infiniteScroll):t.$apply(o.infiniteScroll):u?r=!0:void 0},n.on("scroll",c),t.$on("$destroy",function(){return n.off("scroll",c)}),e(function(){return o.infiniteScrollImmediateCheck?t.$eval(o.infiniteScrollImmediateCheck)?c():void 0:c()},0)}}}]);(function(){"use strict";var redactorOptions={};angular.module("ui.redactor",[]).constant("redactorOptions",redactorOptions).directive("redactor",["$timeout",function($timeout){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){scope.redactorLoaded=false;scope.variables=window.fields?window.fields:[];scope.buttons=["html","bold","italic","underline","lists","alignment","link","fontsize","fontcolor"];if(scope.variables.length){scope.buttons.push("variable")}var updateModel=function updateModel(value){$timeout(function(){scope.$apply(function(){ngModel.$setViewValue(value)})})},options={callbacks:{changed:updateModel},minHeight:"200px",maxHeight:"1000px",plugins:["variable-ml","fontsize","fontcolor-ml","alignment"],fontsizes:[10,11,12,13,14,15,16,18,20,22,24,26,28,30],fontcolors:["#000000","#ffffff","#7f8c8d","#f8f9fa","#f6f6f6","#007bff","#409cff","#80bdff","#bfdeff","#e6f2ff","#09c269","#28a745","#20c997","#58d7b1","#1abc9c","#765431","#d35400","#fd7e14","#ffd145","#ffc107","#dc3545","#a52834","#e74c3c","#8e44ad","#9b59b6"],variables:scope.variables,buttons:scope.buttons,removeScript:true,removeStyle:true,linkNewTab:true},additionalOptions=attrs.redactor?scope.$eval(attrs.redactor):{},editor;angular.extend(options,redactorOptions,additionalOptions);$timeout(function(){editor=element.redactor(options);ngModel.$render()});ngModel.$render=function(){if(angular.isDefined(editor)){$timeout(function(){element.redactor("source.setCode",ngModel.$viewValue||"");scope.redactorLoaded=true})}}}}}])})();"use strict";angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(uiSortableConfig,$timeout,$log){return{require:"?ngModel",link:function(scope,element,attrs,ngModel){var savedNodes;function combineCallbacks(first,second){if(second&&typeof second==="function"){return function(e,ui){first(e,ui);second(e,ui)}}return first}var opts={};var callbacks={receive:null,remove:null,start:null,stop:null,update:null};angular.extend(opts,uiSortableConfig);if(ngModel){scope.$watch(attrs.ngModel+".length",function(){$timeout(function(){scope.$apply()})});callbacks.start=function(e,ui){ui.item.sortable={index:ui.item.index(),cancel:function(){ui.item.sortable._isCanceled=true},isCanceled:function(){return ui.item.sortable._isCanceled},_isCanceled:false}};callbacks.activate=function(){savedNodes=element.contents();var placeholder=element.sortable("option","placeholder");if(placeholder&&placeholder.element&&typeof placeholder.element==="function"){var phElement=placeholder.element();if(!phElement.jquery){phElement=angular.element(phElement)}var excludes=element.find('[class="'+phElement.attr("class")+'"]');savedNodes=savedNodes.not(excludes)}};callbacks.update=function(e,ui){if(!ui.item.sortable.received){ui.item.sortable.dropindex=ui.item.index();element.sortable("cancel")}savedNodes.detach();if(element.sortable("option","helper")==="clone"){savedNodes=savedNodes.not(savedNodes.last())}savedNodes.appendTo(element);if(ui.item.sortable.received&&!ui.item.sortable.isCanceled()){scope.$apply(function(){ngModel.$modelValue.splice(ui.item.sortable.dropindex,0,ui.item.sortable.moved)})}};callbacks.stop=function(e,ui){if(!ui.item.sortable.received&&"dropindex"in ui.item.sortable&&!ui.item.sortable.isCanceled()){scope.$apply(function(){ngModel.$modelValue.splice(ui.item.sortable.dropindex,0,ngModel.$modelValue.splice(ui.item.sortable.index,1)[0])})}else{if((!("dropindex"in ui.item.sortable)||ui.item.sortable.isCanceled())&&element.sortable("option","helper")!=="clone"){savedNodes.detach().appendTo(element)}}};callbacks.receive=function(e,ui){ui.item.sortable.received=true};callbacks.remove=function(e,ui){if(!ui.item.sortable.isCanceled()){scope.$apply(function(){ui.item.sortable.moved=ngModel.$modelValue.splice(ui.item.sortable.index,1)[0]})}};scope.$watch(attrs.uiSortable,function(newVal){angular.forEach(newVal,function(value,key){if(callbacks[key]){if(key==="stop"){value=combineCallbacks(value,function(){scope.$apply()})}value=combineCallbacks(callbacks[key],value)}element.sortable("option",key,value)})},true);angular.forEach(callbacks,function(value,key){opts[key]=combineCallbacks(value,opts[key])})}else{$log.info("ui.sortable: ngModel not provided!",element)}element.sortable(opts)}}}]);if(typeof ML_LANG==="undefined"){console.warn("ML_LANG is not defined");ML_LANG="en"}angular.module("ui.tinymce",[]).value("uiTinymceConfig",{menubar:false,statusbar:false,plugins:"textcolor colorpicker autoresize code link lists personalization alignmenu paste",toolbar:"code bold italic strikethrough underline alignmenu forecolor fontsizeselect link bullist numlist personalization",link_assume_external_targets:true,skin:"mailerlite",skin_url:"/assets/js/libs/js/tinymce/skins/mailerlite",language:ML_LANG,autoresize_bottom_margin:0,autoresize_min_height:200,textcolor_cols:6,entity_encoding:"raw",browser_spellcheck:true,textcolor_map:["000000","#000000","ffffff","#ffffff","7f8c8d","#7f8c8d","95a5a6","#95a5a6","bdc3c7","#bdc3c7","2c3e50","#2c3e50","34495e","#34495e","2980b9","#2980b9","3498db","#3498db","89D0ff","#89D0ff","1C7B44","#1C7B44","27ae60","#27ae60","2ecc71","#2ecc71","16a085","#16a085","1abc9c","#1abc9c","765431","#765431","d35400","#d35400","e67e22","#e67e22","f39c12","#f39c12","f1c40f","#f1c40f","f04736","#f04736","c0392b","#c0392b","e74c3c","#e74c3c","8e44ad","#8e44ad","9b59b6","#9b59b6"],content_css:["/css/tinymce_content.css"],paste_tags_whitelist:["a","p","strong","em","i","u","del","ul","ol","li","br"],paste_preprocess:function(plugin,args){var regex_string="<";args.target.settings.paste_tags_whitelist.forEach(function(element){regex_string+="(?!\\/?"+element+"\\b)"});regex_string+='[^>]*>| class="[^"]*"| style="[^"]*"';var filter_regex=new RegExp(regex_string,"gi");args.content=args.content.replace(filter_regex,"")},fontsize_formats:"10px 11px 12px 13px 14px 16px 18px 20px 24px 28px 30px",init_instance_callback:function(editor){editor.on("DblClick",function(e){if(e.target.nodeName=="IMG"){editor.execCommand("mceImage")}})},convert_urls:false,relative_urls:false,remove_script_host:false}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function($rootScope,$compile,$timeout,$window,$sce,uiTinymceConfig){uiTinymceConfig=uiTinymceConfig||{};var generatedIds=0;var ID_ATTR="ui-tinymce";if(uiTinymceConfig.baseUrl){tinymce.baseURL=uiTinymceConfig.baseUrl}if(/\/webforms\//.test(window.location.href)){uiTinymceConfig.plugins=uiTinymceConfig.plugins.replace(" personalization","");uiTinymceConfig.toolbar=uiTinymceConfig.toolbar.replace(" personalization","")}return{require:["ngModel","^?form"],priority:999,link:function(scope,element,attrs,ctrls){if(attrs.uiTinymceTextareaValue){ctrls[0].$setViewValue(element.val())}if(!$window.tinymce){return}var ngModel=ctrls[0],form=ctrls[1]||null;var expression,options={},tinyInstance,updateView=function(editor){var content=editor.getContent({format:options.format}).trim();content=$sce.trustAsHtml(content);ngModel.$setViewValue(content);$rootScope.$broadcast("tinymce-value-set",element);$rootScope.$broadcast("enable-save",element.attr("id"));if(!$rootScope.$$phase){scope.$digest()}};function toggleDisable(disabled){if(disabled){ensureInstance();if(tinyInstance){tinyInstance.getBody().setAttribute("contenteditable",false)}}else{ensureInstance();if(tinyInstance&&!tinyInstance.settings.readonly){tinyInstance.getBody().setAttribute("contenteditable",true)}}}attrs.$set("id",ID_ATTR+"-"+generatedIds++);expression={};angular.extend(expression,scope.$eval(attrs.uiTinymce));var debouncedUpdate=function(debouncedUpdateDelay){var debouncedUpdateTimer;return function(ed){$timeout.cancel(debouncedUpdateTimer);debouncedUpdateTimer=$timeout(function(){return function(ed){ed.save();updateView(ed)}(ed)},debouncedUpdateDelay)}}(400);scope.removed=false;var setupOptions={setup:function(ed){ed.on("init",function(){ngModel.$render();$rootScope.$broadcast("tinymce-init",element);$rootScope.$broadcast("disable-save",element.attr("id"))});ed.on("ExecCommand change NodeChange ObjectResized",function(a){debouncedUpdate(ed)});ed.on("blur",function(){element[0].blur();scope.$digest()});ed.on("remove",function(){element.remove()});if(expression.setup){expression.setup(ed,{updateView:updateView})}},format:expression.format||"html",selector:"#"+attrs.id};angular.extend(options,uiTinymceConfig,expression,setupOptions);$timeout(function(){if(options.baseURL){tinymce.baseURL=options.baseURL}tinymce.init(options);toggleDisable(scope.$eval(attrs.ngDisabled))});ngModel.$formatters.unshift(function(modelValue){return modelValue?$sce.trustAsHtml(modelValue):""});ngModel.$parsers.unshift(function(viewValue){return viewValue?$sce.getTrustedHtml(viewValue):""});ngModel.$render=function(){ensureInstance();var viewValue=ngModel.$modelValue||"";if(tinyInstance&&tinyInstance.getDoc()){tinyInstance.setContent(viewValue);tinyInstance.fire("change")}};attrs.$observe("disabled",toggleDisable);scope.$on("$tinymce:refresh",function(e,id){var eid=attrs.id;if(angular.isUndefined(id)||id===eid){var parentElement=element.parent();var clonedElement=element.clone();clonedElement.removeAttr("id");clonedElement.removeAttr("style");clonedElement.removeAttr("aria-hidden");tinymce.execCommand("mceRemoveEditor",false,eid);parentElement.append($compile(clonedElement)(scope))}});scope.$on("$destroy",function(){});function ensureInstance(){if(!tinyInstance){tinyInstance=tinymce.get(attrs.id)}}}}}]);angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.transition","ui.bootstrap.collapse","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.bindHtml","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.dateparser","ui.bootstrap.position","ui.bootstrap.datepicker","ui.bootstrap.dropdown","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.progressbar","ui.bootstrap.rating","ui.bootstrap.tabs","ui.bootstrap.timepicker","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/datepicker/datepicker.html","template/datepicker/day.html","template/datepicker/month.html","template/datepicker/popup.html","template/datepicker/year.html","template/modal/backdrop.html","template/modal/window.html","template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html","template/progressbar/bar.html","template/progressbar/progress.html","template/progressbar/progressbar.html","template/rating/rating.html","template/tabs/tab.html","template/tabs/tabset.html","template/timepicker/timepicker.html","template/typeahead/typeahead-match.html","template/typeahead/typeahead-popup.html"]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function(a,b,c){function d(a){for(var b in a)if(void 0!==f.style[b])return a[b]}var e=function(d,f,g){g=g||{};var h=a.defer(),i=e[g.animation?"animationEndEventName":"transitionEndEventName"],j=function(){c.$apply(function(){d.unbind(i,j),h.resolve(d)})};return i&&d.bind(i,j),b(function(){angular.isString(f)?d.addClass(f):angular.isFunction(f)?f(d):angular.isObject(f)&&d.css(f),i||h.resolve(d)}),h.promise.cancel=function(){i&&d.unbind(i,j),h.reject("Transition cancelled")},h.promise},f=document.createElement("trans"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},h={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return e.transitionEndEventName=d(g),e.animationEndEventName=d(h),e}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function(a){return{link:function(b,c,d){function e(b){function d(){j===e&&(j=void 0)}var e=a(c,b);return j&&j.cancel(),j=e,e.then(d,d),e}function f(){k?(k=!1,g()):(c.removeClass("collapse").addClass("collapsing"),e({height:c[0].scrollHeight+"px"}).then(g))}function g(){c.removeClass("collapsing"),c.addClass("collapse in"),c.css({height:"auto"})}function h(){if(k)k=!1,i(),c.css({height:0});else{c.css({height:c[0].scrollHeight+"px"});{c[0].offsetWidth}c.removeClass("collapse in").addClass("collapsing"),e({height:0}).then(i)}}function i(){c.removeClass("collapsing"),c.addClass("collapse")}var j,k=!0;b.$watch(d.collapse,function(a){a?h():f()})}}}]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function(a,b,c){this.groups=[],this.closeOthers=function(d){var e=angular.isDefined(b.closeOthers)?a.$eval(b.closeOthers):c.closeOthers;e&&angular.forEach(this.groups,function(a){a!==d&&(a.isOpen=!1)})},this.addGroup=function(a){var b=this;this.groups.push(a),a.$on("$destroy",function(){b.removeGroup(a)})},this.removeGroup=function(a){var b=this.groups.indexOf(a);-1!==b&&this.groups.splice(b,1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",function(){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@",isOpen:"=?",isDisabled:"=?"},controller:function(){this.setHeading=function(a){this.heading=a}},link:function(a,b,c,d){d.addGroup(a),a.$watch("isOpen",function(b){b&&d.closeOthers(a)}),a.toggleOpen=function(){a.isDisabled||(a.isOpen=!a.isOpen)}}}}).directive("accordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^accordionGroup",link:function(a,b,c,d,e){d.setHeading(e(a,function(){}))}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(a,b,c,d){a.$watch(function(){return d[c.accordionTransclude]},function(a){a&&(b.html(""),b.append(a))})}}}),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(a,b){a.closeable="close"in b}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"@",close:"&"}}}),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(a,b,c){b.addClass("ng-binding").data("$binding",c.bindHtmlUnsafe),a.$watch(c.bindHtmlUnsafe,function(a){b.html(a||"")})}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).controller("ButtonsController",["buttonConfig",function(a){this.activeClass=a.activeClass||"active",this.toggleEvent=a.toggleEvent||"click"}]).directive("btnRadio",function(){return{require:["btnRadio","ngModel"],controller:"ButtonsController",link:function(a,b,c,d){var e=d[0],f=d[1];f.$render=function(){b.toggleClass(e.activeClass,angular.equals(f.$modelValue,a.$eval(c.btnRadio)))},b.bind(e.toggleEvent,function(){var d=b.hasClass(e.activeClass);(!d||angular.isDefined(c.uncheckable))&&a.$apply(function(){f.$setViewValue(d?null:a.$eval(c.btnRadio)),f.$render()})})}}}).directive("btnCheckbox",function(){return{require:["btnCheckbox","ngModel"],controller:"ButtonsController",link:function(a,b,c,d){function e(){return g(c.btnCheckboxTrue,!0)}function f(){return g(c.btnCheckboxFalse,!1)}function g(b,c){var d=a.$eval(b);return angular.isDefined(d)?d:c}var h=d[0],i=d[1];i.$render=function(){b.toggleClass(h.activeClass,angular.equals(i.$modelValue,e()))},b.bind(h.toggleEvent,function(){a.$apply(function(){i.$setViewValue(b.hasClass(h.activeClass)?f():e()),i.$render()})})}}}),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition",function(a,b,c){function d(){e();var c=+a.interval;!isNaN(c)&&c>=0&&(g=b(f,c))}function e(){g&&(b.cancel(g),g=null)}function f(){h?(a.next(),d()):a.pause()}var g,h,i=this,j=i.slides=a.slides=[],k=-1;i.currentSlide=null;var l=!1;i.select=a.select=function(e,f){function g(){if(!l){if(i.currentSlide&&angular.isString(f)&&!a.noTransition&&e.$element){e.$element.addClass(f);{e.$element[0].offsetWidth}angular.forEach(j,function(a){angular.extend(a,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(e,{direction:f,active:!0,entering:!0}),angular.extend(i.currentSlide||{},{direction:f,leaving:!0}),a.$currentTransition=c(e.$element,{}),function(b,c){a.$currentTransition.then(function(){h(b,c)},function(){h(b,c)})}(e,i.currentSlide)}else h(e,i.currentSlide);i.currentSlide=e,k=m,d()}}function h(b,c){angular.extend(b,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(c||{},{direction:"",active:!1,leaving:!1,entering:!1}),a.$currentTransition=null}var m=j.indexOf(e);void 0===f&&(f=m>k?"next":"prev"),e&&e!==i.currentSlide&&(a.$currentTransition?(a.$currentTransition.cancel(),b(g)):g())},a.$on("$destroy",function(){l=!0}),i.indexOfSlide=function(a){return j.indexOf(a)},a.next=function(){var b=(k+1)%j.length;return a.$currentTransition?void 0:i.select(j[b],"next")},a.prev=function(){var b=0>k-1?j.length-1:k-1;return a.$currentTransition?void 0:i.select(j[b],"prev")},a.isActive=function(a){return i.currentSlide===a},a.$watch("interval",d),a.$on("$destroy",e),a.play=function(){h||(h=!0,d())},a.pause=function(){a.noPause||(h=!1,e())},i.addSlide=function(b,c){b.$element=c,j.push(b),1===j.length||b.active?(i.select(j[j.length-1]),1==j.length&&a.play()):b.active=!1},i.removeSlide=function(a){var b=j.indexOf(a);j.splice(b,1),j.length>0&&a.active?i.select(b>=j.length?j[b-1]:j[b]):k>b&&k--}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"=",noPause:"="}}}]).directive("slide",function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{active:"=?"},link:function(a,b,c,d){d.addSlide(a,b),a.$on("$destroy",function(){d.removeSlide(a)}),a.$watch("active",function(b){b&&d.select(a)})}}}),angular.module("ui.bootstrap.dateparser",[]).service("dateParser",["$locale","orderByFilter",function(a,b){function c(a,b,c){return 1===b&&c>28?29===c&&(a%4===0&&a%100!==0||a%400===0):3===b||5===b||8===b||10===b?31>c:!0}this.parsers={};var d={yyyy:{regex:"\\d{4}",apply:function(a){this.year=+a}},yy:{regex:"\\d{2}",apply:function(a){this.year=+a+2e3}},y:{regex:"\\d{1,4}",apply:function(a){this.year=+a}},MMMM:{regex:a.DATETIME_FORMATS.MONTH.join("|"),apply:function(b){this.month=a.DATETIME_FORMATS.MONTH.indexOf(b)}},MMM:{regex:a.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(b){this.month=a.DATETIME_FORMATS.SHORTMONTH.indexOf(b)}},MM:{regex:"0[1-9]|1[0-2]",apply:function(a){this.month=a-1}},M:{regex:"[1-9]|1[0-2]",apply:function(a){this.month=a-1}},dd:{regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(a){this.date=+a}},d:{regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(a){this.date=+a}},EEEE:{regex:a.DATETIME_FORMATS.DAY.join("|")},EEE:{regex:a.DATETIME_FORMATS.SHORTDAY.join("|")}};this.createParser=function(a){var c=[],e=a.split("");return angular.forEach(d,function(b,d){var f=a.indexOf(d);if(f>-1){a=a.split(""),e[f]="("+b.regex+")",a[f]="$";for(var g=f+1,h=f+d.length;h>g;g++)e[g]="",a[g]="$";a=a.join(""),c.push({index:f,apply:b.apply})}}),{regex:new RegExp("^"+e.join("")+"$"),map:b(c,"index")}},this.parse=function(b,d){if(!angular.isString(b))return b;d=a.DATETIME_FORMATS[d]||d,this.parsers[d]||(this.parsers[d]=this.createParser(d));var e=this.parsers[d],f=e.regex,g=e.map,h=b.match(f);if(h&&h.length){for(var i,j={year:1900,month:0,date:1,hours:0},k=1,l=h.length;l>k;k++){var m=g[k-1];m.apply&&m.apply.call(j,h[k])}return c(j.year,j.month,j.date)&&(i=new Date(j.year,j.month,j.date,j.hours)),i}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function(a,b){function c(a,c){return a.currentStyle?a.currentStyle[c]:b.getComputedStyle?b.getComputedStyle(a)[c]:a.style[c]}function d(a){return"static"===(c(a,"position")||"static")}var e=function(b){for(var c=a[0],e=b.offsetParent||c;e&&e!==c&&d(e);)e=e.offsetParent;return e||c};return{position:function(b){var c=this.offset(b),d={top:0,left:0},f=e(b[0]);f!=a[0]&&(d=this.offset(angular.element(f)),d.top+=f.clientTop-f.scrollTop,d.left+=f.clientLeft-f.scrollLeft);var g=b[0].getBoundingClientRect();return{width:g.width||b.prop("offsetWidth"),height:g.height||b.prop("offsetHeight"),top:c.top-d.top,left:c.left-d.left}},offset:function(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(b.pageYOffset||a[0].documentElement.scrollTop),left:d.left+(b.pageXOffset||a[0].documentElement.scrollLeft)}},positionElements:function(a,b,c,d){var e,f,g,h,i=c.split("-"),j=i[0],k=i[1]||"center";e=d?this.offset(a):this.position(a),f=b.prop("offsetWidth"),g=b.prop("offsetHeight");var l={center:function(){return e.left+e.width/2-f/2},left:function(){return e.left},right:function(){return e.left+e.width}},m={center:function(){return e.top+e.height/2-g/2},top:function(){return e.top},bottom:function(){return e.top+e.height}};switch(j){case"right":h={top:m[k](),left:l[j]()};break;case"left":h={top:m[k](),left:e.left-f};break;case"bottom":h={top:m[j](),left:l[k]()};break;default:h={top:e.top-g,left:l[k]()}}return h}}}]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("datepickerConfig",{formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",datepickerMode:"day",minMode:"day",maxMode:"year",showWeeks:!0,startingDay:0,yearRange:20,minDate:null,maxDate:null}).controller("DatepickerController",["$scope","$attrs","$parse","$interpolate","$timeout","$log","dateFilter","datepickerConfig",function(a,b,c,d,e,f,g,h){var i=this,j={$setViewValue:angular.noop};this.modes=["day","month","year"],angular.forEach(["formatDay","formatMonth","formatYear","formatDayHeader","formatDayTitle","formatMonthTitle","minMode","maxMode","showWeeks","startingDay","yearRange"],function(c,e){i[c]=angular.isDefined(b[c])?8>e?d(b[c])(a.$parent):a.$parent.$eval(b[c]):h[c]}),angular.forEach(["minDate","maxDate"],function(d){b[d]?a.$parent.$watch(c(b[d]),function(a){i[d]=a?new Date(a):null,i.refreshView()}):i[d]=h[d]?new Date(h[d]):null}),a.datepickerMode=a.datepickerMode||h.datepickerMode,a.uniqueId="datepicker-"+a.$id+"-"+Math.floor(1e4*Math.random()),this.activeDate=angular.isDefined(b.initDate)?a.$parent.$eval(b.initDate):new Date,a.isActive=function(b){return 0===i.compare(b.date,i.activeDate)?(a.activeDateId=b.uid,!0):!1},this.init=function(a){j=a,j.$render=function(){i.render()}},this.render=function(){if(j.$modelValue){var a=new Date(j.$modelValue),b=!isNaN(a);b?this.activeDate=a:f.error('Datepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),j.$setValidity("date",b)}this.refreshView()},this.refreshView=function(){if(this.element){this._refreshView();var a=j.$modelValue?new Date(j.$modelValue):null;j.$setValidity("date-disabled",!a||this.element&&!this.isDisabled(a))}},this.createDateObject=function(a,b){var c=j.$modelValue?new Date(j.$modelValue):null;return{date:a,label:g(a,b),selected:c&&0===this.compare(a,c),disabled:this.isDisabled(a),current:0===this.compare(a,new Date)}},this.isDisabled=function(c){return this.minDate&&this.compare(c,this.minDate)<0||this.maxDate&&this.compare(c,this.maxDate)>0||b.dateDisabled&&a.dateDisabled({date:c,mode:a.datepickerMode})},this.split=function(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c},a.select=function(b){if(a.datepickerMode===i.minMode){var c=j.$modelValue?new Date(j.$modelValue):new Date(0,0,0,0,0,0,0);c.setFullYear(b.getFullYear(),b.getMonth(),b.getDate()),j.$setViewValue(c),j.$render()}else i.activeDate=b,a.datepickerMode=i.modes[i.modes.indexOf(a.datepickerMode)-1]},a.move=function(a){var b=i.activeDate.getFullYear()+a*(i.step.years||0),c=i.activeDate.getMonth()+a*(i.step.months||0);i.activeDate.setFullYear(b,c,1),i.refreshView()},a.toggleMode=function(b){b=b||1,a.datepickerMode===i.maxMode&&1===b||a.datepickerMode===i.minMode&&-1===b||(a.datepickerMode=i.modes[i.modes.indexOf(a.datepickerMode)+b])},a.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};var k=function(){e(function(){i.element[0].focus()},0,!1)};a.$on("datepicker.focus",k),a.keydown=function(b){var c=a.keys[b.which];if(c&&!b.shiftKey&&!b.altKey)if(b.preventDefault(),b.stopPropagation(),"enter"===c||"space"===c){if(i.isDisabled(i.activeDate))return;a.select(i.activeDate),k()}else!b.ctrlKey||"up"!==c&&"down"!==c?(i.handleKeyDown(c,b),i.refreshView()):(a.toggleMode("up"===c?1:-1),k())}}]).directive("datepicker",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/datepicker.html",scope:{datepickerMode:"=?",dateDisabled:"&"},require:["datepicker","?^ngModel"],controller:"DatepickerController",link:function(a,b,c,d){var e=d[0],f=d[1];f&&e.init(f)}}}).directive("daypicker",["dateFilter",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/day.html",require:"^datepicker",link:function(b,c,d,e){function f(a,b){return 1!==b||a%4!==0||a%100===0&&a%400!==0?i[b]:29}function g(a,b){var c=new Array(b),d=new Date(a),e=0;for(d.setHours(12);b>e;)c[e++]=new Date(d),d.setDate(d.getDate()+1);return c}function h(a){var b=new Date(a);b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1}b.showWeeks=e.showWeeks,e.step={months:1},e.element=c;var i=[31,28,31,30,31,30,31,31,30,31,30,31];e._refreshView=function(){var c=e.activeDate.getFullYear(),d=e.activeDate.getMonth(),f=new Date(c,d,1),i=e.startingDay-f.getDay(),j=i>0?7-i:-i,k=new Date(f);j>0&&k.setDate(-j+1);for(var l=g(k,42),m=0;42>m;m++)l[m]=angular.extend(e.createDateObject(l[m],e.formatDay),{secondary:l[m].getMonth()!==d,uid:b.uniqueId+"-"+m});b.labels=new Array(7);for(var n=0;7>n;n++)b.labels[n]={abbr:a(l[n].date,e.formatDayHeader),full:a(l[n].date,"EEEE")};if(b.title=a(e.activeDate,e.formatDayTitle),b.rows=e.split(l,7),b.showWeeks){b.weekNumbers=[];for(var o=h(b.rows[0][0].date),p=b.rows.length;b.weekNumbers.push(o++)<p;);}},e.compare=function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate())},e.handleKeyDown=function(a){var b=e.activeDate.getDate();if("left"===a)b-=1;else if("up"===a)b-=7;else if("right"===a)b+=1;else if("down"===a)b+=7;else if("pageup"===a||"pagedown"===a){var c=e.activeDate.getMonth()+("pageup"===a?-1:1);e.activeDate.setMonth(c,1),b=Math.min(f(e.activeDate.getFullYear(),e.activeDate.getMonth()),b)}else"home"===a?b=1:"end"===a&&(b=f(e.activeDate.getFullYear(),e.activeDate.getMonth()));e.activeDate.setDate(b)},e.refreshView()}}}]).directive("monthpicker",["dateFilter",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/month.html",require:"^datepicker",link:function(b,c,d,e){e.step={years:1},
e.element=c,e._refreshView=function(){for(var c=new Array(12),d=e.activeDate.getFullYear(),f=0;12>f;f++)c[f]=angular.extend(e.createDateObject(new Date(d,f,1),e.formatMonth),{uid:b.uniqueId+"-"+f});b.title=a(e.activeDate,e.formatMonthTitle),b.rows=e.split(c,3)},e.compare=function(a,b){return new Date(a.getFullYear(),a.getMonth())-new Date(b.getFullYear(),b.getMonth())},e.handleKeyDown=function(a){var b=e.activeDate.getMonth();if("left"===a)b-=1;else if("up"===a)b-=3;else if("right"===a)b+=1;else if("down"===a)b+=3;else if("pageup"===a||"pagedown"===a){var c=e.activeDate.getFullYear()+("pageup"===a?-1:1);e.activeDate.setFullYear(c)}else"home"===a?b=0:"end"===a&&(b=11);e.activeDate.setMonth(b)},e.refreshView()}}}]).directive("yearpicker",["dateFilter",function(){return{restrict:"EA",replace:!0,templateUrl:"template/datepicker/year.html",require:"^datepicker",link:function(a,b,c,d){function e(a){return parseInt((a-1)/f,10)*f+1}var f=d.yearRange;d.step={years:f},d.element=b,d._refreshView=function(){for(var b=new Array(f),c=0,g=e(d.activeDate.getFullYear());f>c;c++)b[c]=angular.extend(d.createDateObject(new Date(g+c,0,1),d.formatYear),{uid:a.uniqueId+"-"+c});a.title=[b[0].label,b[f-1].label].join(" - "),a.rows=d.split(b,5)},d.compare=function(a,b){return a.getFullYear()-b.getFullYear()},d.handleKeyDown=function(a){var b=d.activeDate.getFullYear();"left"===a?b-=1:"up"===a?b-=5:"right"===a?b+=1:"down"===a?b+=5:"pageup"===a||"pagedown"===a?b+=("pageup"===a?-1:1)*d.step.years:"home"===a?b=e(d.activeDate.getFullYear()):"end"===a&&(b=e(d.activeDate.getFullYear())+f-1),d.activeDate.setFullYear(b)},d.refreshView()}}}]).constant("datepickerPopupConfig",{datepickerPopup:"yyyy-MM-dd",currentText:"Today",clearText:"Clear",closeText:"Done",closeOnDateSelection:!0,appendToBody:!1,showButtonBar:!0}).directive("datepickerPopup",["$compile","$parse","$document","$position","dateFilter","dateParser","datepickerPopupConfig",function(a,b,c,d,e,f,g){return{restrict:"EA",require:"ngModel",scope:{isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",dateDisabled:"&"},link:function(h,i,j,k){function l(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function m(a){if(a){if(angular.isDate(a)&&!isNaN(a))return k.$setValidity("date",!0),a;if(angular.isString(a)){var b=f.parse(a,n)||new Date(a);return isNaN(b)?void k.$setValidity("date",!1):(k.$setValidity("date",!0),b)}return void k.$setValidity("date",!1)}return k.$setValidity("date",!0),null}var n,o=angular.isDefined(j.closeOnDateSelection)?h.$parent.$eval(j.closeOnDateSelection):g.closeOnDateSelection,p=angular.isDefined(j.datepickerAppendToBody)?h.$parent.$eval(j.datepickerAppendToBody):g.appendToBody;h.showButtonBar=angular.isDefined(j.showButtonBar)?h.$parent.$eval(j.showButtonBar):g.showButtonBar,h.getText=function(a){return h[a+"Text"]||g[a+"Text"]},j.$observe("datepickerPopup",function(a){n=a||g.datepickerPopup,k.$render()});var q=angular.element("<div datepicker-popup-wrap><div datepicker></div></div>");q.attr({"ng-model":"date","ng-change":"dateSelection()"});var r=angular.element(q.children()[0]);j.datepickerOptions&&angular.forEach(h.$parent.$eval(j.datepickerOptions),function(a,b){r.attr(l(b),a)}),angular.forEach(["minDate","maxDate"],function(a){j[a]&&(h.$parent.$watch(b(j[a]),function(b){h[a]=b}),r.attr(l(a),a))}),j.dateDisabled&&r.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),k.$parsers.unshift(m),h.dateSelection=function(a){angular.isDefined(a)&&(h.date=a),k.$setViewValue(h.date),k.$render(),o&&(h.isOpen=!1,i[0].focus())},i.bind("input change keyup",function(){h.$apply(function(){h.date=k.$modelValue})}),k.$render=function(){var a=k.$viewValue?e(k.$viewValue,n):"";i.val(a),h.date=m(k.$modelValue)};var s=function(a){h.isOpen&&a.target!==i[0]&&h.$apply(function(){h.isOpen=!1})},t=function(a){h.keydown(a)};i.bind("keydown",t),h.keydown=function(a){27===a.which?(a.preventDefault(),a.stopPropagation(),h.close()):40!==a.which||h.isOpen||(h.isOpen=!0)},h.$watch("isOpen",function(a){a?(h.$broadcast("datepicker.focus"),h.position=p?d.offset(i):d.position(i),h.position.top=h.position.top+i.prop("offsetHeight"),c.bind("click",s)):c.unbind("click",s)}),h.select=function(a){if("today"===a){var b=new Date;angular.isDate(k.$modelValue)?(a=new Date(k.$modelValue),a.setFullYear(b.getFullYear(),b.getMonth(),b.getDate())):a=new Date(b.setHours(0,0,0,0))}h.dateSelection(a)},h.close=function(){h.isOpen=!1,i[0].focus()};var u=a(q)(h);p?c.find("body").append(u):i.after(u),h.$on("$destroy",function(){u.remove(),i.unbind("keydown",t),c.unbind("click",s)})}}}]).directive("datepickerPopupWrap",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datepicker/popup.html",link:function(a,b){b.bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}}),angular.module("ui.bootstrap.dropdown",[]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(a){var b=null;this.open=function(e){b||(a.bind("click",c),a.bind("keydown",d)),b&&b!==e&&(b.isOpen=!1),b=e},this.close=function(e){b===e&&(b=null,a.unbind("click",c),a.unbind("keydown",d))};var c=function(a){a&&a.isDefaultPrevented()||b.$apply(function(){b.isOpen=!1})},d=function(a){27===a.which&&(b.focusToggleElement(),c())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(a,b,c,d,e,f){var g,h=this,i=a.$new(),j=d.openClass,k=angular.noop,l=b.onToggle?c(b.onToggle):angular.noop;this.init=function(d){h.$element=d,b.isOpen&&(g=c(b.isOpen),k=g.assign,a.$watch(g,function(a){i.isOpen=!!a}))},this.toggle=function(a){return i.isOpen=arguments.length?!!a:!i.isOpen},this.isOpen=function(){return i.isOpen},i.focusToggleElement=function(){h.toggleElement&&h.toggleElement[0].focus()},i.$watch("isOpen",function(b,c){f[b?"addClass":"removeClass"](h.$element,j),b?(i.focusToggleElement(),e.open(i)):e.close(i),k(a,b),angular.isDefined(b)&&b!==c&&l(a,{open:!!b})}),a.$on("$locationChangeSuccess",function(){i.isOpen=!1}),a.$on("$destroy",function(){i.$destroy()})}]).directive("dropdown",function(){return{restrict:"CA",controller:"DropdownController",link:function(a,b,c,d){d.init(b)}}}).directive("dropdownToggle",function(){return{restrict:"CA",require:"?^dropdown",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.attr({"aria-haspopup":!0,"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}}),angular.module("ui.bootstrap.modal",["ui.bootstrap.transition"]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$timeout",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(b){b.animate=!1,a(function(){b.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(a,b){return b.templateUrl||"template/modal/window.html"},link:function(c,d,e){d.addClass(e.windowClass||""),c.size=e.size,b(function(){c.animate=!0,d[0].focus()}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).factory("$modalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d,e,f){function g(){for(var a=-1,b=n.keys(),c=0;c<b.length;c++)n.get(b[c]).value.backdrop&&(a=c);return a}function h(a){var b=c.find("body").eq(0),d=n.get(a).value;n.remove(a),j(d.modalDomEl,d.modalScope,300,function(){d.modalScope.$destroy(),b.toggleClass(m,n.length()>0),i()})}function i(){if(k&&-1==g()){var a=l;j(k,l,150,function(){a.$destroy(),a=null}),k=void 0,l=void 0}}function j(c,d,e,f){function g(){g.done||(g.done=!0,c.remove(),f&&f())}d.animate=!1;var h=a.transitionEndEventName;if(h){var i=b(g,e);c.bind(h,function(){b.cancel(i),g(),d.$apply()})}else b(g,0)}var k,l,m="modal-open",n=f.createNew(),o={};return e.$watch(g,function(a){l&&(l.index=a)}),c.bind("keydown",function(a){var b;27===a.which&&(b=n.top(),b&&b.value.keyboard&&(a.preventDefault(),e.$apply(function(){o.dismiss(b.key,"escape key press")})))}),o.open=function(a,b){n.add(a,{deferred:b.deferred,modalScope:b.scope,backdrop:b.backdrop,keyboard:b.keyboard});var f=c.find("body").eq(0),h=g();h>=0&&!k&&(l=e.$new(!0),l.index=h,k=d("<div modal-backdrop></div>")(l),f.append(k));var i=angular.element("<div modal-window></div>");i.attr({"template-url":b.windowTemplateUrl,"window-class":b.windowClass,size:b.size,index:n.length()-1,animate:"animate"}).html(b.content);var j=d(i)(b.scope);n.top().value.modalDomEl=j,f.append(j),f.addClass(m)},o.close=function(a,b){var c=n.get(a).value;c&&(c.deferred.resolve(b),h(a))},o.dismiss=function(a,b){var c=n.get(a).value;c&&(c.deferred.reject(b),h(a))},o.dismissAll=function(a){for(var b=this.getTop();b;)this.dismiss(b.key,a),b=this.getTop()},o.getTop=function(){return n.top()},o}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass,windowTemplateUrl:b.windowTemplateUrl,size:b.size})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse",function(a,b,c){var d=this,e={$setViewValue:angular.noop},f=b.numPages?c(b.numPages).assign:angular.noop;this.init=function(f,g){e=f,this.config=g,e.$render=function(){d.render()},b.itemsPerPage?a.$parent.$watch(c(b.itemsPerPage),function(b){d.itemsPerPage=parseInt(b,10),a.totalPages=d.calculateTotalPages()}):this.itemsPerPage=g.itemsPerPage},this.calculateTotalPages=function(){var b=this.itemsPerPage<1?1:Math.ceil(a.totalItems/this.itemsPerPage);return Math.max(b||0,1)},this.render=function(){a.page=parseInt(e.$viewValue,10)||1},a.selectPage=function(b){a.page!==b&&b>0&&b<=a.totalPages&&(e.$setViewValue(b),e.$render())},a.getText=function(b){return a[b+"Text"]||d.config[b+"Text"]},a.noPrevious=function(){return 1===a.page},a.noNext=function(){return a.page===a.totalPages},a.$watch("totalItems",function(){a.totalPages=d.calculateTotalPages()}),a.$watch("totalPages",function(b){f(a.$parent,b),a.page>b?a.selectPage(b):e.$render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function(a,b){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(c,d,e,f){function g(a,b,c){return{number:a,text:b,active:c}}function h(a,b){var c=[],d=1,e=b,f=angular.isDefined(k)&&b>k;f&&(l?(d=Math.max(a-Math.floor(k/2),1),e=d+k-1,e>b&&(e=b,d=e-k+1)):(d=(Math.ceil(a/k)-1)*k+1,e=Math.min(d+k-1,b)));for(var h=d;e>=h;h++){var i=g(h,h,h===a);c.push(i)}if(f&&!l){if(d>1){var j=g(d-1,"...",!1);c.unshift(j)}if(b>e){var m=g(e+1,"...",!1);c.push(m)}}return c}var i=f[0],j=f[1];if(j){var k=angular.isDefined(e.maxSize)?c.$parent.$eval(e.maxSize):b.maxSize,l=angular.isDefined(e.rotate)?c.$parent.$eval(e.rotate):b.rotate;c.boundaryLinks=angular.isDefined(e.boundaryLinks)?c.$parent.$eval(e.boundaryLinks):b.boundaryLinks,c.directionLinks=angular.isDefined(e.directionLinks)?c.$parent.$eval(e.directionLinks):b.directionLinks,i.init(j,b),e.maxSize&&c.$parent.$watch(a(e.maxSize),function(a){k=parseInt(a,10),i.render()});var m=i.render;i.render=function(){m(),c.page>0&&c.page<=c.totalPages&&(c.pages=h(c.page,c.totalPages))}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(a){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(b,c,d,e){var f=e[0],g=e[1];g&&(b.align=angular.isDefined(d.align)?b.$parent.$eval(d.align):a.align,f.init(g,a))}}}]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function a(a){var b=/[A-Z]/g,c="-";return a.replace(b,function(a,b){return(b?c:"")+a.toLowerCase()})}var b={placement:"top",animation:!0,popupDelay:0},c={mouseenter:"mouseleave",click:"click",focus:"blur"},d={};this.options=function(a){angular.extend(d,a)},this.setTriggers=function(a){angular.extend(c,a)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function(e,f,g,h,i,j,k){return function(e,l,m){function n(a){var b=a||o.trigger||m,d=c[b]||b;return{show:b,hide:d}}var o=angular.extend({},b,d),p=a(e),q=k.startSymbol(),r=k.endSymbol(),s="<div "+p+'-popup title="'+q+"tt_title"+r+'" content="'+q+"tt_content"+r+'" placement="'+q+"tt_placement"+r+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var a=f(s);return function(b,c,d){function f(){b.tt_isOpen?m():k()}function k(){(!y||b.$eval(d[l+"Enable"]))&&(b.tt_popupDelay?v||(v=g(p,b.tt_popupDelay,!1),v.then(function(a){a()})):p()())}function m(){b.$apply(function(){q()})}function p(){return v=null,u&&(g.cancel(u),u=null),b.tt_content?(r(),t.css({top:0,left:0,display:"block"}),w?i.find("body").append(t):c.after(t),z(),b.tt_isOpen=!0,b.$digest(),z):angular.noop}function q(){b.tt_isOpen=!1,g.cancel(v),v=null,b.tt_animation?u||(u=g(s,500)):s()}function r(){t&&s(),t=a(b,function(){}),b.$digest()}function s(){u=null,t&&(t.remove(),t=null)}var t,u,v,w=angular.isDefined(o.appendToBody)?o.appendToBody:!1,x=n(void 0),y=angular.isDefined(d[l+"Enable"]),z=function(){var a=j.positionElements(c,t,b.tt_placement,w);a.top+="px",a.left+="px",t.css(a)};b.tt_isOpen=!1,d.$observe(e,function(a){b.tt_content=a,!a&&b.tt_isOpen&&q()}),d.$observe(l+"Title",function(a){b.tt_title=a}),d.$observe(l+"Placement",function(a){b.tt_placement=angular.isDefined(a)?a:o.placement}),d.$observe(l+"PopupDelay",function(a){var c=parseInt(a,10);b.tt_popupDelay=isNaN(c)?o.popupDelay:c});var A=function(){c.unbind(x.show,k),c.unbind(x.hide,m)};d.$observe(l+"Trigger",function(a){A(),x=n(a),x.show===x.hide?c.bind(x.show,f):(c.bind(x.show,k),c.bind(x.hide,m))});var B=b.$eval(d[l+"Animation"]);b.tt_animation=angular.isDefined(B)?!!B:o.animation,d.$observe(l+"AppendToBody",function(a){w=angular.isDefined(a)?h(a)(b):w}),w&&b.$on("$locationChangeSuccess",function(){b.tt_isOpen&&q()}),b.$on("$destroy",function(){g.cancel(u),g.cancel(v),A(),s()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function(a){return a("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function(a){return a("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function(a){return a("popover","popover","click")}]),angular.module("ui.bootstrap.progressbar",[]).constant("progressConfig",{animate:!0,max:100}).controller("ProgressController",["$scope","$attrs","progressConfig",function(a,b,c){var d=this,e=angular.isDefined(b.animate)?a.$parent.$eval(b.animate):c.animate;this.bars=[],a.max=angular.isDefined(b.max)?a.$parent.$eval(b.max):c.max,this.addBar=function(b,c){e||c.css({transition:"none"}),this.bars.push(b),b.$watch("value",function(c){b.percent=+(100*c/a.max).toFixed(2)}),b.$on("$destroy",function(){c=null,d.removeBar(b)})},this.removeBar=function(a){this.bars.splice(this.bars.indexOf(a),1)}}]).directive("progress",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",require:"progress",scope:{},templateUrl:"template/progressbar/progress.html"}}).directive("bar",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^progress",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/bar.html",link:function(a,b,c,d){d.addBar(a,b)}}}).directive("progressbar",function(){return{restrict:"EA",replace:!0,transclude:!0,controller:"ProgressController",scope:{value:"=",type:"@"},templateUrl:"template/progressbar/progressbar.html",link:function(a,b,c,d){d.addBar(a,angular.element(b.children()[0]))}}}),angular.module("ui.bootstrap.rating",[]).constant("ratingConfig",{max:5,stateOn:null,stateOff:null}).controller("RatingController",["$scope","$attrs","ratingConfig",function(a,b,c){var d={$setViewValue:angular.noop};this.init=function(e){d=e,d.$render=this.render,this.stateOn=angular.isDefined(b.stateOn)?a.$parent.$eval(b.stateOn):c.stateOn,this.stateOff=angular.isDefined(b.stateOff)?a.$parent.$eval(b.stateOff):c.stateOff;var f=angular.isDefined(b.ratingStates)?a.$parent.$eval(b.ratingStates):new Array(angular.isDefined(b.max)?a.$parent.$eval(b.max):c.max);a.range=this.buildTemplateObjects(f)},this.buildTemplateObjects=function(a){for(var b=0,c=a.length;c>b;b++)a[b]=angular.extend({index:b},{stateOn:this.stateOn,stateOff:this.stateOff},a[b]);return a},a.rate=function(b){!a.readonly&&b>=0&&b<=a.range.length&&(d.$setViewValue(b),d.$render())},a.enter=function(b){a.readonly||(a.value=b),a.onHover({value:b})},a.reset=function(){a.value=d.$viewValue,a.onLeave()},a.onKeydown=function(b){/(37|38|39|40)/.test(b.which)&&(b.preventDefault(),b.stopPropagation(),a.rate(a.value+(38===b.which||39===b.which?1:-1)))},this.render=function(){a.value=d.$viewValue}}]).directive("rating",function(){return{restrict:"EA",require:["rating","ngModel"],scope:{readonly:"=?",onHover:"&",onLeave:"&"},controller:"RatingController",templateUrl:"template/rating/rating.html",replace:!0,link:function(a,b,c,d){var e=d[0],f=d[1];f&&e.init(f)}}}),angular.module("ui.bootstrap.tabs",[]).controller("TabsetController",["$scope",function(a){var b=this,c=b.tabs=a.tabs=[];b.select=function(a){angular.forEach(c,function(b){b.active&&b!==a&&(b.active=!1,b.onDeselect())}),a.active=!0,a.onSelect()},b.addTab=function(a){c.push(a),1===c.length?a.active=!0:a.active&&b.select(a)},b.removeTab=function(a){var d=c.indexOf(a);if(a.active&&c.length>1){var e=d==c.length-1?d-1:d+1;b.select(c[e])}c.splice(d,1)}}]).directive("tabset",function(){return{restrict:"EA",transclude:!0,replace:!0,scope:{type:"@"},controller:"TabsetController",templateUrl:"template/tabs/tabset.html",link:function(a,b,c){a.vertical=angular.isDefined(c.vertical)?a.$parent.$eval(c.vertical):!1,a.justified=angular.isDefined(c.justified)?a.$parent.$eval(c.justified):!1}}}).directive("tab",["$parse",function(a){return{require:"^tabset",restrict:"EA",replace:!0,templateUrl:"template/tabs/tab.html",transclude:!0,scope:{active:"=?",heading:"@",onSelect:"&select",onDeselect:"&deselect"},controller:function(){},compile:function(b,c,d){return function(b,c,e,f){b.$watch("active",function(a){a&&f.select(b)}),b.disabled=!1,e.disabled&&b.$parent.$watch(a(e.disabled),function(a){b.disabled=!!a}),b.select=function(){b.disabled||(b.active=!0)},f.addTab(b),b.$on("$destroy",function(){f.removeTab(b)}),b.$transcludeFn=d}}}}]).directive("tabHeadingTransclude",[function(){return{restrict:"A",require:"^tab",link:function(a,b){a.$watch("headingElement",function(a){a&&(b.html(""),b.append(a))})}}}]).directive("tabContentTransclude",function(){function a(a){return a.tagName&&(a.hasAttribute("tab-heading")||a.hasAttribute("data-tab-heading")||"tab-heading"===a.tagName.toLowerCase()||"data-tab-heading"===a.tagName.toLowerCase())}return{restrict:"A",require:"^tabset",link:function(b,c,d){var e=b.$eval(d.tabContentTransclude);e.$transcludeFn(e.$parent,function(b){angular.forEach(b,function(b){a(b)?e.headingElement=b:c.append(b)})})}}}),angular.module("ui.bootstrap.timepicker",[]).constant("timepickerConfig",{hourStep:1,minuteStep:1,showMeridian:!0,meridians:null,readonlyInput:!1,mousewheel:!0}).controller("TimepickerController",["$scope","$attrs","$parse","$log","$locale","timepickerConfig",function(a,b,c,d,e,f){function g(){var b=parseInt(a.hours,10),c=a.showMeridian?b>0&&13>b:b>=0&&24>b;return c?(a.showMeridian&&(12===b&&(b=0),a.meridian===p[1]&&(b+=12)),b):void 0}function h(){var b=parseInt(a.minutes,10);return b>=0&&60>b?b:void 0}function i(a){return angular.isDefined(a)&&a.toString().length<2?"0"+a:a}function j(a){k(),o.$setViewValue(new Date(n)),l(a)}function k(){o.$setValidity("time",!0),a.invalidHours=!1,a.invalidMinutes=!1}function l(b){var c=n.getHours(),d=n.getMinutes();a.showMeridian&&(c=0===c||12===c?12:c%12),a.hours="h"===b?c:i(c),a.minutes="m"===b?d:i(d),a.meridian=n.getHours()<12?p[0]:p[1]}function m(a){var b=new Date(n.getTime()+6e4*a);n.setHours(b.getHours(),b.getMinutes()),j()}var n=new Date,o={$setViewValue:angular.noop},p=angular.isDefined(b.meridians)?a.$parent.$eval(b.meridians):f.meridians||e.DATETIME_FORMATS.AMPMS;this.init=function(c,d){o=c,o.$render=this.render;var e=d.eq(0),g=d.eq(1),h=angular.isDefined(b.mousewheel)?a.$parent.$eval(b.mousewheel):f.mousewheel;h&&this.setupMousewheelEvents(e,g),a.readonlyInput=angular.isDefined(b.readonlyInput)?a.$parent.$eval(b.readonlyInput):f.readonlyInput,this.setupInputEvents(e,g)};var q=f.hourStep;b.hourStep&&a.$parent.$watch(c(b.hourStep),function(a){q=parseInt(a,10)});var r=f.minuteStep;b.minuteStep&&a.$parent.$watch(c(b.minuteStep),function(a){r=parseInt(a,10)}),a.showMeridian=f.showMeridian,b.showMeridian&&a.$parent.$watch(c(b.showMeridian),function(b){if(a.showMeridian=!!b,o.$error.time){var c=g(),d=h();angular.isDefined(c)&&angular.isDefined(d)&&(n.setHours(c),j())}else l()}),this.setupMousewheelEvents=function(b,c){var d=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0};b.bind("mousewheel wheel",function(b){a.$apply(d(b)?a.incrementHours():a.decrementHours()),b.preventDefault()}),c.bind("mousewheel wheel",function(b){a.$apply(d(b)?a.incrementMinutes():a.decrementMinutes()),b.preventDefault()})},this.setupInputEvents=function(b,c){if(a.readonlyInput)return a.updateHours=angular.noop,void(a.updateMinutes=angular.noop);var d=function(b,c){o.$setViewValue(null),o.$setValidity("time",!1),angular.isDefined(b)&&(a.invalidHours=b),angular.isDefined(c)&&(a.invalidMinutes=c)};a.updateHours=function(){var a=g();angular.isDefined(a)?(n.setHours(a),j("h")):d(!0)},b.bind("blur",function(){!a.invalidHours&&a.hours<10&&a.$apply(function(){a.hours=i(a.hours)})}),a.updateMinutes=function(){var a=h();angular.isDefined(a)?(n.setMinutes(a),j("m")):d(void 0,!0)},c.bind("blur",function(){!a.invalidMinutes&&a.minutes<10&&a.$apply(function(){a.minutes=i(a.minutes)})})},this.render=function(){var a=o.$modelValue?new Date(o.$modelValue):null;isNaN(a)?(o.$setValidity("time",!1),d.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(a&&(n=a),k(),l())},a.incrementHours=function(){m(60*q)},a.decrementHours=function(){m(60*-q)},a.incrementMinutes=function(){m(r)},a.decrementMinutes=function(){m(-r)},a.toggleMeridian=function(){m(720*(n.getHours()<12?1:-1))}}]).directive("timepicker",function(){return{restrict:"EA",require:["timepicker","?^ngModel"],controller:"TimepickerController",replace:!0,scope:{},templateUrl:"template/timepicker/timepicker.html",link:function(a,b,c,d){var e=d[0],f=d[1];f&&e.init(f,b.find("input"))}}}),angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(a){var b=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(c){var d=c.match(b);if(!d)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+c+'".');return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(a,b,c,d,e,f,g){var h=[9,13,27,38,40];return{require:"ngModel",link:function(i,j,k,l){var m,n=i.$eval(k.typeaheadMinLength)||1,o=i.$eval(k.typeaheadWaitMs)||0,p=i.$eval(k.typeaheadEditable)!==!1,q=b(k.typeaheadLoading).assign||angular.noop,r=b(k.typeaheadOnSelect),s=k.typeaheadInputFormatter?b(k.typeaheadInputFormatter):void 0,t=k.typeaheadAppendToBody?i.$eval(k.typeaheadAppendToBody):!1,u=b(k.ngModel).assign,v=g.parse(k.typeahead),w=i.$new();i.$on("$destroy",function(){w.$destroy()});var x="typeahead-"+w.$id+"-"+Math.floor(1e4*Math.random());j.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":x});var y=angular.element("<div typeahead-popup></div>");y.attr({id:x,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(k.typeaheadTemplateUrl)&&y.attr("template-url",k.typeaheadTemplateUrl);var z=function(){w.matches=[],w.activeIdx=-1,j.attr("aria-expanded",!1)},A=function(a){return x+"-option-"+a};w.$watch("activeIdx",function(a){0>a?j.removeAttr("aria-activedescendant"):j.attr("aria-activedescendant",A(a))});var B=function(a){var b={$viewValue:a};q(i,!0),c.when(v.source(i,b)).then(function(c){var d=a===l.$viewValue;if(d&&m)if(c.length>0){w.activeIdx=0,w.matches.length=0;for(var e=0;e<c.length;e++)b[v.itemName]=c[e],w.matches.push({id:A(e),label:v.viewMapper(w,b),model:c[e]});w.query=a,w.position=t?f.offset(j):f.position(j),w.position.top=w.position.top+j.prop("offsetHeight"),j.attr("aria-expanded",!0)}else z();d&&q(i,!1)},function(){z(),q(i,!1)})};z(),w.query=void 0;var C;l.$parsers.unshift(function(a){return m=!0,a&&a.length>=n?o>0?(C&&d.cancel(C),C=d(function(){B(a)},o)):B(a):(q(i,!1),z()),p?a:a?void l.$setValidity("editable",!1):(l.$setValidity("editable",!0),a)}),l.$formatters.push(function(a){var b,c,d={};return s?(d.$model=a,s(i,d)):(d[v.itemName]=a,b=v.viewMapper(i,d),d[v.itemName]=void 0,c=v.viewMapper(i,d),b!==c?b:a)}),w.select=function(a){var b,c,e={};e[v.itemName]=c=w.matches[a].model,b=v.modelMapper(i,e),u(i,b),l.$setValidity("editable",!0),r(i,{$item:c,$model:b,$label:v.viewMapper(i,e)}),z(),d(function(){j[0].focus()},0,!1)},j.bind("keydown",function(a){0!==w.matches.length&&-1!==h.indexOf(a.which)&&(a.preventDefault(),40===a.which?(w.activeIdx=(w.activeIdx+1)%w.matches.length,w.$digest()):38===a.which?(w.activeIdx=(w.activeIdx?w.activeIdx:w.matches.length)-1,w.$digest()):13===a.which||9===a.which?w.$apply(function(){w.select(w.activeIdx)}):27===a.which&&(a.stopPropagation(),z(),w.$digest()))}),j.bind("blur",function(){m=!1});var D=function(a){j[0]!==a.target&&(z(),w.$digest())};e.bind("click",D),i.$on("$destroy",function(){e.unbind("click",D)});var E=a(y)(w);t?e.find("body").append(E):j.after(E)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(a,b,c){a.templateUrl=c.templateUrl,a.isOpen=function(){return a.matches.length>0},a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(a,b,c,d){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(e,f,g){var h=d(g.templateUrl)(e.$parent)||"template/typeahead/typeahead-match.html";a.get(h,{cache:b}).success(function(a){f.replaceWith(c(a.trim())(e))})}}}]).filter("typeaheadHighlight",function(){function a(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(b,c){return c?(""+b).replace(new RegExp(a(c),"gi"),"<strong>$&</strong>"):b}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function(a){a.put("template/accordion/accordion-group.html",'<div class="panel panel-default">\n  <div class="panel-heading">\n    <h4 class="panel-title">\n      <a class="accordion-toggle" ng-click="toggleOpen()" accordion-transclude="heading"><span ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></a>\n    </h4>\n  </div>\n  <div class="panel-collapse" collapse="!isOpen">\n\t  <div class="panel-body" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function(a){a.put("template/accordion/accordion.html",'<div class="panel-group" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function(a){a.put("template/alert/alert.html",'<div class="alert" ng-class="{\'alert-{{type || \'warning\'}}\': true, \'alert-dismissable\': closeable}" role="alert">\n    <button ng-show="closeable" type="button" class="close" ng-click="close()">\n        <span aria-hidden="true">&times;</span>\n        <span class="sr-only">Close</span>\n    </button>\n    <div ng-transclude></div>\n</div>\n')}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function(a){a.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="left carousel-control" ng-click="prev()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-left"></span></a>\n    <a class="right carousel-control" ng-click="next()" ng-show="slides.length > 1"><span class="glyphicon glyphicon-chevron-right"></span></a>\n</div>\n')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function(a){
a.put("template/carousel/slide.html","<div ng-class=\"{\n    'active': leaving || (active && !entering),\n    'prev': (next || active) && direction=='prev',\n    'next': (next || active) && direction=='next',\n    'right': direction=='prev',\n    'left': direction=='next'\n  }\" class=\"item text-center\" ng-transclude></div>\n")}]),angular.module("template/datepicker/datepicker.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/datepicker.html",'<div ng-switch="datepickerMode" role="application" ng-keydown="keydown($event)">\n  <daypicker ng-switch-when="day" tabindex="0"></daypicker>\n  <monthpicker ng-switch-when="month" tabindex="0"></monthpicker>\n  <yearpicker ng-switch-when="year" tabindex="0"></yearpicker>\n</div>')}]),angular.module("template/datepicker/day.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/day.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="{{5 + showWeeks}}"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n    <tr>\n      <th ng-show="showWeeks" class="text-center"></th>\n      <th ng-repeat="label in labels track by $index" class="text-center"><small aria-label="{{label.full}}">{{label.abbr}}</small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-show="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default btn-sm" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/month.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/month.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/datepicker/popup.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/popup.html",'<ul class="dropdown-menu" ng-style="{display: (isOpen && \'block\') || \'none\', top: position.top+\'px\', left: position.left+\'px\'}" ng-keydown="keydown($event)">\n\t<li ng-transclude></li>\n\t<li ng-if="showButtonBar" style="padding:10px 9px 2px">\n\t\t<span class="btn-group">\n\t\t\t<button type="button" class="btn btn-sm btn-info" ng-click="select(\'today\')">{{ getText(\'current\') }}</button>\n\t\t\t<button type="button" class="btn btn-sm btn-danger" ng-click="select(null)">{{ getText(\'clear\') }}</button>\n\t\t</span>\n\t\t<button type="button" class="btn btn-sm btn-success pull-right" ng-click="close()">{{ getText(\'close\') }}</button>\n\t</li>\n</ul>\n')}]),angular.module("template/datepicker/year.html",[]).run(["$templateCache",function(a){a.put("template/datepicker/year.html",'<table role="grid" aria-labelledby="{{uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left"></i></button></th>\n      <th colspan="3"><button id="{{uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm" ng-click="toggleMode()" tabindex="-1" style="width:100%;"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right"></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="row in rows track by $index">\n      <td ng-repeat="dt in row track by dt.date" class="text-center" role="gridcell" id="{{dt.uid}}" aria-disabled="{{!!dt.disabled}}">\n        <button type="button" style="width:100%;" class="btn btn-default" ng-class="{\'btn-info\': dt.selected, active: isActive(dt)}" ng-click="select(dt.date)" ng-disabled="dt.disabled" tabindex="-1"><span ng-class="{\'text-info\': dt.current}">{{dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(a){a.put("template/modal/backdrop.html",'<div class="modal-backdrop fade"\n     ng-class="{in: animate}"\n     ng-style="{\'z-index\': 1040 + (index && 1 || 0) + index*10}"\n></div>\n')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(a){a.put("template/modal/window.html",'<div tabindex="-1" role="dialog" class="modal fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog" ng-class="{\'modal-sm\': size == \'sm\', \'modal-lg\': size == \'lg\'}"><div class="modal-content" ng-transclude></div></div>\n</div>')}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function(a){a.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n</ul>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function(a){a.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(1)">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}"><a href ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(totalPages)">{{getText(\'last\')}}</a></li>\n</ul>')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function(a){a.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function(a){a.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function(a){a.put("template/popover/popover.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),angular.module("template/progressbar/bar.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/bar.html",'<div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: percent + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>')}]),angular.module("template/progressbar/progress.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/progress.html",'<div class="progress" ng-transclude></div>')}]),angular.module("template/progressbar/progressbar.html",[]).run(["$templateCache",function(a){a.put("template/progressbar/progressbar.html",'<div class="progress">\n  <div class="progress-bar" ng-class="type && \'progress-bar-\' + type" role="progressbar" aria-valuenow="{{value}}" aria-valuemin="0" aria-valuemax="{{max}}" ng-style="{width: percent + \'%\'}" aria-valuetext="{{percent | number:0}}%" ng-transclude></div>\n</div>')}]),angular.module("template/rating/rating.html",[]).run(["$templateCache",function(a){a.put("template/rating/rating.html",'<span ng-mouseleave="reset()" ng-keydown="onKeydown($event)" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="{{range.length}}" aria-valuenow="{{value}}">\n    <i ng-repeat="r in range track by $index" ng-mouseenter="enter($index + 1)" ng-click="rate($index + 1)" class="glyphicon" ng-class="$index < value && (r.stateOn || \'glyphicon-star\') || (r.stateOff || \'glyphicon-star-empty\')">\n        <span class="sr-only">({{ $index < value ? \'*\' : \' \' }})</span>\n    </i>\n</span>')}]),angular.module("template/tabs/tab.html",[]).run(["$templateCache",function(a){a.put("template/tabs/tab.html",'<li ng-class="{active: active, disabled: disabled}">\n  <a ng-click="select()" tab-heading-transclude>{{heading}}</a>\n</li>\n')}]),angular.module("template/tabs/tabset-titles.html",[]).run(["$templateCache",function(a){a.put("template/tabs/tabset-titles.html","<ul class=\"nav {{type && 'nav-' + type}}\" ng-class=\"{'nav-stacked': vertical}\">\n</ul>\n")}]),angular.module("template/tabs/tabset.html",[]).run(["$templateCache",function(a){a.put("template/tabs/tabset.html",'\n<div>\n  <ul class="nav nav-{{type || \'tabs\'}}" ng-class="{\'nav-stacked\': vertical, \'nav-justified\': justified}" ng-transclude></ul>\n  <div class="tab-content">\n    <div class="tab-pane" \n         ng-repeat="tab in tabs" \n         ng-class="{active: tab.active}"\n         tab-content-transclude="tab">\n    </div>\n  </div>\n</div>\n')}]),angular.module("template/timepicker/timepicker.html",[]).run(["$templateCache",function(a){a.put("template/timepicker/timepicker.html",'<table>\n\t<tbody>\n\t\t<tr class="text-center">\n\t\t\t<td><a ng-click="incrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n\t\t\t<td>&nbsp;</td>\n\t\t\t<td><a ng-click="incrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td>\n\t\t\t<td ng-show="showMeridian"></td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style="width:50px;" class="form-group" ng-class="{\'has-error\': invalidHours}">\n\t\t\t\t<input type="text" ng-model="hours" ng-change="updateHours()" class="form-control text-center" ng-mousewheel="incrementHours()" ng-readonly="readonlyInput" maxlength="2">\n\t\t\t</td>\n\t\t\t<td>:</td>\n\t\t\t<td style="width:50px;" class="form-group" ng-class="{\'has-error\': invalidMinutes}">\n\t\t\t\t<input type="text" ng-model="minutes" ng-change="updateMinutes()" class="form-control text-center" ng-readonly="readonlyInput" maxlength="2">\n\t\t\t</td>\n\t\t\t<td ng-show="showMeridian"><button type="button" class="btn btn-default text-center" ng-click="toggleMeridian()">{{meridian}}</button></td>\n\t\t</tr>\n\t\t<tr class="text-center">\n\t\t\t<td><a ng-click="decrementHours()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n\t\t\t<td>&nbsp;</td>\n\t\t\t<td><a ng-click="decrementMinutes()" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td>\n\t\t\t<td ng-show="showMeridian"></td>\n\t\t</tr>\n\t</tbody>\n</table>\n')}]),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function(a){a.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function(a){a.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-if="isOpen()" ng-style="{top: position.top+\'px\', left: position.left+\'px\'}" style="display: block;" role="listbox" aria-hidden="{{!isOpen()}}">\n    <li ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{match.id}}">\n        <div typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></div>\n    </li>\n</ul>')}]);"use strict";angular.module("ui.codemirror",[]).constant("uiCodemirrorConfig",{}).directive("uiCodemirror",["uiCodemirrorConfig","$timeout",function(uiCodemirrorConfig,$timeout){return{restrict:"EA",require:"?ngModel",priority:1,compile:function compile(){if(angular.isUndefined(window.CodeMirror)){throw new Error("ui-codemirror need CodeMirror to work... (o rly?)")}return function postLink(scope,iElement,iAttrs,ngModel){var options,opts,codeMirror,initialTextValue;initialTextValue=iElement.text();options=uiCodemirrorConfig.codemirror||{};opts=angular.extend({value:initialTextValue},options,scope.$eval(iAttrs.uiCodemirror),scope.$eval(iAttrs.uiCodemirrorOpts));if(iElement[0].tagName==="TEXTAREA"){codeMirror=window.CodeMirror.fromTextArea(iElement[0],opts)}else{iElement.html("");codeMirror=new window.CodeMirror(function(cm_el){iElement.append(cm_el)},opts)}if(iAttrs.uiCodemirror||iAttrs.uiCodemirrorOpts){var codemirrorDefaultsKeys=Object.keys(window.CodeMirror.defaults);scope.$watch(iAttrs.uiCodemirror||iAttrs.uiCodemirrorOpts,function updateOptions(newValues,oldValue){if(!angular.isObject(newValues)){return}codemirrorDefaultsKeys.forEach(function(key){if(newValues.hasOwnProperty(key)){if(oldValue&&newValues[key]===oldValue[key]){return}codeMirror.setOption(key,newValues[key])}})},true)}if(ngModel){ngModel.$formatters.push(function(value){if(angular.isUndefined(value)||value===null){return""}else if(angular.isObject(value)||angular.isArray(value)){throw new Error("ui-codemirror cannot use an object or an array as a model")}return value});ngModel.$render=function(){var safeViewValue=ngModel.$viewValue||"";codeMirror.setValue(safeViewValue)};codeMirror.on("change",function(instance){var newValue=instance.getValue();if(newValue!==ngModel.$viewValue){$timeout(function(){ngModel.$setViewValue(newValue)})}})}if(iAttrs.uiRefresh){scope.$watch(iAttrs.uiRefresh,function(newVal,oldVal){if(newVal!==oldVal){codeMirror.refresh()}})}scope.$on("CodeMirror",function(event,callback){if(angular.isFunction(callback)){callback(codeMirror)}else{throw new Error("the CodeMirror event requires a callback function")}});if(angular.isFunction(opts.onLoad)){opts.onLoad(codeMirror)}}}}}]);$(document).on("click",".check_box:not(.ng)",function(){var $this=$(this);if($this.hasClass("checked")){$this.removeClass("checked");$this.find("input").attr("checked",false)}else{$this.addClass("checked");$this.find("input").attr("checked",true)}});$(document).on("click",".display-checkbox-actions:not(.ng)",function(){$(".check_box.display-checkbox-actions input").each(function(index,item){});$(".checkbox-actions").show()});$(document).on("click",".select-all:not(.ng)",function(){$("#selected-all").fadeIn();$(this).hide();$(".select-none").show();$(".select-visible").show();$(".table-data .check_box").addClass("checked").find("input").attr("checked",true);$("#select-all-checkbox").val("1");$(".ch-actions").show()});$(document).on("click",".select-visible:not(.ng)",function(){$(this).hide();$(".select-none").show();$(".select-all").show();$("#selected-all").fadeOut();$(".table-data .check_box").addClass("checked").find("input").attr("checked",true);$("#select-all-checkbox").val("0");$(".ch-actions").show()});$(document).on("click",".select-none",function(){$(this).hide();$(".select-visible").show();$(".select-all").show();$("#selected-all").fadeOut();$(".table-data .check_box").removeClass("checked").find("input").attr("checked",false);$("#select-all-checkbox").val("0");$(".ch-actions").hide()});var del=new Array;del["lt"]="Ar tikrai norite ištrinti?";del["en"]="Are you sure want to delete?";del["se"]="Är du säker på att du vill ta bort?";if($!==undefined&&$.fancybox){$(".display-modal").fancybox({padding:0,autoDimensions:true})}if($!==undefined&&$.fancybox){$(document).on("click",".email-preview",function(event){$this=$(this);$.fancybox({type:"iframe",padding:0,autoDimensions:true,href:$this.attr("href"),width:800,height:574,autoSize:false});return false})}function subscribers(page,sort,items_per_page,segmentId,updateCount,callback){$("#loader").show();$("#total").parent().hide();var searchValue=$("#search2").val();$.post("/subscribers/view_data/"+$("#group").val()+"/"+$("#token").val()+"/"+page+"/"+$("#type").val()+"/"+searchValue+"/"+sort+"/"+items_per_page+"/"+segmentId+"/",$("#segment-rules-form").serialize(),function(data){var $total=$("#total");$total.html(data.total).parent().show();$("#total2").html(data.total);if(searchValue!=""){$("#total_text").hide();$("#total_found").show()}else{$("#total_text").show();$("#total_found").hide()}$("#loader").hide();if(updateCount){$("#refresh-data").show();$("#refresh-preloader").hide();$(".refresh-count").show();windowSegmentForm=$("#segment-rules-form").serialize()}$("#pages .paging a").click(function(){subscribers($(this).attr("rel"),sort,items_per_page,segmentId,updateCount,callback);return false});$("#pages .on_page a").click(function(){items_per_page=this.hash.replace(/#/,"");subscribers(1,sort,items_per_page,segmentId,updateCount,callback);return false});tables();callback(data)},"json")}function prepareTableForFixedCells(tbody){var $tbody=$(tbody);$tbody.filter("tr").each(function(key,row){$(row).find("td:eq(0), td:eq(1)").addClass("fixed-cell")});return $("<div>").append($tbody).html()}function getSelectValue($obj){if($obj.find('option[value="'+$obj.val()+'"]').length>0){return $obj.find('option[value="'+$obj.val()+'"]').html()}return $obj.val()}$(document).ready(function(){$(".select-wrap:not(.ng)").each(function(){$(this).children("span").eq(0).html(getSelectValue($(this).find("select")))});$(document).on("change",".select-wrap:not(.ng) select",function(){$(this).parents(".select-wrap").find("span").eq(0).html(getSelectValue($(this)))});$(document).on("change","select.redirect_links",function(){window.location=$(this).val()})});function tables(){$("table tr").not(".noaction").mouseover(function(){$(this).children("td").each(function(){$(this).addClass("over")})});$("table tr").mouseout(function(){$(this).children("td").each(function(){$(this).removeClass("over")})})}var error=new Array;error["lt"]="Užpildykite visus laukus.";error["en"]="Fill in all required fields.";error["se"]="Vänligen fyll i alla fält.";var valid=new validator;function validator(){field=error[lang];msg="";this.check=function(form){var id=form.id;var failed=false;$("form#"+id+" .required").each(function(){var id=$(this).attr("id");var label=$("label[@for="+id+"]");label.removeClass("error");if($(this).val()==""){label.addClass("error");failed=true;msg=field}});if(failed){$("div.message").addClass("error");$("div.message").html(msg).show()}return!failed}}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null}var interpolate_provider=function($interpolateProvider,$rootScopeProvider){$interpolateProvider.startSymbol("[[");$interpolateProvider.endSymbol("]]");if(window.location.href.indexOf("automation")!==-1){$rootScopeProvider.digestTtl(Number.MAX_VALUE)}};angular.module("MailerliteApp",["monospaced.elastic","ui.codemirror","ui.sortable","ngSanitize","infinite-scroll","ui.bootstrap","angular-md5","rt.encodeuri","MailerliteCore","ngAnimate","ngResource","angularFileUpload","duScroll","ngCookies","fileManagerApp","productPickerApp","mailerlite.translate","mailerlite.statistics","ui.tinymce","mailerlite.clipboard","ml.photoeditor"],interpolate_provider).config(["fileManagerProvider",function(fileManagerProvider){fileManagerProvider.setPath(FILEMANAGER_VIEWS_PATH)}]).config(["photoeditorProvider",function(photoeditorProvider){photoeditorProvider.setPath(PHOTOEDITOR_VIEWS_PATH)}]).config(["productPickerProvider",function(productPickerProvider){productPickerProvider.setPath(PRODUCTPICKER_VIEWS_PATH)}]).config(["statisticsProvider",function(statisticsProvider){statisticsProvider.setStatisticsEndpointUrl(window.STATISTICS_ENDPOINT);statisticsProvider.setMode("api");statisticsProvider.setDefaultFeature("app");statisticsProvider.setDefaultAccountId(X_MAILER_ACCOUNT)}]).config(["translateProvider",function(translateProvider){translateProvider.setLocale(TRANSLATES_LOCALE);translateProvider.setDefaultCategory(TRANSLATES_CATEGORY);translateProvider.setTranslatesEndpointUrl(API_BASE_URL+"/actions/translations/categories/values");translateProvider.setMissingTranslatesEndpointUrl("/translations/create");translateProvider.setAuthorizationHeaders(X_MAILER_ACCOUNT,X_MAILER_TOKEN)}]);angular.module("MailerliteCore",[],interpolate_provider).constant("POPOVERS_PATH","/cbuilder/getPopover/&name=").constant("POPOVERS_WRAPPED_PATH","/cbuilder/getPopoverByConfig/&config=");angular.module("MailerliteApp").run(["$rootScope","fileManagerService","UserPermissions",function($rootScope,fileManagerService,UserPermissions){$rootScope.hasPermissions=UserPermissions.hasPermissions;$rootScope.hasCampaignAccess=UserPermissions.hasCampaignAccess;$rootScope.hasGroupAccess=UserPermissions.hasGroupAccess;$rootScope.ml=function(){window.ml.apply(null,arguments)};$rootScope.activateFileManager=function(callback){fileManagerService.activate({mode:"select"},function(file){if(file){callback(file)}})}}]);angular.module("MailerliteApp").factory("myInterceptor",["$q","$injector",function($q,$injector){var myInterceptor={response:function(response){var statisticsService=$injector.get("statisticsService");var data={accountId:window.X_MAILER_ACCOUNT||0,feature:"Http responses",version:response.status,info:{response:response}};return response},responseError:function(response){var statisticsService=$injector.get("statisticsService");var data={accountId:window.X_MAILER_ACCOUNT||0,feature:"Http responses",version:response.status,info:{response:response}};if(response.status===401){var $http=$injector.get("$http");var deferred=$q.defer();if(!response.config.headers["X-MailerLite-Account"]){if(window.X_MAILER_ACCOUNT){$http.get("/users/log_missing_account_header/"+window.X_MAILER_TOKEN);response.config.headers["X-MailerLite-Account"]=window.X_MAILER_ACCOUNT}else{window.location="/users/account_missing/"+window.X_MAILER_TOKEN;return $q.reject(response)}}$http.post("/users/renew_token/"+window.X_MAILER_TOKEN+"/"+readCookie("PHPSESSID"),response).success(function(data){if(data.token){window.X_MAILER_TOKEN=data.token;response.config.headers["X-MailerLite-Token"]=data.token;$http.defaults.headers.common["X-MailerLite-Token"]=data.token;deferred.resolve()}else{deferred.reject(response)}}).error(function(){deferred.reject(response)});return deferred.promise.then(function(){if(response.config.url.indexOf(window.API_BASE_URL)!==-1){return $http(response.config)}return $q.reject(response)})}return $q.reject(response)}};return myInterceptor}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("myInterceptor")}]);angular.module("MailerliteApp").directive("popoverWorkflowSteps",["$compile","$timeout",function($compile,$timeout){return function(scope,element,attrs){element.popover({html:true,trigger:"manual",placement:"auto",container:".ml-workflow-builder-area",viewport:{selector:".ml-workflow-builder-area",padding:30},template:'<div class="popover workflow-steps" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>',content:function(){var parentNext=attrs.popoverWorkflowSteps||"next";var content=$("#step_popover").html();content=content.replace(/PARENT_NEXT/g,parentNext);return $compile(content)(scope)}});element.click(function(e){var params={skipId:element.attr("aria-describedby")};window.closeAllPopovers(params);element.popover("show")})}}]).directive("popoverSelector",["$compile","$timeout",function($compile,$timeout){return function(scope,element,attrs){element.popover({html:true,trigger:"manual",placement:"bottom",container:".automation-controller",template:'<div class="popover workflow-steps" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>',content:function(){var content=$("#incomplete_popover").html();$timeout(function(){});return $compile(content)(scope)}});element.click(function(e){var params={skipId:element.attr("aria-describedby")};window.closeAllPopovers(params);element.popover("show")})}}]).directive("toggle",[function(){return function(scope,element,attrs){if(attrs["toggle"]==="popover"){element.popover({html:true,template:'<div class="popover help" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>'})}}}]).directive("bootstrapSwitch",[function(){return function(scope,element,attrs){element.bootstrapSwitch();window.activationSwitch=element;element.closest(".bootstrap-switch-container").find("*").click(function(){if(element.bootstrapSwitch("disabled")){$(".incomplete-steps > a").click()}});setSwitchOptions(null,scope.incompleteSteps.length);scope.$on("incompleteStepsCount",setSwitchOptions);function setSwitchOptions(event,count){if(count===0){element.bootstrapSwitch("disabled",false);element.bootstrapSwitch("state",scope.automation.active==1)}else{element.bootstrapSwitch("state",false);element.bootstrapSwitch("disabled",true)}}element.on("switchChange.bootstrapSwitch",function(event,state){scope.$broadcast("workflowStateChange",state)})}}]).directive("generateTooltip",["$timeout",function($timeout){return function(scope,element,attrs){$timeout(function(){$(element).attr("title",$(element).text().trim());$(element).tooltip()})}}]).directive("addStepTextToAllSteps",["$timeout",function($timeout){return{scope:{allSteps:"=addStepTextToAllSteps",stepId:"="},link:function(scope,element,attrs){$timeout(function(){var stepTextValue=$(element).text().trim();scope.allSteps.push({stepId:String(scope.stepId),stepValue:stepTextValue})},5e3)}}}]).directive("checkStep",[function(){return{scope:{step:"=checkStep",stepIndex:"=stepIndex"},link:function(scope,element,attrs){if(scope.stepIndex>0){var removeIds=[];(function recursiveWalk(stepArray){stepArray.forEach(function(step){if(step&&step.id&&step.next){removeIds.push(step.id);recursiveWalk(step.next)}})})([scope.step]);window.drop_faulty_steps(removeIds)}}}}]);$(document).on("click",function(e){var popoverSelector='.popover-content, [aria-describedby^="popover"], .btn-add';var targetIsPopover=$(e.target).is(popoverSelector)||$(e.target).parents(popoverSelector).is(popoverSelector);if(targetIsPopover){return}window.closeAllPopovers()});window.closeAllPopovers=function(params){$(".popover").each(function(index,value){if(params){if(params.skipId&&$(value).attr("id")===params.skipId){return}}$('[aria-describedby="'+$(value).attr("id")+'"]').popover("hide")})};angular.module("MailerliteCore").directive("amChart",function(){return{restrict:"AE",link:function(scope,element,attrs){scope.$watch(attrs.amChart,function(){var chartEnv;var legendEnv;var chartDataEnv;var chartColors;var chartAnimationEnv;var data=scope.$eval(attrs.amChart);chartDataEnv=data.data;chartColors=data.colors;chartAnimationEnv=data.animate;if($(element[0]).data("chartEnv")==undefined||!$(element[0]).data("chartEnv")){chartEnv=new AmCharts.AmPieChart;chartEnv.dataProvider=chartDataEnv;chartEnv.startDuration=chartAnimationEnv;chartEnv.titleField="title";chartEnv.valueField="number";chartEnv.labelRadius=30;chartEnv.labelsEnabled=false;chartEnv.labelText="[[title]]: [[percents]]%";chartEnv.balloonText="[[title]]: [[percents]]%";chartEnv.angle=0;chartEnv.pullOutRadius=0;chartEnv.depth3D=0;chartEnv.marginLeft=0;chartEnv.marginRight=0;chartEnv.marginTop=0;chartEnv.marginBottom=0;chartEnv.radius=90;chartEnv.colors=chartColors;legendEnv=new AmCharts.AmLegend;legendEnv.align="center";legendEnv.markerType="circle";legendEnv.switchType="x";legendEnv.position="right";legendEnv.valueText="[[percents]]%";chartEnv.addLegend(legendEnv);chartEnv.write($(element[0]).attr("id"));$(element[0]).data("chartEnv",chartEnv)}else{chartEnv=$(element[0]).data("chartEnv");chartEnv.dataProvider=chartDataEnv;chartEnv.colors=chartColors;chartEnv.validateData()}},true)}}});angular.module("MailerliteCore").directive("blinking",function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.blinking);var animating=false;var current_value=false;scope.$watch(model,function(value){current_value=value;if(value!==undefined&&!!value&&!animating){var speed=1e3;if(attrs.speed){speed=parseInt(scope.$eval(attrs.speed))}hideElement(speed);animating=true}});function hideElement(speed){$(element).animate({opacity:.3},speed,function(){showElement(speed)})}function showElement(speed){$(element).animate({opacity:1},speed,function(){if(current_value){hideElement(speed)}else{animating=false}})}}}});angular.module("MailerliteCore").directive("dragSplit",function(){return{require:"?ngModel",link:function(scope,element,attrs,controller){var is_clicked=false;$(element).mousedown(function(event){document.body.style.cursor="col-resize";is_clicked=true;return true});$(document).mousemove(function(e){if(is_clicked){e.preventDefault();var window_width=$(window).width(),split_value=window_width-e.pageX-$(element).outerWidth()/2;if(typeof attrs.min!=="undefined"&&split_value<parseInt(attrs.min)){split_value=parseInt(attrs.min)}if(typeof attrs.minLeft!=="undefined"&&window_width-split_value<parseInt(attrs.minLeft)){split_value=window_width-parseInt(attrs.minLeft)}scope.$apply(controller.$setViewValue(split_value));return true}}).mouseup(function(event){document.body.style.cursor="";is_clicked=false;return true})}}});angular.module("MailerliteCore").directive("ngFocusOnTrue",function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.ngFocusOnTrue)
;scope.$watch(model,function(value){if(value!==undefined&&!!value){$timeout(function(){element[0].focus()})}})}}});angular.module("MailerliteCore").factory("highchartsNGUtils",highchartsNGUtils).directive("highchart",["highchartsNGUtils","$timeout",highchart]);function highchartsNGUtils(){return{indexOf:function(arr,find,i){if(i===undefined)i=0;if(i<0)i+=arr.length;if(i<0)i=0;for(var n=arr.length;i<n;i++)if(i in arr&&arr[i]===find)return i;return-1},prependMethod:function(obj,method,func){var original=obj[method];obj[method]=function(){var args=Array.prototype.slice.call(arguments);func.apply(this,args);if(original){return original.apply(this,args)}else{return}}},deepExtend:function deepExtend(destination,source){if(angular.isArray(source)){destination=angular.isArray(destination)?destination:[];for(var i=0;i<source.length;i++){destination[i]=deepExtend(destination[i]||{},source[i])}}else if(angular.isObject(source)){for(var property in source){destination[property]=deepExtend(destination[property]||{},source[property])}}else{destination=source}return destination}}}function highchart(highchartsNGUtils,$timeout){var seriesId=0;var ensureIds=function(series){var changed=false;angular.forEach(series,function(s){if(!angular.isDefined(s.id)){s.id="series-"+seriesId++;changed=true}});return changed};var axisNames=["xAxis","yAxis"];var getMergedOptions=function(scope,element,config){var mergedOptions={};var defaultOptions={chart:{events:{}},title:{},subtitle:{},series:[],credits:{},plotOptions:{},navigator:{enabled:false}};if(config.options){mergedOptions=highchartsNGUtils.deepExtend(defaultOptions,config.options)}else{mergedOptions=defaultOptions}mergedOptions.chart.renderTo=element[0];angular.forEach(axisNames,function(axisName){if(angular.isDefined(config[axisName])){mergedOptions[axisName]=angular.copy(config[axisName]);if(angular.isDefined(config[axisName].currentMin)||angular.isDefined(config[axisName].currentMax)){highchartsNGUtils.prependMethod(mergedOptions.chart.events,"selection",function(e){var thisChart=this;if(e[axisName]){scope.$apply(function(){scope.config[axisName].currentMin=e[axisName][0].min;scope.config[axisName].currentMax=e[axisName][0].max})}else{scope.$apply(function(){scope.config[axisName].currentMin=thisChart[axisName][0].dataMin;scope.config[axisName].currentMax=thisChart[axisName][0].dataMax})}});highchartsNGUtils.prependMethod(mergedOptions.chart.events,"addSeries",function(e){scope.config[axisName].currentMin=this[axisName][0].min||scope.config[axisName].currentMin;scope.config[axisName].currentMax=this[axisName][0].max||scope.config[axisName].currentMax})}}});if(config.title){mergedOptions.title=config.title}if(config.subtitle){mergedOptions.subtitle=config.subtitle}if(config.credits){mergedOptions.credits=config.credits}if(config.size){if(config.size.width){mergedOptions.chart.width=config.size.width}if(config.size.height){mergedOptions.chart.height=config.size.height}}return mergedOptions};var updateZoom=function(axis,modelAxis){var extremes=axis.getExtremes();if(modelAxis.currentMin!==extremes.dataMin||modelAxis.currentMax!==extremes.dataMax){axis.setExtremes(modelAxis.currentMin,modelAxis.currentMax,false)}};var processExtremes=function(chart,axis,axisName){if(axis.currentMin||axis.currentMax){chart[axisName][0].setExtremes(axis.currentMin,axis.currentMax,true)}};var chartOptionsWithoutEasyOptions=function(options){return angular.extend({},options,{data:null,visible:null})};return{restrict:"EAC",replace:true,template:"<div></div>",scope:{config:"=",disableDataWatch:"="},link:function(scope,element,attrs){var prevSeriesOptions={};var processSeries=function(series){var i;var ids=[];if(series){var setIds=ensureIds(series);if(setIds){return false}angular.forEach(series,function(s){ids.push(s.id);var chartSeries=chart.get(s.id);if(chartSeries){if(!angular.equals(prevSeriesOptions[s.id],chartOptionsWithoutEasyOptions(s))){chartSeries.update(angular.copy(s),false)}else{if(s.visible!==undefined&&chartSeries.visible!==s.visible){chartSeries.setVisible(s.visible,false)}chartSeries.setData(angular.copy(s.data),false)}}else{chart.addSeries(angular.copy(s),false)}prevSeriesOptions[s.id]=chartOptionsWithoutEasyOptions(s)});if(scope.config.noData){var chartContainsData=false;for(i=0;i<series.length;i++){if(series[i].data&&series[i].data.length>0){chartContainsData=true;break}}if(!chartContainsData){chart.showLoading(scope.config.noData)}else{chart.hideLoading()}}}for(i=chart.series.length-1;i>=0;i--){var s=chart.series[i];if(s.options.id!=="highcharts-navigator-series"&&highchartsNGUtils.indexOf(ids,s.options.id)<0){s.remove(false)}}return true};var chart=false;var initChart=function(){if(chart)chart.destroy();prevSeriesOptions={};var config=scope.config||{};var mergedOptions=getMergedOptions(scope,element,config);var func=config.func||undefined;chart=config.useHighStocks?new Highcharts.StockChart(mergedOptions,func):new Highcharts.Chart(mergedOptions,func);for(var i=0;i<axisNames.length;i++){if(config[axisNames[i]]){processExtremes(chart,config[axisNames[i]],axisNames[i])}}if(config.loading){chart.showLoading()}config.getHighcharts=function(){return chart}};initChart();if(scope.disableDataWatch){scope.$watchCollection("config.series",function(newSeries,oldSeries){processSeries(newSeries);chart.redraw()})}else{scope.$watch("config.series",function(newSeries,oldSeries){var needsRedraw=processSeries(newSeries);if(needsRedraw){chart.redraw()}},true)}scope.$watch("config.title",function(newTitle){chart.setTitle(newTitle,true)},true);scope.$watch("config.subtitle",function(newSubtitle){chart.setTitle(true,newSubtitle)},true);scope.$watch("config.loading",function(loading){if(loading){chart.showLoading(loading===true?null:loading)}else{chart.hideLoading()}});scope.$watch("config.noData",function(noData){if(scope.config&&scope.config.loading){chart.showLoading(noData)}},true);scope.$watch("config.credits.enabled",function(enabled){if(enabled){chart.credits.show()}else if(chart.credits){chart.credits.hide()}});scope.$watch("config.useHighStocks",function(useHighStocks,oldUseHighStocks){if(useHighStocks===oldUseHighStocks)return;initChart()});angular.forEach(axisNames,function(axisName){scope.$watch("config."+axisName,function(newAxes,oldAxes){if(newAxes===oldAxes||!newAxes){return}if(angular.isArray(newAxes)){for(var axisIndex=0;axisIndex<newAxes.length;axisIndex++){var axis=newAxes[axisIndex];if(axisIndex<chart[axisName].length){chart[axisName][axisIndex].update(axis,false);updateZoom(chart[axisName][axisIndex],angular.copy(axis))}}}else{chart[axisName][0].update(newAxes,false);updateZoom(chart[axisName][0],angular.copy(newAxes))}chart.redraw()},true)});scope.$watch("config.options",function(newOptions,oldOptions,scope){if(newOptions===oldOptions)return;initChart();processSeries(scope.config.series);chart.redraw()},true);scope.$watch("config.size",function(newSize,oldSize){if(newSize===oldSize)return;if(newSize){chart.setSize(newSize.width||undefined,newSize.height||undefined)}},true);scope.$on("highchartsng.reflow",function(){chart.reflow()});scope.$on("$destroy",function(){if(chart){chart.destroy();$timeout(function(){element.remove()},0)}})}}}angular.module("MailerliteCore").directive("icheck",function(){return{require:"?ngModel",scope:{translate:"=",checked:"=icheckChecked"},link:function(scope,element,attrs,controller){$(element).iCheck({checkboxClass:"icheckbox_flat-green",radioClass:"iradio_flat-green"});if(scope.checked){$(element).iCheck("check")}$(element).on("ifChecked",function(event){$(element).parent().click();$(".input-group-btn").removeClass("open")});if(attrs.campaignId){$(element).parent().addClass("disabled");if(!attrs.isChecked){$(element).iCheck("disable")}}}}});angular.module("MailerliteCore").directive("inputMask",function(){return{restrict:"A",scope:{inputMask:"="},link:function(scope,element,attrs,controller){$(element).inputmask(scope.inputMask)}}});angular.module("MailerliteCore").directive("ngThumb",["$window","$sce",function($window,$sce){var helper={support:!!($window.FileReader&&$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){var type="|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(scope,element,attributes){if(!helper.support)return;var params=scope.params=scope.$eval(attributes.ngThumb);if(!helper.isFile(params.file))return;if(!helper.isImage(params.file))return;var canvas=element.find("canvas");var reader=new FileReader;scope.file=params.file;scope.$watch(attributes.ngThumb+".file",function(newFile){if(newFile){canvas=element.find("canvas");reader=new FileReader;reader.onload=onLoadFile;reader.readAsDataURL(newFile)}});function onLoadFile(event){var img=new Image;img.onload=onLoadImage;img.src=event.target.result}function onLoadImage(){if(!params.width){if(!params.height){params.width=this.width}else{params.width=this.width/this.height*params.height}}if(!params.height){if(!params.width){params.height=this.height}else{params.height=this.height/this.width*params.width}}var sizes=scaleImage(this.width,this.height,params.width,params.height,false);canvas.attr({width:params.width,height:params.height});canvas[0].getContext("2d").drawImage(this,0,0,this.width,this.height,sizes.targetleft,sizes.targettop,sizes.width,sizes.height)}function scaleImage(srcwidth,srcheight,targetwidth,targetheight,fLetterBox){var result={width:0,height:0,fScaleToTargetWidth:true};if(srcwidth<=0||srcheight<=0||targetwidth<=0||targetheight<=0){return result}var scaleX1=targetwidth;var scaleY1=srcheight*targetwidth/srcwidth;var scaleX2=srcwidth*targetheight/srcheight;var scaleY2=targetheight;var fScaleOnWidth=scaleX2>targetwidth;if(fScaleOnWidth){fScaleOnWidth=fLetterBox}else{fScaleOnWidth=!fLetterBox}if(fScaleOnWidth){result.width=Math.floor(scaleX1);result.height=Math.floor(scaleY1);result.fScaleToTargetWidth=true}else{result.width=Math.floor(scaleX2);result.height=Math.floor(scaleY2);result.fScaleToTargetWidth=false}result.targetleft=Math.floor((targetwidth-result.width)/2);result.targettop=Math.floor((targetheight-result.height)/2);return result}}}}]);angular.module("MailerliteCore").directive("niceLoad",["$timeout",function($timeout){return{scope:{src:"@"},link:function(scope,element,attrs){var loadImage;scope.$watch("src",function(newSrc){loadImage(newSrc)});loadImage=function(src){$(element[0]).css({opacity:0});img=new Image;img.src=src;img.onload=function(){$(element[0]).css({opacity:1})}}}}}]);angular.module("MailerliteCore").directive("ppopover",["$parse","$compile","$http","$timeout","$q","$templateCache","POPOVERS_PATH","POPOVERS_WRAPPED_PATH",function($parse,$compile,$http,$timeout,$q,$templateCache,POPOVERS_PATH,POPOVERS_WRAPPED_PATH){$("body").on("keyup",function(ev){if(ev.keyCode===27){$(".popover.in").each(function(){$(this).popover("hide")})}});$(document).on("mouseup",function(e){if($(".popover").has(e.target).length===0){$(".popover").toggleClass("in").remove();return}});return{restrict:"A",scope:true,controller:function($scope){$scope.save=function(){try{$scope.$parent.setPopoverData($scope.data)}catch(err){}};$scope.dismiss=function(){try{$scope.$parent.setPopoverData($scope.cancel_data)}catch(err){}$scope.hide()};$scope.inc=function(variable,inc,min,max){if(typeof min==="undefined"){min=0}if(typeof max==="undefined"){max=0}min=parseInt(min);max=parseInt(max);var value=parseInt($scope.$eval(variable))+parseInt(inc);if(value>=min&&(value<=max||max==0)){$scope.$eval(variable+" = "+value)}};$scope.returnVariable=null;$scope.slideRight=function(popover,variable_name){$scope.returnVariable=variable_name;$http.get(POPOVERS_PATH+popover,{cache:true,scope:false}).success(function(next_html){var $popover=$(".popover.in");var $wrapper=$popover.find(".popover-pages");var $current=$wrapper.find(".popover-page").removeClass("master").addClass("slave pull-left");next_html=$compile(next_html)($scope);$(next_html).removeClass("slave");$wrapper.css({width:"200%","margin-left":0});var $next=$(next_html).addClass("master pull-right");var margin_left="-100%";$wrapper.append($next);$wrapper.animate({"margin-left":margin_left},300,"swing",function(){var $slave=$wrapper.find(".slave").detach();$popover.data("back",$slave);$wrapper.find(".master").removeClass("pull-right").removeClass("master");$(this).removeAttr("style")})})};$scope.preview=function(return_value){if($scope.returnVariable!==null&&$scope.returnVariable!==undefined){$scope.$eval($scope.returnVariable+" = '"+return_value+"'")}};$scope.restorePreview=function(){var $popover=$(".popover.in");if($popover.data("back")===undefined){return}if($scope.returnVariable!==null&&$scope.returnVariable!==undefined){var parent_value=$scope.$parent.getPopoverDataByKey($scope.returnVariable.substring(5));$scope.$eval($scope.returnVariable+" = '"+parent_value+"'")}};$scope.slideBack=function(return_value){var $popover=$(".popover.in");if($popover.data("back")===undefined){$popover.popover("hide");return}$scope.$eval($scope.returnVariable+" = '"+return_value+"'");$scope.returnVariable=null;var $wrapper=$popover.find(".popover-pages");var $current=$wrapper.find(".popover-page").removeClass("master").addClass("slave pull-right");$wrapper.css({width:"200%","margin-left":"-100%"});var $next=$popover.data("back").removeClass("slave").addClass("master pull-left");var margin_left="0";$wrapper.append($next);$wrapper.animate({"margin-left":margin_left},300,"swing",function(){var $slave=$wrapper.find(".slave").detach();$popover.data("back",$slave);$wrapper.find(".master").removeClass("pull-right").removeClass("master");$(this).removeAttr("style")})}},link:function postLink(scope,element,attr,ctrl){var options={};$.post(POPOVERS_WRAPPED_PATH,{config:attr.ppopover},function(template){element.on("click",function(ev){scope.data={};try{scope.data=scope.$parent.getPopoverData();scope.cancel_data=angular.copy(scope.data)}catch(err){}if(attr.ngModel!==undefined){scope.returnVariable=attr.ngModel}$(".popover.in").each(function(){var $this=$(this),popover=$this.data("bs.popover");if(popover&&!popover.$element.is(element)){$this.popover("hide")}})});if(!!attr.hide){scope.$watch(attr.hide,function(newValue,oldValue){if(!!newValue){popover.hide()}else if(newValue!==oldValue){popover.show()}})}if(!!attr.show){scope.$watch(attr.show,function(newValue,oldValue){if(!!newValue){$timeout(function(){popover.show()})}else if(newValue!==oldValue){popover.hide()}})}element.popover(angular.extend({},options,{content:template,html:true,container:"body"}));var popover=element.data("bs.popover");popover.hasContent=function(){return this.getTitle()||template};popover.getPosition=function(){var r=$.fn.popover.Constructor.prototype.getPosition.apply(this,arguments);$compile(this.$tip)(scope);scope.$digest();this.$tip.data("bs.popover",this);return r};scope.$popover=function(name){popover(name)};angular.forEach(["show","hide"],function(name){scope[name]=function(){popover[name]()}});angular.forEach(["show.bs.popover","shown.bs.popover","hide.bs.popover","hidden.bs.popover"],function(name){element.on(name,function(ev){scope.$emit("popover-"+name,ev)})});element.on("hidden.bs.popover",function(ev){element.data("bs.popover").$tip.detach()})})}}}]);angular.module("MailerliteCore").directive("ngSelectOnTrue",function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.ngSelectOnTrue);scope.$watch(model,function(value){if(value!==undefined&&!!value){$timeout(function(){element[0].select()})}})}}});angular.module("MailerliteCore").directive("mlTagInput",function(ApiSubscribers,ApiTags,ApiGroups,$timeout,$filter){return{restrict:"E",scope:{subscriberTags:"=",createNewTagsForSubscriberId:"="},templateUrl:"/assets/js/core/views/mailerlite-tag-input.html",link:function(scope,element,attrs,controller){scope.tags=[];scope.loading=true;ApiTags.query(function(response){scope.tags=response;if(window.prefillGroup){var tagFiltered=scope.tags.filter(function(tag){return tag.id==window.prefillGroup});if(tagFiltered.length===1){scope.addSubscriberTag(tagFiltered[0])}}if(scope.createNewTagsForSubscriberId){ApiSubscribers.getGroups({id:scope.createNewTagsForSubscriberId},function(response){if(response&&response.length){response.forEach(function(tag){scope.addSubscriberTag(tag)})}initSelectize()})}else{initSelectize()}function initSelectize(){$timeout(function(){var selectize_options={plugins:{remove_button:{label:'<svg class="octicon octicon-x" viewBox="0 0 12 16" version="1.1" width="12" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.48 8l3.75 3.75-1.48 1.48L6 9.48l-3.75 3.75-1.48-1.48L4.52 8 .77 4.25l1.48-1.48L6 6.52l3.75-3.75 1.48 1.48z"/></svg>'}},delimiter:"",items:scope.subscriberTags.map(function(item){return item.id}),render:{option_create:function(data,escape){return'<div class="create">Add new group <strong>"'+escape(data.input)+'"</strong></div>'}},create:function(input,callback){ApiGroups.createGroup({name:input},function(response){scope.tags.push(response);callback({value:response.id,text:response.name})})},placeholder:$filter("translate")("Select subscriber groups or create a new group","new_subscriber_management")};var $select=$(element).find("select").selectize(selectize_options);var selectize=$select[0].selectize;selectize.on("item_add",function(value){var filtered_tags=scope.tags.filter(function(tag){return tag.id==value});if(filtered_tags.length){scope.subscriberTags.push(filtered_tags[0])}if(scope.createNewTagsForSubscriberId){ApiGroups.assignSubscriber({id:value,subscriber_id:scope.createNewTagsForSubscriberId,action:"assign",autoresponders:1})}});selectize.on("item_remove",function(value){var filtered_subscriberTags=scope.subscriberTags.filter(function(subscriberTag){return subscriberTag.id==value});if(filtered_subscriberTags.length){var index=scope.subscriberTags.indexOf(filtered_subscriberTags[0]);if(index!==-1){scope.subscriberTags.splice(index,1)}}if(scope.createNewTagsForSubscriberId){ApiGroups.assignSubscriber({id:value,subscriber_id:scope.createNewTagsForSubscriberId,action:"unassign",autoresponders:1})}});scope.$on("clearSelectize",function(){selectize.clear()});scope.loading=false})}});var subscriberTagsIds={};var subscriberTagsVars={};scope.addSubscriberTag=function(tag){scope.addTagToSubscriberTags(tag);scope.newTagName=""};scope.addTagToSubscriberTags=function(tag){if(!subscriberTagsIds[tag.id]){scope.subscriberTags.push(tag);subscriberTagsIds[tag.id]=true;subscriberTagsVars[tag.name]=true}};scope.removeTagFromSubscriberTags=function(tag){var index=scope.subscriberTags.indexOf(tag);tag=scope.subscriberTags.splice(index,1);if(tag&&tag[0]){delete subscriberTagsIds[tag[0].id];subscriberTagsVars[tag[0].name]=null}};scope.addTagToAccountTags=function(tag){var isResponseInTags=scope.tags.filter(function(item){return Number(item.id)===Number(tag.id)});if(!isResponseInTags){scope.tags.push(tag)}};scope.tagsFilterFn=function(tag){return!subscriberTagsIds[tag.id]};scope.autocompleteActive=false;scope.autocompleteIndex=undefined;scope.startAutocomplete=function(){scope.autocompleteActive=true;scope.autocompleteIndex=undefined};scope.stopAutocomplete=function(evt){scope.autocompleteActive=false;scope.autocompleteIndex=undefined};$(document).click(function(event){$timeout(function(){scope.stopAutocomplete()})});scope.autoTags=[];scope.$watch("newTagName",filterAutoTags);scope.$watch("tags.length",filterAutoTags);scope.$watch("subscriberTags.length",filterAutoTags);function filterAutoTags(){scope.autocompleteIndex=undefined;scope.autoTags=scope.tags.filter(function(tag){var id=tag.id||tag.value||"";var title=tag.title||tag.name||tag.text||"";var newTagName=scope.newTagName||"";return!subscriberTagsIds[id]&&title.toLowerCase().indexOf(newTagName.toLowerCase())>-1})}}}});angular.module("MailerliteCore").directive("timeLeft",function($filter){return{restrict:"A",scope:{translate:"="},link:function(scope,element,attrs,controller){var current=new Date(attrs.current.replace(" ","T")).getTime();var timestamp=new Date(attrs.date.replace(" ","T")).getTime();var inform_text="";var diff=(timestamp-current)/1e3/3600;var mins=parseInt((timestamp-current)/1e3/60-parseInt((timestamp-current)/1e3/3600)*60);if(diff<0){inform_text=scope.translate.ended}else if(diff<=1){inform_text=parseInt(mins)+" "+scope.translate.min}else if(diff<2){inform_text="1 "+scope.translate.hour+" "+parseInt(mins)+" "+scope.translate.min}else if(diff<24){inform_text=parseInt(diff)+" "+scope.translate.hours+" "+parseInt(mins)+" "+scope.translate.min}else if(diff>=24){var days=parseInt(diff/24);if(days<=1){inform_text=days+" "+scope.translate.day}else{inform_text=days+" "+scope.translate.days}inform_text=inform_text+" "+parseInt(diff-days*24)+" "+scope.translate.hours}if(diff>0)inform_text=inform_text+" "+scope.translate.left_text;$(element).html(inform_text)}}});angular.module("MailerliteApp").directive("bsSwitch",["$parse","$timeout",function($parse,$timeout){return{restrict:"A",require:"ngModel",link:function link(scope,element,attrs,controller){var isInit=false;var getTrueValue=function(){if(attrs.type==="radio"){return attrs.value||$parse(attrs.ngValue)(scope)||true}var trueValue=$parse(attrs.ngTrueValue)(scope);if(angular.isUndefined(trueValue)){trueValue=true}return trueValue};var getBooleanFromString=function(value){return scope.$eval(value)===true};var getBooleanFromStringDefTrue=function(value){return value===true||value==="true"||!value};var getValueOrUndefined=function(value){return value?value:undefined};var getExprFromString=function(value){if(angular.isUndefined(value)){return angular.noop}return function(){scope.$evalAsync(value)}};var getSwitchAttrValue=function(attrName){var map={switchRadioOff:getBooleanFromStringDefTrue,switchActive:function(value){return!getBooleanFromStringDefTrue(value)},switchAnimate:getBooleanFromStringDefTrue,switchLabel:function(value){return value?value:"&nbsp;"},switchIcon:function(value){if(value){return"<span class='"+value+"'></span>"}},switchWrapper:function(value){return value||"wrapper"},switchInverse:getBooleanFromString,switchReadonly:getBooleanFromString,switchChange:getExprFromString};var transFn=map[attrName]||getValueOrUndefined;return transFn(attrs[attrName])};var setSwitchParamMaybe=function(element,attr,modelAttr){if(!isInit){return}var newValue=getSwitchAttrValue(modelAttr);element.bootstrapSwitch(attr,newValue)};var setActive=function(){setSwitchParamMaybe(element,"disabled","switchActive")};var initMaybe=function(){if(!isInit){var viewValue=controller.$modelValue===getTrueValue();isInit=!isInit;element.bootstrapSwitch({radioAllOff:getSwitchAttrValue("switchRadioOff"),disabled:getSwitchAttrValue("switchActive"),state:viewValue,onText:getSwitchAttrValue("switchOnText"),offText:getSwitchAttrValue("switchOffText"),onColor:getSwitchAttrValue("switchOnColor"),offColor:getSwitchAttrValue("switchOffColor"),animate:getSwitchAttrValue("switchAnimate"),size:getSwitchAttrValue("switchSize"),labelText:attrs.switchLabel?getSwitchAttrValue("switchLabel"):getSwitchAttrValue("switchIcon"),wrapperClass:getSwitchAttrValue("switchWrapper"),handleWidth:getSwitchAttrValue("switchHandleWidth"),labelWidth:getSwitchAttrValue("switchLabelWidth"),inverse:getSwitchAttrValue("switchInverse"),readonly:getSwitchAttrValue("switchReadonly")});if(attrs.type==="radio"){controller.$setViewValue(controller.$modelValue)}else{controller.$setViewValue(viewValue)}}};var listenToModel=function(){attrs.$observe("switchActive",function(newValue){var active=getBooleanFromStringDefTrue(newValue);if(!active){$timeout(function(){setActive(active)})}else{setActive(active)}});function modelValue(){return controller.$modelValue}scope.$watch(modelValue,function(newValue){initMaybe();if(newValue!==undefined&&newValue!==null){element.bootstrapSwitch("state",newValue===getTrueValue(),false)}else{element.bootstrapSwitch("toggleIndeterminate",true,false)}},true);var bindings={switchRadioOff:"radioAllOff",switchOnText:"onText",switchOffText:"offText",switchOnColor:"onColor",switchOffColor:"offColor",switchAnimate:"animate",switchSize:"size",switchLabel:"labelText",switchIcon:"labelText",switchWrapper:"wrapperClass",switchHandleWidth:"handleWidth",switchLabelWidth:"labelWidth",switchInverse:"inverse",switchReadonly:"readonly"};var observeProp=function(prop,bindings){return function(){attrs.$observe(prop,function(){setSwitchParamMaybe(element,bindings[prop],prop)})}};for(var prop in bindings){attrs.$observe(prop,observeProp(prop,bindings))}};var listenToView=function(){var switchChangeFn=getSwitchAttrValue("switchChange");if(attrs.type==="radio"){element.on("change.bootstrapSwitch",function(e){if(controller.$modelValue===controller.$viewValue&&e.target.checked!==$(e.target).bootstrapSwitch("state")){if(e.target.checked){controller.$setViewValue(getTrueValue())}else if(getTrueValue()===controller.$viewValue){controller.$setViewValue(undefined)}switchChangeFn()}})}else{element.on("switchChange.bootstrapSwitch",function(e){controller.$setViewValue(e.target.checked);switchChangeFn()})}};listenToView();listenToModel();scope.$on("$destroy",function(){element.bootstrapSwitch("destroy")})}}}]).directive("bsSwitch",function(){return{restrict:"E",require:"ngModel",template:"<input bs-switch>",replace:true}});angular.module("MailerliteApp").directive("bs3Datepicker",["$timeout",function($timeout){return function(scope,element,attr){var params={format:"YYYY-MM-DD"};if(attr.bs3DatepickerParent){params.widgetParent=attr.bs3DatepickerParent}if(attr.bs3DatepickerMinDate){params.minDate=attr.bs3DatepickerMinDate}$(element).datetimepicker(params).on("dp.hide",function(e){$(element).blur()}).on("dp.show",function(e){}).on("dp.change",function(e){$(element).trigger("input")})}}]);angular.module("mailerlite.clipboard",[]);angular.module("mailerlite.clipboard").directive("clipboardContainer",["$filter",function($filter){"use strict";return{scope:{successCallback:"&clipboardSuccess"},link:function(scope,element,attrs,controller){var tooltipTitleSuccess=$filter("translate")("Copied!","global");var tooltipTitleError=$filter("translate")(getTooltipTitleError(),"global");var clipboardContainer=element;var clipboardTarget=clipboardContainer.find("[clipboard-target]");var clipboardTrigger=clipboardContainer.find("[clipboard-trigger]");var data;if(clipboardTarget.length){data={target:function(){return clipboardTarget[0]}}}else{data={text:function(){return clipboardTrigger.attr("clipboard-text")||""}}}var clipboard=new Clipboard(clipboardTrigger[0],data);clipboard.on("success",function(){showTooltip(clipboardTrigger,tooltipTitleSuccess);scope.successCallback()});clipboard.on("error",function(){showTooltip(clipboardTrigger,tooltipTitleError)})}}}]);function showTooltip(element,title){"use strict";$(element).tooltip({title:title,placement:"bottom",trigger:"manual",template:'<div class="tooltip tooltip-original"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'});$(element).tooltip("show");var tooltipid=$(element).attr("aria-describedby");var timeout=setTimeout(function(){if($(element).attr("aria-describedby")===tooltipid){$(element).tooltip("destroy")}},1500)}function getTooltipTitleError(){"use strict";var metaKey="";if(isMacUser()){metaKey="⌘"}else{metaKey="Ctrl"}return"Press "+metaKey+" + C to copy this to your clipboard."}function isMacUser(){"use strict";return navigator.userAgent.indexOf("Mac OS X")!==-1}angular.module("MailerliteApp").directive("contenteditable",["$sce",function($sce){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){if(!ngModel)return;ngModel.$render=function(){element.html($sce.getTrustedHtml(ngModel.$viewValue||""))};element.on("blur keyup change",function(){scope.$evalAsync(read)});function read(){var html=element.html();if(attrs.stripBr&&html=="<br>"){html=""}html=html.replace(/&nbsp;/g," ");ngModel.$setViewValue(html)}}}}]).directive("emoji",["$compile","$timeout","statisticsService",function($compile,$timeout,statisticsService){return{require:"ngModel",link:function(scope,element,attrs,ngModelController){$(document).ready(function(){ngModelController.$formatters.push(function(data){return replaceImgToAltAndRemoveHtml($("<div>").html(data))});var emojiElement=createContenteditableElement(element);var emojiElementHtml=$("<div>").html(emojiElement).html();var emojiElementCompiled=$compile(emojiElementHtml);emojiElement=emojiElementCompiled(scope);element.css("visibility","hidden");element.before(emojiElement);$(emojiElement).emojiPicker({width:"342px",height:"300px",button:false});var emojiPickerIcon=$("<button>").attr("type","button").addClass("emojiPickerIcon black");var emojiPickerIconWrap=$("<div>").addClass("emojiPickerIconWrap input-group-btn").append(emojiPickerIcon);emojiPickerIcon.click(function(event){event.preventDefault();emojiElement.emojiPicker("toggle");return false});$(element).after(emojiPickerIconWrap);emojiElement.on("emoji.track",function(event,emoji){statisticsService.track({feature:"app_subject_emoji",info:{emoji:emoji}})});$timeout(function(){emojiElement.trigger("emoji.added")});emojiElement.on("paste",function(e){e.preventDefault();var text=e.originalEvent.clipboardData.getData("text/plain");text=$("<div>").text(text).html();document.execCommand("insertHTML",false,text)});emojiElement.on("keypress",function(e){if(e.keyCode==13){e.preventDefault()}});$(emojiElement).data("lastCaretPosition",0);$(emojiElement).blur(function(){$(emojiElement).data("lastCaretPosition",emojiElement.caret_position("pos"))});emojiElement.on("focus",function(){emojiElement.parent().addClass("active")});emojiElement.on("focusout",function(){emojiElement.parent().removeClass("active")})})}}}]);function createContenteditableElement(element){var attributes=$(element).prop("attributes");var result=$("<div>");$.each(attributes,function(){if(["name","id","emoji","value"].indexOf(this.name)!==-1){return}result.attr(this.name,this.value)});result.prop("contenteditable",true);result.addClass("fake-input");return result}angular.module("MailerliteApp").directive("filterRegex",[function(){return{restrict:"A",scope:{filterRegex:"@"},link:function(scope,element,attrs,controller){var filterRegex=new RegExp(scope.filterRegex,"i");element.change(function(){element.val(element.val().replace(filterRegex,""))})}}}]);angular.module("MailerliteApp").directive("fixEscape",[function(){return{restrict:"A",link:function(scope,element,attrs){element.html(element.html().replace("[  [","[["))}}}]);angular.module("MailerliteApp").directive("focusOnLoad",["$timeout",function($timeout){return function(scope,element,attr){$timeout(function(){$timeout(function(){$(element).focus()})})}}]).directive("focusOnTrue",["$timeout",function($timeout){return function(scope,element,attr){scope.$watch(attr.focusOnTrue,function(newVal){if(newVal){$timeout(function(){$(element).focus()})}})}}]);angular.module("MailerliteApp").directive("generateAutomationStepDescription",["$timeout",function(){"use strict";return{restrict:"E",scope:{step:"="},templateUrl:"/assets/js/core/views/generate-automation-step-description/step.html"}}]);angular.module("MailerliteCore").directive("getElementWidth",["$window","$timeout",function($window,$timeout){return{scope:{getElementWidth:"@",ngModel:"="},link:function(scope,element,attrs){if(scope.getElementWidth&&scope.getElementWidth!=="false"){var w=angular.element($window);scope.getWindowDimensions=function(){return w.width()};scope.$watch(scope.getWindowDimensions,function(newValue,oldValue){calculateWidth();$timeout(calculateWidth,0);$timeout(calculateWidth,50);$timeout(calculateWidth,100);$timeout(calculateWidth,300);$timeout(calculateWidth,500)});var calculateWidth=function(){scope.ngModel=$(element).width()};w.bind("resize",function(){scope.$apply()});calculateWidth()}}}}])
;angular.module("MailerliteApp").directive("iframeAutoHeight",["$timeout",function($timeout){"use strict";return{link:function(scope,element,attrs){element.on("load",function(){var iFrameHeight=element[0].contentWindow.document.body.scrollHeight+10+"px";element.css("height",iFrameHeight)})}}}]);angular.module("MailerliteApp").directive("iframeOnLoad",["$timeout",function($timeout){"use strict";return{scope:{callback:"&iframeOnLoad",disableIframeLinks:"=iframeOnLoadDisableLinks"},link:function(scope,element,attrs){element.on("load",function(){scope.callback();if(scope.disableIframeLinks){$(element).contents().on("click","a",function(e){e.preventDefault()})}})}}}]);angular.module("MailerliteApp").directive("loadingDots",function($interval){function repeatChar(theChar,count){var str="";while(count--){str+=theChar}return str}function numberValueOrDefault(value,defaultTo,optMinValue,optMaxValue){if(value===undefined||value===null){return defaultTo}value=parseInt(value,10);if(optMinValue!==undefined&&value<optMinValue){value=optMinValue}if(optMaxValue!==undefined&&value>optMaxValue){value=optMaxValue}return value}function link(scope,element,attributes){var min=numberValueOrDefault(attributes.minDots,0,0);var max=numberValueOrDefault(attributes.maxDots,5,min+1);var starting=numberValueOrDefault(attributes.starting,min,min,max);var increment=numberValueOrDefault(attributes.increment,1);var interval=numberValueOrDefault(attributes.interval,300);var character=attributes.character||".";var isLoading=attributes.isLoading||false;var intervalPromise=null;var text=repeatChar(character,starting);function startInterval(){if(intervalPromise){$interval.cancel(intervalPromise)}var initialText=repeatChar(character,starting);element.text(initialText);intervalPromise=$interval(tick,interval);isLoading=true}function stopInterval(){if(intervalPromise){$interval.cancel(intervalPromise);element.text("")}isLoading=false}function tick(){if(!isLoading){return}var length=text.length;if(length<max){text=repeatChar(character,length+increment)}else{text=repeatChar(character,min)}element.text(text)}scope.$watch(attributes.isLoading,function(loading){if(loading){startInterval()}else{stopInterval()}});element.on("$destroy",stopInterval)}return{restrict:"AE",link:link}});var mailerliteApp=angular.module("MailerliteApp");mailerliteApp.directive("copyInput",["$timeout",function($timeout){"use strict";return{scope:{triggerTooltip:"=copyInput",callback:"&copyInputSuccess"},link:function(scope,element,attrs,controller){var tooltipActive=false;$(element).tooltip({title:getTooltipTitle(),placement:"bottom",trigger:"manual"});var blurTimeout;$(element).blur(function(){blurTimeout=$timeout(function(){$(element).tooltip("hide");tooltipActive=false},150)});scope.$watch("triggerTooltip",function(newVal){if(newVal){if(blurTimeout){$timeout.cancel(blurTimeout)}tooltipActive=true;$(element).tooltip("show").select().focus()}});$(element).keydown(function(e){if(tooltipActive){if((e.metaKey||e.ctrlKey)&&e.keyCode===67){$timeout(function(){scope.callback();$(element).blur()},100)}else{$timeout(function(){$(element).select().focus()})}}});$(element).click(function(){if(tooltipActive){$timeout(function(){$(element).select().focus()})}})}}}]);function getTooltipTitle(){"use strict";var copyKey="";if(isMacUser()){copyKey="⌘"}else{copyKey="Ctrl"}return"Press "+copyKey+" + C to copy this to your clipboard."}function isMacUser(){"use strict";return navigator.userAgent.indexOf("Mac OS X")!==-1}(function(){var app=angular.module("MailerliteCore");app.value("previewEmailWindowUri","/emails/rest/email_window/");app.directive("previewEmailWindow",["$http","$compile","previewEmailWindowUri",function($http,$compile,previewEmailWindowUri){return{restrict:"A",scope:{},controller:["$scope","$timeout","$http","$window",function($scope,$timeout,$http,$window){$scope.emailId=0;$scope.showEmailPreview=false;$scope.previewRule="all";$scope.previewFields=[];$scope.previewGroups=[];$scope.previewSelectedField={};$scope.previewGroupsBelong="all";$scope.previewOperators=[{title:"equals",value:""},{title:"doesn't equal",value:"!"},{title:"is set",value:"true",hide_value:true},{title:"is not set",value:"false",hide_value:true}];$scope.previewOperator=$scope.previewOperators[0];$scope.previewOperatorValue="";$scope.previewFieldsLoading=false;$scope.previewGroupsLoading=false;$scope.hasDynamicContent=false;var previewIframes=document.getElementsByClassName("preview-iframe");this.preview=function(mail_code){$scope.previewLoading=true;$scope.code=mail_code;$scope.id=Math.floor(Math.random()*1e6);$scope.mail_code=mail_code;$("body").css("overflow","hidden");$scope.showEmailPreview=true;$http.get("/emails/rest/has_dynamic_content_code/"+mail_code).then(function(response){$http.get("/emails/rest/email_from_code/"+mail_code).then(function(result){$scope.emailId=result.data});$scope.hasDynamicContent=response.data==="true";$scope.previewLoading=false;if($scope.hasDynamicContent){$scope.loadDynamicContentOptions()}$scope.previewShowByFilter()})};$scope.hide=function(){$("body").css("overflow","auto");$scope.code=false;$scope.showEmailPreview=false};$scope.loadDynamicContentOptions=function(){$scope.previewFieldsLoading=true;if(!$window.fields){$http.get(CLIENT_API_BASE_URL+"/master/fields").then(function(data){$scope.previewFields=data.data;$window.fields=$scope.previewFields;$scope.previewFieldsLoading=false})}else{$scope.previewFields=$window.fields;$scope.previewFieldsLoading=false}$scope.previewGroupsLoading=true;if(!$window.groups){$http.get(CLIENT_API_BASE_URL+"/master/groups").then(function(data){$scope.previewGroups=data.data;$window.groups=$scope.previewGroups;$scope.previewGroupsLoading=false})}else{$scope.previewGroups=$window.groups;$scope.previewGroupsLoading=false}};$scope.loadPreviewIframes=function(options){$scope.previewLoading=true;var loadedIframes=0;if(!options){options=""}var url="/"+$scope.mail_code+"/?preview=true";if($scope.hasDynamicContent&&$scope.emailId){url="/emails/html/preview/"+$scope.emailId+"/1"+options}for(var i=0;i<previewIframes.length;i++){previewIframes[i].src=url;previewIframes[i].onload=function(){loadedIframes++;if(loadedIframes==previewIframes.length){$scope.previewLoading=false;$scope.$apply()}}}};$scope.previewShowByFilter=function(){$scope.previewLoading=true;if($scope.previewRule==="all"){$scope.loadPreviewIframes()}else if($scope.previewRule==="groups"){var selectedGroups=$scope.previewGroups.filter(function(g){return g.selected}).map(function(g){return g.id});var filter="?groups="+selectedGroups.join();$scope.loadPreviewIframes(filter)}else if($scope.previewRule==="fields"){var filter="";if(Object.keys($scope.previewSelectedField).length>0){filter=$scope.previewSelectedField.var+"="+$scope.previewOperator.value;if(!$scope.previewOperator.hide_value){if($scope.previewOperatorValue===undefined){$scope.previewOperatorValue=""}filter+=$scope.previewOperatorValue}}$scope.loadPreviewIframes("?"+filter)}};function keymap(e){if($scope.showEmailPreview){switch(e.keyCode){case 27:$scope.hide();break}}}window.addEventListener("keydown",function(e){$timeout(function(){keymap(e)})},false)}],link:{pre:function(scope,element,attrs){var url=attrs.previewEmailWindowUri||previewEmailWindowUri;$http.get(url,{cache:true}).success(function(template){element=$compile(template)(scope);angular.element("body").append(element)})}}}}]);app.directive("previewEmail",["$timeout",function($timeout){return{restrict:"A",require:"^previewEmailWindow",scope:{previewEmail:"="},link:function(scope,element,attrs,previewEmailWindowCtrl){element.click(function(){$timeout(function(){previewEmailWindowCtrl.preview(scope.previewEmail)})})}}}])})();(function(){var app=angular.module("MailerliteCore");app.value("previewLandingWindowUri","/webforms/new/landing_window/");app.directive("previewLandingWindow",["$http","$compile","previewLandingWindowUri",function($http,$compile,previewLandingWindowUri){return{restrict:"A",scope:{},controller:["$scope","$timeout",function($scope,$timeout){var previewIframes=document.getElementsByClassName("preview-iframe");$scope.showLandingPreview=false;this.preview=function(landing_url,webform_code,webform_id){$scope.landingUrl=landing_url;if(webform_id){$scope.iframeSrc="/webforms/new/preview/"+webform_id}else{$scope.iframeSrc="/webforms/submit/"+webform_code}$("body").css("overflow","hidden");$scope.showLandingPreview=true;$scope.previewLoading=true;var loadedIframes=0;for(var i=0;i<previewIframes.length;i++){previewIframes[i].src=$scope.iframeSrc;previewIframes[i].onload=function(){loadedIframes++;if(loadedIframes==previewIframes.length){$scope.previewLoading=false;$scope.$apply()}}}};$scope.hide=function(){$("body").css("overflow","auto");$scope.landingUrl=false;$scope.showLandingPreview=false};function keymap(e){if($scope.showLandingPreview){switch(e.keyCode){case 27:$scope.hide();break}}}window.addEventListener("keydown",function(e){$timeout(function(){keymap(e)})},false)}],link:{pre:function(scope,element,attrs){var url=attrs.previewLandingWindowUri||previewLandingWindowUri;$http.get(url,{cache:true}).success(function(template){element=$compile(template)(scope);angular.element("body").append(element)})}}}}]);app.directive("previewLanding",["$timeout",function($timeout){return{restrict:"A",require:"^previewLandingWindow",scope:{previewLanding:"=",previewLandingCode:"=",previewLandingId:"="},link:function(scope,element,attrs,previewLandingWindowCtrl){element.click(function(){$timeout(function(){previewLandingWindowCtrl.preview(scope.previewLanding,scope.previewLandingCode,scope.previewLandingId)})})}}}])})();(function(){var app=angular.module("MailerliteCore");app.value("previewWindowUri","/emails/rest/window/");app.directive("previewWindow",["$http","$compile","previewWindowUri",function($http,$compile,previewWindowUri){return{restrict:"A",scope:{templates:"=previewWindow",mailId:"@"},controller:["$scope","$timeout",function($scope,$timeout){$scope.previewTemplates=[];$scope.$watch("templates",function(newTemplates){if(newTemplates&&newTemplates.length){$scope.previewTemplates=[];if($scope.previewTemplates.length<4&&$scope.templates.length){$scope.previewTemplates=[].concat($scope.templates);while($scope.previewTemplates.length<4){for(var i=0;i<$scope.templates.length;i++){var t=$scope.templates[i];$scope.previewTemplates.push(angular.copy(t))}}}}});$scope.showTemplatePreview=false;this.preview=function(template){changeMainTemplate(template);previewAnimation();$("body").css("overflow","hidden");$scope.showTemplatePreview=true};$scope.hide=function(){hideAnimation();$("body").css("overflow","auto");$scope.showTemplatePreview=false};$scope.prev=function(){prevAnimation();var prevTemplate=getPrevTemplate($scope.mainTemplate);changeMainTemplate(prevTemplate)};$scope.next=function(){nextAnimation();var nextTemplate=getNextTemplate($scope.mainTemplate);changeMainTemplate(nextTemplate)};function keymap(e){if($scope.showTemplatePreview){switch(e.keyCode){case 27:$scope.hide();break;case 37:$scope.prev();break;case 39:$scope.next();break}}}window.addEventListener("keydown",function(e){$timeout(function(){keymap(e)})},false);$scope.iframeLoaded=function(template){$timeout(function(){template.iframeLoaded=true;loadTemplateCallback(template)})};function loadTemplateIfNotLoaded(template){if(!isTemplateLoaded(template)){loadTemplate(template)}else{loadTemplateCallback(template)}}function isTemplateLoaded(template){return template.iframeSrc!==""}function loadTemplate(template){template.iframeLoaded=false;template.iframeSrc=template.previewUrl}function loadTemplateCallback(template){if(template.loadSideTemplates){var prevTemplate=getPrevTemplate(template);var nextTemplate=getNextTemplate(template);prevTemplate.loadSideTemplates=false;nextTemplate.loadSideTemplates=false;loadTemplateIfNotLoaded(prevTemplate);loadTemplateIfNotLoaded(nextTemplate)}}function getNextTemplate(template){var nextTemplateIndex=getNextTemplateIndex(template);return $scope.previewTemplates[nextTemplateIndex]}function getNextTemplateIndex(template){var templateIndex=$scope.previewTemplates.indexOf(template);var nextTemplateIndex=templateIndex+1;if(nextTemplateIndex==$scope.previewTemplates.length){nextTemplateIndex=0}return nextTemplateIndex}function getPrevTemplate(template){var prevTemplateIndex=getPrevTemplateIndex(template);return $scope.previewTemplates[prevTemplateIndex]}function getPrevTemplateIndex(template){var templateIndex=$scope.previewTemplates.indexOf(template);var prevTemplateIndex=templateIndex-1;if(prevTemplateIndex<0){prevTemplateIndex=$scope.previewTemplates.length-1}return prevTemplateIndex}function changeMainTemplate(template){template.loadSideTemplates=true;loadTemplateIfNotLoaded(template);$scope.mainTemplate=template}function prevAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var prevPrevTemplate=getPrevTemplate(prevTemplate);var nextTemplate=getNextTemplate(mainTemplate);prevPrevTemplate.cssClass="prev";prevTemplate.cssClass="main";mainTemplate.cssClass="next";nextTemplate.cssClass=""}function nextAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var nextTemplate=getNextTemplate(mainTemplate);var nextNextTemplate=getNextTemplate(nextTemplate);prevTemplate.cssClass="";mainTemplate.cssClass="prev";nextTemplate.cssClass="main";nextNextTemplate.cssClass="next"}function previewAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var nextTemplate=getNextTemplate(mainTemplate);prevTemplate.cssClass="prev";mainTemplate.cssClass="main";nextTemplate.cssClass="next"}function hideAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var nextTemplate=getNextTemplate(mainTemplate);prevTemplate.cssClass="";mainTemplate.cssClass="";nextTemplate.cssClass=""}}],link:{pre:function(scope,element,attrs){var element;var url=attrs.previewWindowUri||previewWindowUri;$http.get(url,{cache:true}).success(function(template){element=$compile(template)(scope);angular.element("body").append(element)})}}}}]);app.directive("preview",["$timeout",function($timeout){return{restrict:"A",require:"^previewWindow",scope:{preview:"="},link:function(scope,element,attrs,previewWindowCtrl){element.click(function(){$timeout(function(){previewWindowCtrl.preview(scope.preview)})})}}}])})();angular.module("MailerliteApp").directive("relative",function(){return{restrict:"EA",scope:{timestamp:"="},link:function(scope,element,attrs){var input,accountTime,friendly,transformed,limit;moment.locale(window.TRANSLATES_LOCALE.split("-")[0]);accountTime=moment(window.ACCOUNT_TIMESTAMP,"YYYY-MM-DD HH:mm:ss");limit=3600*24*7;input=moment(scope.timestamp,"YYYY-MM-DD HH:mm:ss");if(input.unix()+limit>moment().unix()){friendly=input.from(accountTime)}else{friendly=input.format("YYYY-MM-DD")}transformed='<span class="alt-value">';transformed+='<span class="mouse-over">'+scope.timestamp+"</span>";transformed+='<span class="mouse-out">'+friendly+"</span>";transformed+="</span>";element.html(transformed)}}});angular.module("MailerliteCore").value("subscriberWindowUri","/subscribers/rest/window").factory("SubscriberModal",["$timeout","$q","$http","$document","$compile","$rootScope","subscriberWindowUri","ApiGroups","ApiSubscribers",function($timeout,$q,$http,$document,$compile,$rootScope,subscriberWindowUri,ApiGroups,ApiSubscribers){var scope=$rootScope.$new();var subscriberChanged=false;scope.close=function(){var close=function(){scope.visible=false;scope.subscriber=null;scope.subscriber_id=null;$("body").css("overflow","auto");scope.cancelTabsTimeout();if(subscriberChanged){$rootScope.$broadcast("refreshSubscribersItems");subscriberChanged=false}};$(document).keyup(function(e){if(e.keyCode==27){$timeout(function(){close()})}});return close}();scope.cancelTabsTimeout=function(){if(scope.tabsTimeout){$timeout.cancel(scope.tabsTimeout)}};var showWindow=function(){var windowLoaded=false;subscriberChanged=false;function loadWindow(callback){if(!windowLoaded){var wrapperTemplte='<div ng-show="visible">'+'<div id="dark-overlay" ng-click="close()">'+'<div class="spinner">'+'<div class="bounce1"></div>'+'<div class="bounce2"></div>'+'<div class="bounce3"></div>'+"</div>"+"</div>"+"</div>";var wrapper=$compile(wrapperTemplte)(scope);$("body").append(wrapper);$http.get(subscriberWindowUri,{cache:true}).success(function(template){var element=$compile(template)(scope);$(wrapper).append(element);windowLoaded=true;if(callback){callback()}})}else{if(callback){callback()}}}return function(callback){var deferred=$q.defer();loadWindow(function(){$("body").css("overflow","hidden");deferred.resolve();if(callback){callback()}});return deferred}}();return{setSubscriberChanged:function(value){subscriberChanged=value},showWindow:showWindow,getScope:function(){return scope}}}]).directive("subscriberWindow",["$http","$timeout","$q","ApiSubscribers","SubscriberModal",function($http,$timeout,$q,ApiSubscribers,SubscriberModal){return{restrict:"A",link:function(scope,element,attrs){var subscriber_id=parseInt(attrs.subscriberWindow,10),windowDefer,subscriberDefer;if(!subscriber_id){return}var modalScope=SubscriberModal.getScope();element.bind("click",function(){modalScope.cancelTabsTimeout();modalScope.visible=true;modalScope.active_tab="activity";modalScope.visible=true;modalScope.subscriberLoading=true;modalScope.subscriber=null;SubscriberModal.showWindow(function(){modalScope.$broadcast("SubscriberModalOpenBefore",subscriber_id);subscriberDefer=ApiSubscribers.get({id:subscriber_id},function(subscriber){subscriber.clicked_perc=0;subscriber.opened_perc=0;if(subscriber.added&&subscriber.added.date){var dateArray=subscriber.added.date.split(/- :/);if(dateArray.length===6){var year=dateArray[0];var month=dateArray[1]-1;var day=dateArray[2];var hour=dateArray[3];var mins=dateArray[4];var secs=dateArray[5];var dateObj=new Date(year,month,day,hour,mins,secs);subscriber.added.date=dateObj}}if(subscriber.sent){subscriber.opened=subscriber.opened>subscriber.sent?subscriber.sent:subscriber.opened;subscriber.clicked=subscriber.clicked>subscriber.opened?subscriber.opened:subscriber.clicked;subscriber.clicked_perc=Math.round(subscriber.clicked*100/subscriber.sent);subscriber.opened_perc=Math.round(subscriber.opened*100/subscriber.sent)}modalScope.subscriber=subscriber;modalScope.subscriberLoading=false});modalScope.tabsTimeout=$timeout(function(){modalScope.$broadcast("SubscriberModalOpen",subscriber_id)},300)})})}}}]).controller("SubscriberWindow",["$scope","$compile","$timeout","$filter","$http","SubscriberModal","ApiSubscribers","SubscribersService",function($scope,$compile,$timeout,$filter,$http,SubscriberModal,ApiSubscribers,SubscribersService){var modalScope=SubscriberModal.getScope();$scope.$on("SubscriberModalOpen",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id}});modalScope.changeSubscriberType=modalScope.changeSubscriberType||function(newType){$scope.subscriber.type=newType;$scope.subscriber.unsubscribe_date=false;ApiSubscribers.update({id:$scope.subscriber.id,type:newType},function(response){if(response.unsubscribe_date!==undefined){$scope.subscriber.unsubscribe_date=response.unsubscribe_date}});SubscriberModal.setSubscriberChanged(true)};modalScope.exportActivityToFile=function(id,params){console.log("id",id);console.log("params",params);SubscribersService.export_activity_to_file(id,params,null)}}]).directive("mlOnScroll",["$timeout",function($timeout){return function(scope,elm,attr){var raw=elm[0];function onScroll(){if(raw.scrollTop+raw.offsetHeight>=raw.scrollHeight-200){scope.$eval(attr.mlOnScroll)}}elm.bind("scroll",onScroll);onScroll()}}]).controller("SubscriberActivityController",["$scope","$compile","$timeout","$filter","$http","SubscriberModal","ApiSubscribers",function($scope,$compile,$timeout,$filter,$http,SubscriberModal,ApiSubscribers){var addActivityToType=function(){$scope.keyByDate={};$scope.counterByDate={};function getKeyByDate(type,date){$scope.counterByDate[type]=$scope.counterByDate[type]||0;$scope.keyByDate[type]=$scope.keyByDate[type]||{};if($scope.keyByDate[type][date]===undefined){$scope.keyByDate[type][date]=$scope.counterByDate[type];$scope.counterByDate[type]++}return $scope.keyByDate[type][date]}return function(arr,type,date,activity){var key=getKeyByDate(type,date);arr[type]=arr[type]||[];arr[type][key]=arr[type][key]||{date:date,activities:[]};arr[type][key].activities.push(activity)}}();$scope.toTime=function(string){return Date.parse(string)};var modalScope=SubscriberModal.getScope();$scope.$on("SubscriberModalOpenBefore",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.activities=[];$scope.activityLoading=true;$scope.keyByDate={};$scope.counterByDate={}}});$scope.$on("SubscriberModalOpen",function(event,subscriber_id){var activitiesAll={};var perPage=20;$scope.loadActivitiesPage=function(){$timeout(function(){if(!activitiesAll[$scope.activeType])return false;var stack=activitiesAll[$scope.activeType];stack.curGroup=stack.curGroup||0;stack.curActivity=stack.curActivity||0;if(!stack[stack.curGroup]||!stack[stack.curGroup].activities[stack.curActivity])return false;var destStack=$scope.activities[$scope.activeType]=$scope.activities[$scope.activeType]||[];var activitiesAdded=0;while(activitiesAdded<perPage&&stack[stack.curGroup].activities[stack.curActivity]){destStack[stack.curGroup]=destStack[stack.curGroup]||{date:stack[stack.curGroup].date,activities:[]};var activitiesToAdd=stack[stack.curGroup].activities.slice(stack.curActivity,stack.curActivity+perPage);destStack[stack.curGroup].activities=destStack[stack.curGroup].activities.concat(activitiesToAdd);stack.curActivity+=perPage;if(!stack[stack.curGroup].activities[stack.curActivity]){if(stack[stack.curGroup+1]){stack.curGroup++;stack.curActivity=0}}activitiesAdded+=activitiesToAdd.length}})};if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.activities={};$scope.activityLoading=true;$scope.keyByDate={};$scope.counterByDate={};ApiSubscribers.getActivity({id:subscriber_id},function(activities){angular.forEach(activities,function(activity){var date=function(fullDate){var arr=fullDate.split(" ");var day=arr[0];return day}(activity.date);addActivityToType(activitiesAll,"all",date,activity);addActivityToType(activitiesAll,activity.type,date,activity)});$scope.loadActivitiesPage();$scope.activityLoading=false})}});$scope.activeType="all";$scope.$watch("activeType",function(newType){if(newType&&$scope.loadActivitiesPage){$scope.loadActivitiesPage()}})}]).controller("SubscriberGroupsController",["$scope","$q","$compile","$timeout","$filter","$http","ApiGroups","ApiSubscribers","SubscriberModal",function($scope,$q,$compile,$timeout,$filter,$http,ApiGroups,ApiSubscribers,SubscriberModal){var modalScope=SubscriberModal.getScope();var allGroupsDefer=ApiGroups.query(),subscriberGroupsDefer=undefined;$scope.groups=[];$scope.$on("SubscriberModalOpenBefore",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.groupsLoading=true;$scope.groups=[]}});$scope.$on("SubscriberModalOpen",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.groupsLoading=true;$scope.groups=[];subscriberGroupsDefer=ApiSubscribers.getGroups({id:subscriber_id});$q.all([allGroupsDefer.$promise,subscriberGroupsDefer.$promise]).then(function(responses){var allGroups=responses[0]||[],subscriberGroups=responses[1]||[];var in_groups={};angular.forEach(subscriberGroups,function(group){in_groups[group.id]=true});angular.forEach(allGroups,function(group){group.ingroup=!!in_groups[group.id];group.total=parseInt(group.total,10);$scope.groups.push(group)});$scope.groupsLoading=false})}});$scope.toggleInGroup=function(index){var groups=$scope.filtered_groups;var group=groups[index];$scope.groupsLoading=true;if(group.ingroup){group.ingroup=0}else{group.ingroup=1}ApiGroups.assignSubscriber({id:group.id,subscriber_id:$scope.subscriber_id,action:group.ingroup?"assign":"unassign",autoresponders:1},function(){ApiGroups.get({id:group.id},function(response){angular.extend(group,response);$scope.groupsLoading=false})});SubscriberModal.setSubscriberChanged(true)};$scope.order={predicate:"name",reverse:false};$scope.changeOrder=function(newPredicate){if(newPredicate==$scope.order.predicate){$scope.order.reverse=!$scope.order.reverse}else{$scope.order={predicate:newPredicate,reverse:false}}};$scope.filterResults=function(value){if($scope.show_all){return true}return value.ingroup}}]).controller("SubscriberDetailsController",["$scope","$q","$compile","$timeout","$filter","$http","SubscriberModal","ApiSubscribers",function($scope,$q,$compile,$timeout,$filter,$http,SubscriberModal,ApiSubscribers){var modalScope=SubscriberModal.getScope();$scope.$on("SubscriberModalOpenBefore",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.detailsLoading=true;$scope.fields=[];$scope.note={note:""};$scope.edit_mode=false}});$scope.$on("SubscriberModalOpen",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.detailsLoading=true;$scope.fields=[];$scope.note={note:""};$scope.edit_mode=false;ApiSubscribers.getFields({id:subscriber_id},function(response){var fields=response||[];$scope.fields=fields;$scope.detailsLoading=false})}});$scope.edit=function(){$scope.edit_mode=true};$scope.cancel=function(){$scope.edit_mode=false};$scope.save=function(){$scope.detailsLoading=true;fieldsDefer=function(){var fields={};angular.forEach($scope.fields,function(field){fields[field.var]=field.value});return ApiSubscribers.updateFields({id:$scope.subscriber_id},{fields:fields},function(){$scope.edit_mode=false;$scope.detailsLoading=false})}();SubscriberModal.setSubscriberChanged(true)}}]).controller("SubscriberNotesController",["$scope","$q","$compile","$timeout","$filter","$http","SubscriberModal","ApiNotes",function($scope,$q,$compile,$timeout,$filter,$http,SubscriberModal,ApiNotes){var modalScope=SubscriberModal.getScope(),notesDefer;$scope.$on("SubscriberModalOpenBefore",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.notesLoading=true;$scope.newNote="";$scope.notes=[];$scope.addMode=false;$scope.saving=false}});$scope.$on("SubscriberModalOpen",function(event,subscriber_id){if(subscriber_id){$scope.subscriber_id=subscriber_id;$scope.notesLoading=true;$scope.newNote="";$scope.notes=[];$scope.addMode=false;$scope.saving=false;notesDefer=ApiNotes.query({subscriber_id:subscriber_id});$q.all([notesDefer.$promise]).then(function(responses){var notes=responses[0]||[];$scope.notes=notes;$scope.notesLoading=false})}});$scope.deleteNote=function(note){var index=$scope.notes.indexOf(note);console.log(note);ApiNotes.remove({subscriber_id:$scope.subscriber_id,id:note.id},function(response){},function(response){$scope.notes.splice(index,0,note)});$scope.notes.splice(index,1)};$scope.saveNote=function(){$scope.saving=true;ApiNotes.save({subscriber_id:$scope.subscriber_id},{note:$scope.newNote},function(response){$scope.notes.unshift(response);$scope.saving=false;$scope.addMode=false;$scope.newNote=""},function(response){$scope.saving=false})}}]);angular.module("MailerliteCore").directive("textareaHeight",["$timeout","ApiFields",function($timeout,ApiFields){return{scope:{va:"=ngModel"},link:function($scope,elem,attrs,controller){$scope.$watch("va",function(){$(elem).css("height","1px");$(elem).css("height",elem[0].scrollHeight+"px")})}}}]);window.generatingStepsList=[];angular.module("MailerliteApp").directive("updateScreenshot",["$timeout","$http",function($timeout,$http){return{restrict:"A",scope:{mail:"=updateScreenshot"},link:function(scope,element,attrs){var mail=scope.mail||{};var mail_id=mail.mail_id||mail.id;var mail_screenshot=mail.screenshot;if(mail_screenshot&&mail_screenshot.indexOf("images/newsletter_screenshot")!==-1){mail_screenshot=false}if(!mail_screenshot&&mail_id&&mail.code){if(attrs.stepId){window.generatingStepsList.push(Number(attrs.stepId))}$http.get("/emails/update_screenshot/"+mail_id+"/"+mail.code+"/1").success(function(response){if(response){mail.screenshot=response.screenshot;mail.screenshot_big=response.screenshot_big;if(typeof window.screenshot_updated==="function"){window.screenshot_updated(mail,attrs.stepId)}if(attrs.stepId){var index=window.generatingStepsList.indexOf(Number(attrs.stepId));if(index!=-1){window.generatingStepsList.splice(index,1)}}}})}if(mail.screenshot&&(mail.screenshot.charAt(0)!=="/"&&mail.screenshot.substr(0,4)!=="http"))mail.screenshot="/"+mail.screenshot;if(mail.screenshot_big&&(mail.screenshot_big.charAt(0)!=="/"&&mail.screenshot_big.substr(0,4)!=="http"))mail.screenshot_big="/"+mail.screenshot_big}}}]);angular.module("MailerliteApp").directive("valueToUrlHash",["$timeout",function($timeout){return function(scope,element){$timeout(function(){setUrlHash(element.val());element.on("change",function(){setUrlHash(element.val(),true)})})}}]);function setUrlHash(value,force){if(!force&&!!window.location.hash){return}window.location.hash=value}angular.module("MailerliteCore").factory("BuilderFunctions",["$timeout",function($timeout){return{mergeObj:function(){var merged={};for(var i=0;i<arguments.length;++i){for(var k in arguments[i]){if(arguments[i].hasOwnProperty(k)&&arguments[i][k]!==undefined){merged[k]=arguments[i][k]}}}return merged},whiteBG:function(data){var invisible_on_white=true;if(data===undefined)return invisible_on_white;if(data.backgroundColor!==undefined&&data.backgroundColor.toLowerCase()!="#ffffff")invisible_on_white=false;if(data.backgroundImage!==undefined&&data.backgroundImage.toLowerCase()!="none")invisible_on_white=false;return invisible_on_white}}}]);angular.module("MailerliteCore").factory("SelectionService",function($resource){return $resource("/resource/selection/:id",{id:"@id"},{create:{method:"POST"}})});angular.module("MailerliteApp").factory("UserPermissions",["$timeout",function($timeout){var permissions={};return{hasPermissions:function(controller,method){if(typeof window.permissions==="undefined"){return true}controller=controller.toLowerCase();method=method.toLowerCase();permissions=window.permissions.permissions;if(permissions&&typeof permissions.disallow!=="undefined"){if(permissions.disallow&&permissions.disallow[controller]&&(permissions.disallow[controller].indexOf(method)>-1||permissions.disallow[controller].indexOf("*")>-1)){return false}}if(permissions&&typeof permissions.allow!=="undefined"){if(permissions.allow&&permissions.allow[0]=="*"){return true}if(typeof permissions.allow[controller]!=="undefined"){if(permissions.allow[controller].indexOf("*")>-1||permissions.allow[controller].indexOf(method)>-1){return true}}}if(permissions&&typeof permissions.disallow!=="undefined"&&permissions.disallow[0]=="*"){return false}return true},hasCampaignAccess:function(id){items=window.permissions.items.campaigns||[];if(items.indexOf(id)>-1){return true}return false},hasGroupAccess:function(id){items=window.permissions.items.groups||[];if(items.indexOf(id)>-1){return true}return false}}}]);function increaseAutomationStepUpdateCount(data){"use strict";window.automation_step_update_count=window.automation_step_update_count||0;window.automation_step_update_count++;return angular.toJson(data)}function decreaseAutomationStepUpdateCount(data){"use strict";window.automation_step_update_count--;return angular.fromJson(data)}angular.module("MailerliteApp").factory("AutomationWorkflowResource",function($resource){"use strict";return $resource("/automation",{workflow_id:window.automation.id,step_id:"@id"},{createNewMail:{url:"/automation/create_new_mail/:workflow_id",method:"POST"},copyMail:{url:"/automation/copy_automation_mail/:workflow_id",method:"POST"},getWorkflowTree:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps",method:"GET",isArray:true},
updateAutomation:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id",method:"PUT",transformRequest:increaseAutomationStepUpdateCount,transformResponse:decreaseAutomationStepUpdateCount},saveWorkflowTree:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps",method:"PUT",transformRequest:increaseAutomationStepUpdateCount,transformResponse:decreaseAutomationStepUpdateCount},createNewStep:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps",method:"POST",transformRequest:increaseAutomationStepUpdateCount,transformResponse:decreaseAutomationStepUpdateCount},updateStep:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps/:step_id",method:"PUT",transformRequest:increaseAutomationStepUpdateCount,transformResponse:decreaseAutomationStepUpdateCount},deleteStep:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps/:step_id",method:"DELETE",transformRequest:increaseAutomationStepUpdateCount,transformResponse:decreaseAutomationStepUpdateCount},deleteWorkflowMail:{url:"/automation/drop_workflow_mail/:workflow_id/:mail_id"},batchDeleteWorkflowMail:{url:"/automation/batch_drop_workflow_mail/:workflow_id",method:"POST"},dropFaultySteps:{url:"/automation/drop_faulty_steps/:workflow_id",method:"POST"},getAutomationReport:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/report",method:"GET"},checkMail:{url:"/emails/mail_json_by_id/:mail_id",method:"GET",isArray:true},getActivityCount:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/subscribers/count",method:"GET"},getWooCommerceShopCategories:{url:CLIENT_API_BASE_URL+"/v2/woocommerce/automation/categories/:shop_id",method:"GET",isArray:false},getAutomationStepSubscribers:{url:"/automation/rest/automation_step_subscribers/:workflow_id",method:"GET"},checkNonTriggeredAlertValue:{url:"/automation/rest/automation_non_triggered_alert_value/:workflow_id",method:"GET"}})});angular.module("MailerliteApp").factory("AutomationResource",function($resource){return $resource("/automation/rest/:id",{workflow_id:"@workflow_id",step_id:"@step_id"},{getAutomations:{url:CLIENT_API_BASE_URL+"/master/automations?limit=1000",method:"GET",isArray:true},getAutomationsLimited:{url:CLIENT_API_BASE_URL+"/master/automations?limit=1",method:"GET",isArray:true},getAutomationsCount:{url:CLIENT_API_BASE_URL+"/master/automations/count",method:"GET"},createAutomation:{url:CLIENT_API_BASE_URL+"/master/automations",method:"POST"},delete:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id",method:"DELETE"},updateAutomation:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id",method:"PUT"},updateRestAutomation:{url:"/automation/rest/:workflow_id",method:"PUT"},updateStep:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps/:step_id",method:"PUT"},deleteBatch:{url:CLIENT_API_BASE_URL+"/master/automations/delete-batch",method:"POST"},duplicateAutomation:{url:"/automation/rest/duplicate_automation",method:"POST"},migrate:{url:CLIENT_API_BASE_URL+"/master/autoresponders/migrate",method:"POST"},getMigratedAutomations:{url:"/automation/rest/get_account_migrated_automations",method:"GET",isArray:true},getNontriggeredCount:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/subscribers/count?nontriggered",method:"GET"},getNontriggeredOnlyNewCount:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/subscribers/count?nontriggered_only_new",method:"GET"},triggerNontriggeredSubscribers:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/actions/triggerSubscribers",method:"POST"},getWorkflowTree:{url:CLIENT_API_BASE_URL+"/master/automations/:workflow_id/steps",method:"GET",isArray:true}})});angular.module("MailerliteApp").factory("ApiAutoresponders",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/autoresponders/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getFuture:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/autoresponders/:id/future",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getFutureCount:{method:"GET",url:CLIENT_API_BASE_URL+"/master/autoresponders/:id/future/count",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getAutomations:{url:CLIENT_API_BASE_URL+"/master/automations?limit=1000",method:"GET",isArray:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiCampaigns",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/campaigns/:type/:id",{id:"@id",type:"@type"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",cache:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiCountries",function($resource){return $resource("/countries/get_all_countries_json",{},{get:{isArray:true,method:"GET"}})});angular.module("MailerliteApp").factory("ApiFields",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/fields/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",cache:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},queryNoCache:{isArray:true,method:"GET",cache:false,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},sysFieldsQuery:{url:CLIENT_API_BASE_URL+"/master/fields?sys=true",isArray:true,method:"GET",cache:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteCore").factory("ApiFolders",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/:folder_type/folders/:folder_id",{folder_id:"@folder_id",folder_type:"@folder_type"},{get:{method:"GET",isArray:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},post:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},put:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},delete:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},batchMove:{method:"PUT",url:CLIENT_API_BASE_URL+"/master/:folder_type/folders/:folder_id/move",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiGroups",function($resource){"use strict";return $resource(CLIENT_API_BASE_URL+"/master/groups/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN},isArray:true},query:{isArray:true,method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getAllGroupsAndSegments:{isArray:true,url:"/groups/rest/all_groups_and_segments",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},assignSubscriber:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups/:id/subscribers/:subscriber_id/:action",params:{subscriber_id:"@subscriber_id",action:"@action"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},createGroup:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups",params:{name:"@name"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getSubscribers:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/:type",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getSubscribersCount:{method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/:type/count",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},addSubscriber:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups/:id/subscribers",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},importSubscribers:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups/:id/subscribers/import/:import_type",params:{import_type:"@import_type"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getSegments:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:id/segments",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getForms:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/webforms",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiImport",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/",{group_id:"@group_id",id:"@id"},{getColumns:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/columns",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},matchFields:{method:"PUT",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/columns",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},updateInvalid:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/data/invalid/:data_id",params:{group_id:"@group_id",id:"@id",data_id:"@data_id"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},killImport:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/kill",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},startImport:{method:"POST",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/start",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getImport:{method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},exportData:{method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/data/:type/export",params:{group_id:"@group_id",id:"@id",type:"@type"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getData:{method:"GET",url:CLIENT_API_BASE_URL+"/master/groups/:group_id/subscribers/import/:id/data/:type",params:{group_id:"@group_id",id:"@id",type:"@type"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getIndexedStats:{method:"GET",url:CLIENT_API_BASE_URL+"/v2/filters/status",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getMarkers:{method:"GET",url:CLIENT_API_BASE_URL+"/v2/markers",isArray:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiLinks",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/links/:link_id",{link_id:"@link_id"},{getSubscribers:{url:CLIENT_API_BASE_URL+"/master/links/:link_id/subscribers",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiNotes",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/subscribers/:subscriber_id/notes/:id",{subscriber_id:"@subscriber_id",id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},save:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiPages",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/pages/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},save:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiReports",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/reports/:report_id",{report_id:"@report_id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",cache:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getSubscribers:{url:CLIENT_API_BASE_URL+"/master/reports/:report_id/subscribers",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getCountries:{isArray:true,url:CLIENT_API_BASE_URL+"/master/reports/:report_id/countries",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiSegments",function($resource){return $resource(CLIENT_API_BASE_URL+"/v2/segments",{},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiSubscribers",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/subscribers/:id",{id:"@id"},{create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},searchCount:{method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/search/count",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getGroups:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/:id/groups",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getActivity:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/:id/activity",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getChanges:{isArray:false,method:"GET",url:CLIENT_API_BASE_URL+"/v2/subscribers/:id/changes",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getNotes:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/:id/notes",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getFields:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/:id/fields",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},updateFields:{method:"PUT",url:CLIENT_API_BASE_URL+"/master/subscribers/:id/fields",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},updateNotes:{method:"PUT",url:CLIENT_API_BASE_URL+"/master/subscribers/:id/notes/:note_id",params:{id:"@id",note_id:"@note_id"},headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},search:{isArray:true,method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/search",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},growth:{method:"GET",url:CLIENT_API_BASE_URL+"/master/subscribers/stats/growth",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},deleteSubscribers:{method:"POST",url:CLIENT_API_BASE_URL+"/v2/filters/subscribers/delete",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},forgetSubscriber:{method:"POST",url:CLIENT_API_BASE_URL+"/v2/subscribers/:id/forget",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiTags",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/tags/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,url:CLIENT_API_BASE_URL+"/master/groups",method:"GET",cache:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiTemplates",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/templates/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{url:"/templates/rest/",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{url:"/templates/rest/:id",method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},save:{url:"/templates/rest/",method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{url:"/templates/rest/",method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},copy:{url:"/templates/rest/copy/:id",method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},categories:{url:"/templates/rest/categories",isArray:true,method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},popular:{url:"/templates/rest/popular",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},trending:{url:"/templates/rest/trending",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("ApiTimezones",function($resource){return $resource("/timezones/rest",{},{get:{isArray:true,method:"GET"}})});angular.module("MailerliteApp").factory("ApiWebforms",function($resource){return $resource(CLIENT_API_BASE_URL+"/master/webforms/:id",{id:"@id"},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},update:{method:"PUT",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},remove:{method:"DELETE",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},create:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},query:{isArray:true,method:"GET",cache:true,headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},queryCount:{method:"GET",url:CLIENT_API_BASE_URL+"/master/webforms/count",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getGroups:{method:"GET",isArray:true,url:CLIENT_API_BASE_URL+"/master/webforms/:id/groups",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},updateGroups:{method:"PUT",isArray:true,url:CLIENT_API_BASE_URL+"/master/webforms/:id/groups",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getFields:{method:"GET",isArray:true,url:CLIENT_API_BASE_URL+"/master/webforms/:id/fields",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},updateFields:{method:"PUT",isArray:true,url:CLIENT_API_BASE_URL+"/master/webforms/:id/fields",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getSubscribers:{method:"GET",isArray:true,url:CLIENT_API_BASE_URL+"/master/webforms/:webform_id/subscribers",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}},getSubscribersCount:{method:"GET",url:CLIENT_API_BASE_URL+"/master/webforms/:webform_id/subscribers/count",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("AutorespondersService",function($resource,$http){return $resource("/autoresponders/rest/:id",{id:"@id"},{resend:{method:"POST",url:"/autoresponders/resend/"},cancel:{method:"POST",url:"/autoresponders/cancel/"}})});angular.module("MailerliteApp").factory("DashboardService",function($resource){return $resource("/dashboard",{},{getMonthlyStats:{method:"GET",url:"/dashboard/getMonthlyStats",isArray:true},getSubscribersGrowth:{method:"GET",url:"/dashboard/getSubscribersGrowth",isArray:true}})});angular.module("MailerliteApp").factory("EmailsService",function($resource){return $resource("/emails/rest/:id",{type:"@type",id:"@id",action:"@action"},{update:{method:"PUT"},remove:{method:"DELETE"},copy:{method:"POST",url:"/emails/rest/copy/:id"},cancel:{method:"PUT",url:"/emails/rest/cancel/:id"},query:{method:"GET"},remove_mail_group:{method:"GET",url:"/emails/remove_group/:id/:group_id"},getLinksByMailId:{method:"GET",url:"/reports/links_json_by_mail_id/:mail_id/0"},send_test_email:{method:"GET",url:"/emails/send_test/:mail_id/:test_email/:token"},get_account_automails:{url:"/emails/rest/account_automails",method:"GET",isArray:true},get_recent_mails:{url:"/emails/rest/recent_mails/:mail_id",method:"GET",isArray:true},get_recent_mails_count:{url:"/emails/rest/recent_mails_count/:mail_id",method:"GET"}})});angular.module("MailerliteApp").factory("FieldsService",function($resource){return $resource("/fields/rest/:id",{id:"@id"},{create:{method:"POST"}})});angular.module("MailerliteApp").factory("GroupactionsService",function($resource){var resource_object=$resource("/groupactions/rest/:id",{id:"@id"},{get:{method:"GET"},getData:{method:"GET",url:"/groupactions/rest/data/:id"},updateInvalid:{method:"PUT",url:"/groupactions/rest/update_invalid/:id/"},kill:{method:"PUT",url:"/groupactions/rest/kill/:id/"}});resource_object.export_to_file=function(filter,callback){$("#export_hidden_form").remove();var form='<form id="export_hidden_form" action="/groupactions/rest/export/'+filter.id+'/" method="POST">';angular.forEach(filter,function(value,key){form+='<input type="hidden" name="'+key+'" value="'+value+'" />'});$("body").append(form).find("#export_hidden_form").submit()};return resource_object});angular.module("MailerliteApp").factory("GroupsService",function($resource,$http){return $resource("/groups/rest/:id",{id:"@id"},{update:{method:"PUT"},create:{method:"POST"},remove:{method:"DELETE"},query:{method:"GET",isArray:false},split:{method:"POST",url:"/groups/rest/split/:id"},merge:{method:"POST",url:"/groups/rest/merge/:id"},save_order:{method:"PUT"},getGroup:{url:CLIENT_API_BASE_URL+"/v2/groups/:id",method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("HideNotificationResource",function($resource){"use strict";return $resource(CLIENT_API_BASE_URL+"/master/invites/later",{},{post:{method:"POST",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})}).factory("InviteCodeResource",function($resource){"use strict";return $resource(CLIENT_API_BASE_URL+"/master/invites",{},{get:{method:"GET",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})});angular.module("MailerliteApp").factory("SubscribersService",function($resource){var resource_object=$resource("/subscribers/rest/:id",{id:"@id"},{create:{method:"POST"},remove:{method:"DELETE"},update:{method:"PUT"},query:{method:"GET"},get_activity:{method:"GET",url:"/subscribers/rest/:id/activity"},copy_to_group:{method:"POST",url:"/subscribers/rest/copy/"},move_to_group:{method:"POST",url:"/subscribers/rest/move/"},start_import:{method:"POST",url:"/subscribers/rest/start_import"},upload_textarea:{method:"POST",url:"/subscribers/rest/upload_textarea/"},unique_stats:{method:"GET",url:"/subscribers/rest/unique_stats/:id"},is_subscriber_forget:{method:"GET",url:"/subscribers/rest/is_subscriber_forget/:id"}});resource_object.export_to_file=function(filter,callback,http){if(filter.search){delete filter.type}data={};http.post("/subscribers/rest/export/",filter).success(function(data){callback(data)})};resource_object.export_activity_to_file=function(id,filter,callback){var form='<form id="export_hidden_form" action="/subscribers/rest/activity" method="POST">';angular.forEach(filter,function(value,key){form+='<input type="hidden" name=\''+key+"' value='"+value+"' />"});$("body").append(form).find("#export_hidden_form").submit()};return resource_object});angular.module("MailerliteApp").factory("WebformsService",function($resource){return $resource("/webforms/rest/:id",{id:"@id",code:"@code"},{remove:{method:"DELETE"},update:{method:"PUT"},query:{method:"GET"},screenshot:{method:"GET",url:"/webforms/rest/update_screenshot/:id/:code"}})});angular.module("MailerliteApp").controller("AutomationWorkflowController",["$scope","$timeout","$interval","$modal","$filter","$q","$http","ApiFields","ApiGroups","ApiSegments","GroupsService","AutomationResource","AutomationWorkflowResource",function($scope,$timeout,$interval,$modal,$filter,$q,$http,ApiFields,ApiGroups,ApiSegments,GroupsService,AutomationResource,AutomationWorkflowResource){$scope.moment=moment;moment.locale(TRANSLATES_LOCALE.split("-")[0]);$scope.account_timezone=window.gmt_timezone;$scope.automation=window.automation;$scope.window=window;$scope.condition_types_list=[];$scope.automation_step_subscribers={};function refreshAutomationStepSubscribers(){var request=AutomationWorkflowResource.getAutomationStepSubscribers({},function(response){$scope.automation_step_subscribers=response});return request.$promise}refreshAutomationStepSubscribers();(function autoRefreshStatistics(){if($scope.workflow_preview){return false}$timeout(function(){var promises=[];if(Number($scope.automation.active)===1){promises.push($scope.loadAutomationReport());promises.push(refreshAutomationStepSubscribers())}if($scope.nonTriggeredAlert){promises.push($scope.checkNonTriggeredAlertValue())}$q.all(promises).then(function success(){autoRefreshStatistics()},function error(){autoRefreshStatistics()})},1e4)})();$scope.checkNonTriggeredAlertValue=function(){if(typeof window.sessionStorage!=="undefined"){$scope.nonTriggeredAlert=window.sessionStorage.getItem("nonTriggeredAlert")}var request=AutomationWorkflowResource.checkNonTriggeredAlertValue(function(response){if(response&&response.nonTriggeredAlert){$scope.setNonTriggeredAlertValue(true)}else{$scope.setNonTriggeredAlertValue(false)}});return request.$promise};$scope.setNonTriggeredAlertValue=function(newValue){$scope.nonTriggeredAlert=newValue;if(typeof window.sessionStorage!=="undefined"){window.sessionStorage.setItem("nonTriggeredAlert",newValue)}};$scope.saveSidebar=function(justSave){if(window.automation_step_update_count){return}if(!$scope.sidebar.include){return}if($scope.sidebar.step.scrollLocation>0){var container=$(".ml-workflow-builder-area");container.stop().animate({scrollTop:$scope.sidebar.step.scrollLocation},{duration:100,specialEasing:{width:"linear",height:"easeOutBounce"}});delete $scope.sidebar.step.scrollLocation}var valid=$scope.validateSidebar();if(!valid){$scope.sidebar.step.data.valid=false;return false}var sidebarChanged=isSidebarChanged();if(!sidebarChanged){$scope.loadSidebar();return true}$scope.sidebar.step.data.valid=true;if($scope.sidebar.step.data.subject){$scope.sidebar.step.data.subject=replaceImgToAltAndRemoveHtml($scope.sidebar.step.data.subject,true)}if($scope.sidebar.step.type==="EMAIL"&&!$scope.sidebar.step.data.mail_id){$scope.sidebar.step.data.valid=false}if($scope.sidebar.step.type==="TRIGGER"){if($scope.sidebar.data&&$scope.sidebar.data.trigger&&$scope.sidebar.data.trigger.id=="11"){generateDelayEmailMap()}if(isTriggerChangedCountingFromLastActiveState()){var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Please confirm","/automation"),body:$filter("translate")("All subscribers waiting in all workflow steps will be removed from the workflow.","/automation"),button_cancel:$filter("translate")("Cancel","/automation"),button_ok:$filter("translate")("Proceed","/automation"),button_ok_class:"btn-red"}}}});modalInstance.result.then(function(){$scope.sidebar.step.data.isTriggerSaveConfirmationNeeded=true;if(!compareSidebarAndCancelData()){$scope.sidebar.step.data.changed=true}else{delete $scope.sidebar.step.data.changed}AutomationWorkflowResource.updateStep($scope.sidebar.step);updateAutomationEntryInDatabase();if(typeof justSave!=="undefined"&&justSave){return}$scope.loadSidebar();countIncompleteSteps();AutomationResource.getNontriggeredCount({workflow_id:window.automation.id},function(response){$scope.nonTriggeredCount=Number(response.count)})})}else{if(!compareSidebarAndCancelData()){$scope.sidebar.step.data.changed=true}else{delete $scope.sidebar.step.data.changed}AutomationWorkflowResource.updateStep($scope.sidebar.step);updateAutomationEntryInDatabase();if(typeof justSave!=="undefined"&&justSave){return}$scope.loadSidebar();countIncompleteSteps()}}else{if($scope.sidebar.step.type==="CONDITION"){checkForConditionTempFieldsAndDelete($scope.sidebar.step.data)}AutomationWorkflowResource.updateStep($scope.sidebar.step);if($scope.sidebar.step.type==="EMAIL"&&$scope.sidebar.step.data.mail_id){var subjectParams={mail_id:$scope.sidebar.step.data.mail_id,subject:$scope.sidebar.step.data.subject,from:$scope.sidebar.step.data.from,from_name:$scope.sidebar.step.data.from_name,analytics:Number($scope.sidebar.step.data.google_analytics)?1:0};$.post("/automation/set_mail_data/",subjectParams,function(response){},"json")}else if($scope.sidebar.step.type==="DELAY"){generateDelayEmailMap()}if(typeof justSave!=="undefined"&&justSave){return}
$scope.loadSidebar();countIncompleteSteps()}};function isTriggerChangedCountingFromLastActiveState(){if(!$scope.sidebar.data.workflowWasActive||$scope.sidebar.data.isTriggerSaveConfirmationNeeded){return false}return!compareSidebarAndCancelData()}function compareSidebarAndCancelData(){var compareData={};var compareCancelData={};var compareWhitelist=["delay_hours","delay_minutes","field_id","field_trigger_time","field_trigger_type","field_trigger_unit","group_id","segment_id","type"];$.each($scope.sidebar.data,function(key,data){if(compareWhitelist.indexOf(key)===-1){return}if(key==="send_once"&&data===""){data=true}if(data===true){data="1"}else if(data===false){data="0"}compareData[key]=data});$.each($scope.sidebar.cancelData,function(key,data){if(compareWhitelist.indexOf(key)===-1){return}if(key==="send_once"&&data===""){data=true}if(data===true){data="1"}else if(data===false){data="0"}compareCancelData[key]=data});return angular.equals(compareData,compareCancelData)}function updateAutomationEntryInDatabase(){AutomationWorkflowResource.updateAutomation(getUpdateParams(),function(response){$scope.automation=response});function getUpdateParams(){var allowedParams=["title","group_id","segment_id","field_id","form_id","type","send_once","field_trigger_type","field_trigger_unit","field_trigger_time","field_trigger_value"];var params={};allowedParams.forEach(function(allowedParam){if(typeof $scope.sidebar.step.data[allowedParam]!=="undefined"){params[allowedParam]=$scope.sidebar.step.data[allowedParam]}else{params[allowedParam]=null;$scope.automation[allowedParam]=null}if(allowedParam==="send_once"){params[allowedParam]=Number(params[allowedParam])}});return params}}$scope.validateSidebar=function(params){var fields=$(".sidebar-content").find(".form-control:visible, "+".trigger-error-on-visible:visible,"+".trigger-error-on-no-checked-children:visible, "+".validate-check-attribute-value");var result=true;fields.each(function(index,field){var value=false;if($(field).is(".emoji-container")){value=$(field).find("input[emoji]").val()}else if($(field).is(".validate-email")){$(field).val($(field).val().trim());value=$(field).val();var isEmailValid=validateEmail(value);if(!isEmailValid){value=false}}else if($(field).is(".validate-number")){value=$(field).val();var isNumberValid=/^\d+$/.test(value);if(!isNumberValid){value=false}if($(field).hasClass("trigger-error-if-zero")&&value<=0){value=false}}else if($(field).is(".trigger-error-on-visible:visible")){value=false}else if($(field).is(".trigger-error-on-no-checked-children:visible")){var checked=$(field).find("span.checkbox.checked");if(checked.length===0){value=false;$(field).popover({placement:"top",content:"Please select at least one option",container:".sidebar-content",trigger:"manual"}).popover("show");$(document).one("click keyup",function(){$(field).popover("destroy")})}else{value=true}}else if($(field).is(".validate-check-attribute-value")){value=$(field).attr("data-check-value")}else{value=$(field).val()}if(!value||$(field).is("select")&&(value=="?"||value=="? undefined:undefined ?")){result=false;$(field).addClass("has-error");$(field).closest(".select-wrap").addClass("has-error");$(field).one("keyup change",function(){$(field).removeClass("has-error");$(field).closest(".select-wrap").removeClass("has-error")})}else{$(field).removeClass("has-error");$(field).closest(".select-wrap").removeClass("has-error")}});return result;function validateEmail(value){var basicValidation=/^\{\$[^}]+\}$/.test(value)||/^[a-zA-Z0-9ąčęėįšųūžа-я.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9ąčęėįšųūžа-я](?:[a-zA-Z0-9ąčęėįšųūžа-я-]{0,61}[a-zA-Z0-9ąčęėįšųūžа-я])?(?:\.[a-zA-Z0-9ąčęėįšųūžа-я](?:[a-zA-Z0-9ąčęėįšųūžа-я-]{0,61}[a-zA-Z0-9ąčęėįšųūžа-я])?)*$/i.test(value);if(!basicValidation){return false}var result=true;var message="";for(var i=0;i<window.blacklisted_domains.length;++i){var re=new RegExp(window.blacklisted_domains[i].pattern,"i");if(re.test(value)){message=window.blacklisted_domains[i].reason;result=false;break}}if(!result){$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Error!","/automation"),body:message,button_cancel:$filter("translate")("OK","/automation"),button_confirm_hide:true}}}})}return result}};function isSidebarChanged(){var sidebarData=angular.fromJson(angular.toJson($scope.sidebar.data));var sidebarCancelData=angular.fromJson(angular.toJson($scope.sidebar.cancelData));if($scope.sidebar.step.type==="CONDITION"){checkForConditionTempFieldsAndDelete(sidebarData);checkForConditionTempFieldsAndDelete(sidebarCancelData)}var sidebarDataJsonString=JSON.stringify(sidebarData);var sidebarCancelDataJsonString=JSON.stringify(sidebarCancelData);var sidebarIsChanged=sidebarDataJsonString!==sidebarCancelDataJsonString;return sidebarIsChanged}function checkForConditionTempFieldsAndDelete(stepData){if(typeof stepData.conditions!="undefined"){for(var i=0;i<stepData.conditions.length;i++){for(var k in stepData.conditions[i]){if(k.substr(0,5)==="temp_"){delete stepData.conditions[i][k]}}}}}$(document).keyup(function(e){$timeout(function(){var modalIsActive=!!$(".modal").length;if(modalIsActive){return}if(e.keyCode==27){$scope.cancelSidebar()}else if(e.keyCode==13){$scope.saveSidebar()}})});function validateStep(step){return step.data&&step.data.valid==1}$scope.mail_languages=window.mail_languages;$scope.incompleteSteps=[];$scope.incompleteStepsGrouped={};function countIncompleteSteps(){var result=[];var foundEmailOrActionStep=false;function recursiveWalk(stepArray){stepArray.forEach(function(step){if(!step.data||Number(step.data.valid)!==1){result.push(step)}if(step.data&&Number(step.data.valid)===1&&["EMAIL","ACTION"].indexOf(step.type)!==-1){foundEmailOrActionStep=true}recursiveWalk(step.next)})}recursiveWalk($scope.tree);if(!result.length&&!foundEmailOrActionStep){result.push({type:"NO_EMAIL_OR_ACTION"})}$scope.incompleteSteps=result;$scope.incompleteStepsGroupedByType=groupObjectBy($scope.incompleteSteps,"type");$scope.$broadcast("incompleteStepsCount",result.length);if($scope.tree[0].data.incompleteStepsCount!=result.length){$scope.tree[0].data.incompleteStepsCount=result.length;delete $scope.tree[0].data.changed;AutomationWorkflowResource.updateStep($scope.tree[0])}}function groupObjectBy(data,key){if(!(data&&key))return;var result={};for(var i=0;i<data.length;i++){if(!result[data[i][key]])result[data[i][key]]=[];result[data[i][key]].push(data[i])}return result}$scope.treeLoading=true;$scope.tree=[];(function buildTree(){AutomationWorkflowResource.getWorkflowTree({},function(response){if(response.length){if(window.preview_tree){$scope.tree=window.preview_tree;$scope.disableAutomationModifications()}else{$scope.tree=response}treeIsLoaded()}})})();$scope.reportSidebarData={type:"",data:{}};$scope.disableAutomationModifications=function(){Object.keys(AutomationWorkflowResource).forEach(function(key){AutomationWorkflowResource[key]=function(){}})};$scope.loadAutomationReport=function(){var batchRequests=[];batchRequests.push({method:"GET",path:"/api/master/automations/"+$scope.automation.id+"/report"});batchRequests.push({method:"GET",path:"/api/master/automations/"+$scope.automation.id+"/subscribers/count?status=completed"});batchRequests.push({method:"GET",path:"/api/master/automations/"+$scope.automation.id+"/subscribers/count?status=delayed"});return $http.post(CLIENT_API_BASE_URL+"/v2/batch",{requests:batchRequests}).then(function(response){var responses=response.data;if(responses&&responses.length===3){$scope.report=responses[0].body;$scope.reportLoading=false;$scope.completedCount=Number(responses[1].body.count);$scope.delayedCount=Number(responses[2].body.count)}})};function treeIsLoaded(){countIncompleteSteps();if(!validateStep($scope.tree[0])){$scope.loadSidebar($scope.tree[0],false,true)}else{var itemData;if(window.location.hash){var mail_id=/mail_id=(\d+)/.exec(window.location.hash);var step_id=/step_id=(\d+)/.exec(window.location.hash);var step;if(mail_id&&mail_id[1]){mail_id=mail_id[1];step=$scope.getStepByMailId(mail_id);if(step){itemData=step}}else if(step_id&&step_id[1]){step_id=step_id[1];step=$scope.getStepById(step_id);if(step){itemData=step}}}$scope.loadSidebar(itemData)}$timeout(function(){$timeout(function(){$(".ml-workflow-builder-area").scrollLeft($(".wf-builder").outerWidth()/2+75-$(".ml-workflow-builder-area").outerWidth()/2)});$scope.treeLoading=false},100)}$scope.sidebar={include:"",data:{},step:{}};$scope.account_level=$scope.window.account_level;$scope.loadSidebar=function(itemData,event,noCancelData){if(typeof itemData==="undefined"){if(!validateStep($scope.tree[0])){itemData=$scope.tree[0]}else{itemData=$scope.reportSidebarData}}if(typeof itemData.data==="undefined"||!itemData.data||itemData.data===null||Array.isArray(itemData.data)&&!itemData.data.length){itemData.data={}}$scope.sidebar.include=itemData.type?itemData.type.toLowerCase():itemData.type;$scope.sidebar.data=itemData.data;$scope.sidebar.step=itemData;if(!noCancelData){$scope.sidebar.cancelData=angular.copy($scope.sidebar.data)}$scope.$broadcast("loadSidebar",$scope.sidebar.step.type)};$scope.countStepsByType=function(type){function recursiveWalk(stepArray,type){var count=0;stepArray.forEach(function(step){count+=recursiveWalk(step.next,type);if(!type||step.type===type){count+=1}});return count}return recursiveWalk($scope.tree,type)};$scope.getStepById=function(id){function recursiveWalk(stepArray){var resultStep=false;stepArray.forEach(function(step){if(resultStep){return}if(step.id==id){resultStep=step}else{resultStep=recursiveWalk(step.next)}});return resultStep}return recursiveWalk($scope.tree)};$scope.getStepByMailId=function(mail_id){function recursiveWalk(stepArray){var resultStep=false;stepArray.forEach(function(step){if(resultStep){return}if(step.type==="EMAIL"&&step.data&&Number(step.data.mail_id)===Number(mail_id)){resultStep=step}else{resultStep=recursiveWalk(step.next)}});return resultStep}return recursiveWalk($scope.tree)};$scope.getListOfParentStepsDataByType=function(topStep,type,ignoreFirst){ignoreFirst=typeof ignoreFirst!=="undefined"?ignoreFirst:false;function recursiveWalkToParents(step){if(step.type===type&&step.data&&typeof step.data==="object"&&Number(step.data.valid)===1){step.data.step_id=step.id;list.push(step.data)}var parentStep=$scope.getStepById(step.parent_id);if(parentStep){recursiveWalkToParents(parentStep)}}var list=[];if(ignoreFirst===false){recursiveWalkToParents(topStep)}else{var parentStep=$scope.getStepById(topStep.parent_id);if(parentStep){recursiveWalkToParents(parentStep)}}return list};$scope.addStep=function(newStepType,parentStep,parentNextType,newStepData,savedCallback,addedCallback){if(window.automation_step_update_count){return}var newStep={type:newStepType,parent_id:parentStep.id,data:{},next:[]};if(typeof newStepData!=="undefined"&&newStepData){newStep.data=newStepData}var nextStepArray=$scope.filterNextStep(parentStep,parentNextType);if(newStepType!=="CONDITION"){saveStepToTree(newStep)}else{newStep.data.next_yes=false;newStep.data.next_no=false;newStep.data.matching_type="any_rule";newStep.data.valid=0;newStep.data.conditions=[{type:""}];if(!nextStepArray.length){saveStepToTree(newStep)}else{$modal.open({templateUrl:"/views/automation/modals/modal_where_move_children.html",controller:"ModalInstanceController",resolve:{data:function(){return{}}}}).result.then(function(modalResponse){newStep.data[modalResponse.moveChildrenTo]=nextStepArray[0].id;saveStepToTree(newStep)})}}function saveStepToTree(step){nextStepArray.forEach(function(step){var index=parentStep.next.indexOf(step);parentStep.next.splice(index,1);newStep.next.push(step)});if(parentStep.type==="CONDITION"){parentStep.data[parentNextType]=newStep.id}parentStep.next.push(step);$scope.loadSidebar(step);if(typeof addedCallback==="function"){addedCallback(step)}countIncompleteSteps();saveStepToApi(step)}function saveStepToApi(step){AutomationWorkflowResource.createNewStep(step,function(response){if(response.id){step.id=response.id;step.parent_id=response.parent_id;step.created_at=response.created_at;step.updated_at=response.updated_at;if(parentStep.type==="CONDITION"){parentStep.data[parentNextType]=step.id;AutomationWorkflowResource.updateStep(parentStep)}step.next.forEach(function(item){item.parent_id=step.id;AutomationWorkflowResource.updateStep(item)});if(typeof savedCallback==="function"){savedCallback(step)}}})}};$scope.filterNextStep=function(parentStep,parentNextType){parentNextType=parentNextType||"next";if(parentNextType=="next"){return parentStep.next}var nextStepId=parentStep.data[parentNextType];var result=[];if(nextStepId){result=parentStep.next.filter(function(step){return step.id==nextStepId})}return result};$scope.deleteStep=function(step,$event){if(window.automation_step_update_count){return}$event.stopPropagation();step.deleted=true;cleanDeletedItems($scope.tree,false,function(){countIncompleteSteps()})};$scope.getStepIdsThatHaveMoveToAnotherStepActionPointingToThem=function(){var action_steps=$scope.getListOfStepsDataByType("ACTION");action_steps=action_steps.filter(function(item){return item.type==="move_to_another_step"&&item.next_step_id});return action_steps.map(function(item){return Number(item.next_step_id)})};$scope.checkIfStepContainsMoveToAnotherStepAction=function(stepFromArg,callback,withChildren){var steps_with_action_ids=$scope.getStepIdsThatHaveMoveToAnotherStepActionPointingToThem();var result=false;function recursiveWalk(step){var step_id=Number(step.id);if(steps_with_action_ids.indexOf(step_id)!==-1){result=true}if(withChildren){var next_step=$scope.filterNextStep(step,withChildren);next_step.forEach(function(item){recursiveWalk(item)})}}recursiveWalk(stepFromArg);if(result){var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Cannot delete this step","/automation"),body:$filter("translate")('Step that you are about to delete contains "move to another step" target.',"/automation"),button_cancel:$filter("translate")("Close","/automation"),button_confirm_hide:true}}}});modalInstance.result.then(function(){if(typeof callback==="function"){callback(true)}},function(){if(typeof callback==="function"){callback(true)}})}else{if(typeof callback==="function"){callback(false)}}};$scope.checkIfCanDeleteStep=function(step,callback,withChildren){$scope.checkIfStepContainsMoveToAnotherStepAction(step,function(result){if(result){if(typeof callback==="function"){callback(false)}}else{if(typeof callback==="function"){callback(true)}}},withChildren)};function cleanDeletedItems(itemArray,parent,afterKillCallback){itemArray.forEach(function(item){if(item.deleted){var modalInstance;var emailInUse=false;if(item.type=="EMAIL"){var conditions=$scope.getListOfStepsDataByType("CONDITION");conditions.forEach(function(conditionStep){if(typeof conditionStep.conditions=="object"&&conditionStep.conditions.length>0){conditionStep.conditions.forEach(function(condition){if(condition.type==="workflow_activity"&&condition.mail&&condition.mail.mail_id===item.data.mail_id){emailInUse=true}})}});if(emailInUse){modalInstance=$modal.open({templateUrl:"/views/automation/modals/universal_alert_notification.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("The step cannot be deleted","/automation"),body:$filter("translate")("The email that you are about to delete is used in a condition step. Please change the condition rule at first.","/automation"),button_cancel:$filter("translate")("Close","/automation"),button_confirm_hide:true}}}})}}if(emailInUse){item.deleted=false}else if(item.type==="CONDITION"&&item.next.length){var next_yes_step_array=$scope.filterNextStep(item,"next_yes");var next_no_step_array=$scope.filterNextStep(item,"next_no");var dropChildren={};if(next_yes_step_array.length&&next_no_step_array.length){dropChildren.ask=true;dropChildren.answer="drop_both"}else if(next_yes_step_array.length){dropChildren.ask=false;dropChildren.answer="drop_no"}else if(next_no_step_array.length){dropChildren.ask=false;dropChildren.answer="drop_yes"}else{dropChildren.ask=false;dropChildren.answer="drop_both"}if(dropChildren.ask){modalInstance=$modal.open({templateUrl:"/views/automation/modals/confirm_condition_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Please confirm","/automation"),body:$filter("translate")("Do you really want to delete this CONDITION step including all steps below?","/automation"),button_cancel:$filter("translate")("Cancel","/automation"),button_ok:$filter("translate")("Delete","/automation"),button_ok_class:"btn-red",dropChildren:dropChildren}}}})}else if(item.data.valid==1){modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Please confirm","/automation"),body:$filter("translate")("Do you really want to delete this step?","/automation"),button_cancel:$filter("translate")("Cancel","/automation"),button_ok:$filter("translate")("Delete","/automation"),button_ok_class:"btn-red"}}}})}else{conditionRemovalBusiness();return}modalInstance.result.then(function(response){conditionRemovalBusiness()},function(){leaveThisStep()});function conditionRemovalBusiness(){if(dropChildren.answer==="drop_yes"){$scope.checkIfCanDeleteStep(item,function(canDelete){if(canDelete){saveChildren(next_no_step_array[0],function(){killThisStep(true)})}else{leaveThisStep()}},"next_yes")}else if(dropChildren.answer==="drop_no"){$scope.checkIfCanDeleteStep(item,function(canDelete){if(canDelete){saveChildren(next_yes_step_array[0],function(){killThisStep(true)})}else{leaveThisStep()}},"next_no")}else if(dropChildren.answer==="drop_both"){$scope.checkIfCanDeleteStep(item,function(canDelete){if(canDelete){killThisStep(true)}else{leaveThisStep()}},"next")}function saveChildren(children_step,callback){var promises=[];parent.next.unshift(children_step);var children_step_index_in_array=item.next.indexOf(children_step);if(children_step_index_in_array!==-1){item.next.splice(children_step_index_in_array,1)}children_step.parent_id=parent.id;var update1=AutomationWorkflowResource.updateStep(children_step);promises.push(update1.$promise);var parentNextType="next";if(parent.type==="CONDITION"){if(parent.data.next_yes==item.id){parentNextType="next_yes"}else if(parent.data.next_no==item.id){parentNextType="next_no"}}if(parentNextType!=="next"){parent.data[parentNextType]=children_step.id;var update2=AutomationWorkflowResource.updateStep(parent);promises.push(update2.$promise)}$q.all(promises).then(function(){if(typeof callback==="function"){callback()}})}}}else if(item.data&&item.data.valid==1){if(item.type==="DELAY"&&moment($scope.automation.activated_at).isAfter(moment(item.created_at))){modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Please confirm","/automation"),body:$filter("translate")("All subscribers waiting at this step will be removed from the workflow.","/automation"),button_cancel:$filter("translate")("Cancel","/automation"),button_ok:$filter("translate")("Delete","/automation"),button_ok_class:"btn-red"}}}})}else{modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{title:$filter("translate")("Please confirm","/automation"),body:$filter("translate")("Do you really want to delete this step?","/automation"),button_cancel:$filter("translate")("Cancel","/automation"),button_ok:$filter("translate")("Delete","/automation"),button_ok_class:"btn-red"}}}})}modalInstance.result.then(function(){$scope.checkIfCanDeleteStep(item,function(canDelete){if(canDelete){killThisStep()}else{leaveThisStep()}})},function(){leaveThisStep()})}else{$scope.checkIfCanDeleteStep(item,function(canDelete){if(canDelete){killThisStep()}else{leaveThisStep()}})}function killThisStep(withChildren){var deletionIndex=parent.next.indexOf(item);parent.next.splice(deletionIndex,1);var parentNextType="next";if(parent.type==="CONDITION"){if(parent.data.next_yes==item.id){parentNextType="next_yes"}else if(parent.data.next_no==item.id){parentNextType="next_no"}}if(parent.type==="CONDITION"&&(withChildren||!item.next.length)&&parentNextType!=="next"){parent.data[parentNextType]="";AutomationWorkflowResource.updateStep(parent)}if(withChildren){var mail_ids=[];(function recursiveWalk(stepArray){stepArray.forEach(function(step){if(step.type==="EMAIL"&&step.data&&step.data.mail_id){mail_ids.push(step.data.mail_id)}recursiveWalk(step.next)})})(item.next);AutomationWorkflowResource.batchDeleteWorkflowMail({mail_ids:mail_ids})}else{item.next.forEach(function(step){step.parent_id=parent.id;parent.next.push(step);AutomationWorkflowResource.updateStep(step);if(parent.type==="CONDITION"){parent.data[parentNextType]=step.id;AutomationWorkflowResource.updateStep(parent)}})}AutomationWorkflowResource.deleteStep({step_id:item.id});$scope.loadSidebar();if(item.type==="EMAIL"&&item.data&&item.data.mail_id){AutomationWorkflowResource.deleteWorkflowMail({mail_id:item.data.mail_id})}else if(item.type==="DELAY"&&item.data&&item.data.hasOwnProperty("valid")&&item.data.valid==1){generateDelayEmailMap()}if(typeof afterKillCallback==="function"){afterKillCallback()}}function leaveThisStep(){item.deleted=false}}cleanDeletedItems(item.next,item,afterKillCallback)})}$scope.duplicatingEmails=[];$scope.duplicateStep=function(step,parentNextType,$event){if(window.automation_step_update_count){return}$event.stopPropagation();if(step.type==="EMAIL"){var newStepData={};$scope.addStep("EMAIL",step,parentNextType,newStepData,function(newStep){stepSavedAndCopied("saved",newStep)},function(newStep){$scope.duplicatingEmails.push(newStep);var params={mail_id:step.data.mail_id};AutomationWorkflowResource.copyMail(params,function(response){newStep.data=angular.copy(step.data);newStep.data.mail_id=response.mail.id;newStep.data.code=response.mail.code;newStep.data.report_id=response.mail.report_id;$scope.sidebar.data=newStep.data;$scope.sidebar.cancelData=angular.copy($scope.sidebar.data);stepSavedAndCopied("copied",newStep)})});var savedAndCopiedCheck={saved:false,copied:false};function stepSavedAndCopied(what,step){if(!savedAndCopiedCheck[what]){savedAndCopiedCheck[what]=true}if(savedAndCopiedCheck["saved"]&&savedAndCopiedCheck["copied"]){AutomationWorkflowResource.updateStep(step);$scope.duplicatingEmails.splice($scope.duplicatingEmails.indexOf(step),1)}}}else{console.warn("Wrong step type for duplicateStep().")}};$scope.cancelSidebar=function(){if(!$scope.sidebar.include){return}if(!$scope.sidebar.cancelData){return}$scope.sidebar.step.data=$scope.sidebar.cancelData;$scope.loadSidebar()};$scope.updateFieldActionTypesForNumber={SET:{code:"SET",title:"Set value"},INCREASE:{code:"INCREASE",title:"Increase value"},DECREASE:{code:"DECREASE",title:"Decrease value"}};$scope.updateFieldActionTypesForDate={SET:{code:"SET",title:"Set value"},INCREASE:{code:"INCREASE",title:"Increase by days"},DECREASE:{code:"DECREASE",title:"Decrease by days"}};$scope.updateFieldActionTypes=$scope.updateFieldActionTypesForNumber;$scope.updateFieldActionTypesSorted=[];Object.keys($scope.updateFieldActionTypes).forEach(function(key){$scope.updateFieldActionTypesSorted.push($scope.updateFieldActionTypes[key])});$scope.afterSelectUpdatedField=function(field){if(field.type=="TEXT"){return}var typeKey="updateFieldActionTypesForNumber";if(field.type=="DATE"){typeKey="updateFieldActionTypesForDate"}$scope.updateFieldActionTypes=$scope[typeKey];$scope.updateFieldActionTypesSorted=[];Object.keys($scope[typeKey]).forEach(function(key){$scope.updateFieldActionTypesSorted.push($scope[typeKey][key])})};$scope.loadFields=function(params){$scope.fields=[];$scope.fieldsLoading=true;if(typeof params==="undefined"){params={}}ApiFields.queryNoCache(params,function(fields){if(params.blacklist&&params.blacklist.length){fields=fields.filter(function(field){return params.blacklist.indexOf(field.var)===-1})}fields.forEach(function(field){$scope.fields.push({id:String(field.id),title:field.title,var:field.var,type:field.field_type})});$scope.updateStepObjectAfterLoad($scope.sidebar.step,"field",$scope.fields);$scope.fieldsLoading=false;if(typeof $scope.sidebar.data.field!="undefined"){$scope.afterSelectUpdatedField($scope.sidebar.data.field)}})};$scope.loadConditionFields=function(condition,params){condition.temp_fields=[];condition.temp_fieldsLoading=true;if(typeof params==="undefined"){params={}}ApiFields.queryNoCache(params,function(fields){if(params.blacklist&&params.blacklist.length){fields=fields.filter(function(field){return params.blacklist.indexOf(field.var)===-1})}fields.forEach(function(field){condition.temp_fields.push({id:String(field.id),title:field.title,var:field.var,type:field.field_type})});condition.temp_fieldsLoading=false})};$scope.editMail=function(){if(window.automation_step_update_count){return}var valid=$scope.validateSidebar();if(!valid){return}if($scope.sidebar.data.screenshot){var tmp_screenshot=$scope.sidebar.data.screenshot;var tmp_screenshot_big=$scope.sidebar.data.screenshot_big;delete $scope.sidebar.data.screenshot;delete $scope.sidebar.data.screenshot_big;delete $scope.sidebar.data.fake_screenshot;delete $scope.sidebar.data.fake_screenshot_big;var params={id:$scope.sidebar.step.id,type:$scope.sidebar.step.type,parent_id:$scope.sidebar.step.parent_id,data:angular.copy($scope.sidebar.step.data)};AutomationWorkflowResource.updateStep(params);$scope.sidebar.data.fake_screenshot=tmp_screenshot;$scope.sidebar.data.fake_screenshot_big=tmp_screenshot_big}if($scope.sidebar.data.mail_id){var subjectParams={mail_id:$scope.sidebar.step.data.mail_id,subject:$scope.sidebar.step.data.subject,from:$scope.sidebar.step.data.from,from_name:$scope.sidebar.step.data.from_name,analytics:Number($scope.sidebar.step.data.google_analytics)?1:0};$.post("/automation/set_mail_data/",subjectParams,function(response){},"json");window.location="/emails/step2/"+$scope.sidebar.data.mail_id;return}$scope.creating_new_mail=true;if($scope.sidebar.step.data.subject){$scope.sidebar.step.data.subject=replaceImgToAltAndRemoveHtml($scope.sidebar.step.data.subject,true)}AutomationWorkflowResource.createNewMail($scope.sidebar.data,function(response){$scope.sidebar.data.mail_id=response.mail.id;$scope.sidebar.data.report_id=response.mail.report_id;$scope.sidebar.data.code=response.mail.code;$scope.sidebar.data.plain=response.mail.plain;$scope.saveSidebar(true);window.location="/emails/step2/"+$scope.sidebar.data.mail_id})};$scope.scrollSidebar=function(direction){var sidebar_content=$(".sidebar-content");var sidebar_include=$(".sidebar-include");var scrollTop=0;switch(direction){case"bottom":scrollTop=sidebar_include.outerHeight();break}sidebar_content.animate({scrollTop:scrollTop},"slow")};$scope.loadGroups=function(params){$scope.groups=[];$scope.groupsLoading=true;ApiGroups.query({},function(groups){var excludeGroups=!$scope.sidebar.step.data.exclude?[]:$scope.sidebar.step.data.exclude;groups.forEach(function(group){if(params&&params.blacklist&&params.blacklist.indexOf(String(group.id))!==-1){return}$scope.groups.push({id:String(group.id),name:group.name,total:group.total,date:group.date,excluded:excludeGroups.indexOf(String(group.id))>-1})});$scope.updateStepObjectAfterLoad($scope.sidebar.step,"group",$scope.groups);$scope.groupsLoading=false})};$scope.loadConditionGroups=function(condition){condition.temp_groups=[];condition.temp_groupsLoading=true;ApiGroups.query({},function(groups){groups.forEach(function(group){condition.temp_groups.push({id:String(group.id),name:group.name,total:group.total,date:group.date})});condition.temp_groupsLoading=false})};$scope.loadForms=function(){$scope.forms=[];$scope.formsLoading=true;ApiGroups.getForms({},function(forms){forms.forEach(function(form){$scope.forms.push({id:String(form.id),name:form.name,type:form.type,total:form.total,time_created:form.time_created})});$scope.formsLoading=false})};$scope.loadSegments=function(condition){condition.temp_segments=[];condition.temp_segmentsLoading=true;ApiSegments.get(function(segments){segments.data.forEach(function(segment){condition.temp_segments.push({id:String(segment.id),name:segment.title,total:segment.total,created_at:segment.created_at})});condition.temp_segmentsLoading=false});return;$scope.segments=[];$scope.segmentsLoading=true;ApiGroups.getSegments({id:group_id},function(segments){segments.forEach(function(segment){$scope.segments.push({id:String(segment.id),name:segment.name})});$scope.updateStepObjectAfterLoad($scope.sidebar.step,"segment",$scope.segments);$scope.segmentsLoading=false})};$scope.createNewGroup=function(){var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/ask_modal.html",controller:"ModalInstanceController",resolve:{data:function(){var modal_string_values={title:$filter("translate")("Add new group","/automation"),label:$filter("translate")("Group name","/automation"),default_value:"",placeholder:$filter("translate")("Enter group name","/automation"),button_ok:$filter("translate")("Create","/automation"),button_cancel:$filter("translate")("Cancel","/automation")};return modal_string_values}}});modalInstance.result.then(function(modalResponse){GroupsService.create({name:modalResponse.input},function(response){if(response.success){response.data={id:String(response.data.id),name:response.data.name,excluded:false};$scope.groups.push(response.data);$scope.sidebar.data.group=response.data;$scope.sidebar.data.group_id=$scope.sidebar.data.group.id}})})};$scope.excludeGroup=function(){var url="/views/automation/modals/group_select_modal.html";$scope.groups_with_info=[];ApiGroups.get(function(response){response.forEach(function(group){$scope.groups.forEach(function(g){if(g.id==group.id){g.total=group.total;g.date=group.date}})});var modalInstance=$modal.open({templateUrl:url,controller:"ModalInstanceController",resolve:{data:function(){return{groups:angular.copy($scope.groups),selectedGroup:$scope.sidebar.data.group}}}});modalInstance.result.then(function(modalResponse){$scope.groups=modalResponse.groups;$scope.sidebar.step.data.exclude=modalResponse.groups.filter(function(group){return group.excluded}).map(function(group){return group.id});if(!$scope.sidebar.step.data.exclude.length){delete $scope.sidebar.step.data.exclude}})})};$scope.createNewField=function(title){ApiFields.create({title:title,type:"DATE"},function(field){field={id:field.id,title:field.title,var:field.var,type:field.field_type};$scope.fields.push(field);$scope.sidebar.data.field=field;$scope.sidebar.data.field_id=field.id})};$scope.$on("workflowStateChange",function(event,state){$scope.automation.active=!$scope.automation.active||$scope.automation.active==0?false:true;if($scope.automation.active==state){return}if(state){$scope.activationLoading=true;if($scope.tree[0].data.type!=1){performActivationWithActivationType(state,"ignore")}else{AutomationResource.getNontriggeredOnlyNewCount({workflow_id:window.automation.id},function(response){if(Number(response.count)===0){performActivationWithActivationType(state,"ignore")}else{$scope.sidebar.data.add_subscribers_to_workflow_type="ignore";getListOfStepsDataByType=function(type){function recursiveWalk(steps){steps.forEach(function(step){if(step.type===type&&step.data&&typeof step.data==="object"&&step.data.valid==1){step.data.step_id=step.id;list.push(step.data)}var nextStep=step.next;if(nextStep){recursiveWalk(nextStep)}})}var list=[];recursiveWalk($scope.tree);return list};var stepsByType={EMAIL:[],DELAY:[],CONDITION:[],ACTION:[]};stepsByType.EMAIL=getListOfStepsDataByType("EMAIL")
;stepsByType.DELAY=getListOfStepsDataByType("DELAY");stepsByType.CONDITION=getListOfStepsDataByType("CONDITION");stepsByType.ACTION=getListOfStepsDataByType("ACTION");stepsByType.ACTION=stepsByType.ACTION.filter(function(data){return data.type!=="move_to_another_step"});var stepTypes={DELAY:{code:"DELAY",title:"Delay"},EMAIL:{code:"EMAIL",title:"Email"},CONDITION:{code:"CONDITION",title:"Condition"},ACTION:{code:"ACTION",title:"Action"}};var selectedStep=null;var step_type=null;var selectedStepId=null;var modalInstance=$modal.open({templateUrl:"/views/automation/modals/automation_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{count:response.count,type:$scope.sidebar.data.add_subscribers_to_workflow_type,step_type:step_type,step_types:stepTypes,steps_by_type:stepsByType,selected_step:selectedStep,selected_step_id:selectedStepId,getScreenshot:function(item){if(item.valid&&(item.screenshot||item.fake_screenshot)){var screenshot=item.screenshot||item.fake_screenshot;if(screenshot.charAt(0)!=="/"&&screenshot.substr(0,4)!=="http"){screenshot="/"+screenshot}return screenshot}return"/assets/images/workflow/workflow_screenshot.png"}}}},backdrop:"static",keyboard:false,windowClass:"modal-content-overflow-inherit"});modalInstance.result.then(function(modalResponse){if(modalResponse.activation_type=="specific_step"&&modalResponse.selected_step_id){performActivationWithActivationType(state,modalResponse.activation_type,modalResponse.selected_step_id)}else{performActivationWithActivationType(state,modalResponse.activation_type)}},function(reason){$scope.activationLoading=false;if(reason==="cancel"){window.activationSwitch.bootstrapSwitch("state",false)}})}})}}else{$scope.automation.active=state;$scope.activationLoading=true;AutomationWorkflowResource.updateAutomation({active:state},function(response){$scope.automation=response;$scope.activationLoading=false;if(response.activated_at){$scope.automation.activated_at=response.activated_at}});var isSaveNeeded=false;if($scope.tree[0].data.isTriggerSaveConfirmationNeeded){delete $scope.tree[0].data.isTriggerSaveConfirmationNeeded;isSaveNeeded=true}if($scope.tree[0].data.changed){delete $scope.tree[0].data.changed;isSaveNeeded=true}if(isSaveNeeded){AutomationWorkflowResource.updateStep($scope.tree[0])}}function performActivationWithActivationType(state,activation_type,first_step_id){first_step_id=typeof first_step_id!=="undefined"?first_step_id:null;$scope.automation.active=state;$scope.activationLoading=true;AutomationWorkflowResource.updateAutomation({active:state,activation_type:activation_type,first_step_id:first_step_id},function(response){$scope.automation=response;$scope.activationLoading=false;if(response.activated_at){$scope.automation.activated_at=response.activated_at}});if(!$scope.tree[0].data.workflowWasActive){$scope.tree[0].data.workflowWasActive=true;delete $scope.tree[0].data.changed;AutomationWorkflowResource.updateStep($scope.tree[0])}}});window.screenshot_updated=function(mail,step_id){if(!mail.valid||!step_id){delete mail.screenshot;delete mail.screenshot_big;return}var step=$scope.getStepById(step_id);AutomationWorkflowResource.updateStep(step)};function getDelayEmailMap(){var delayEmailMap=$scope.tree[0].data.delayEmailMap;if(!delayEmailMap){delayEmailMap=generateDelayEmailMap()}return delayEmailMap}function generateDelayEmailMap(){var resultDelayEmailMap={};(function recursiveWalkParents(stepArray,delayArray){stepArray.forEach(function(step){var uniqueDelayArray=angular.copy(delayArray);if(step.type==="TRIGGER"&&step.data&&step.data.trigger&&step.data.trigger.id=="11"){uniqueDelayArray.push({delay_unit:step.data.ecommerce_delay_unit||"hours",value:step.data.ecommerce_delay||6})}else if(step.type==="EMAIL"&&step.data&&step.data.mail_id){resultDelayEmailMap[step.data.mail_id]=uniqueDelayArray}else if(step.type==="DELAY"&&step.data&&step.data.valid==1){uniqueDelayArray.push(step.data)}recursiveWalkParents(step.next,uniqueDelayArray)})})($scope.tree,[]);$scope.tree[0].data.delayEmailMap=resultDelayEmailMap;delete $scope.tree[0].data.changed;AutomationWorkflowResource.updateStep($scope.tree[0]);return resultDelayEmailMap}window.generateDelayEmailMap=generateDelayEmailMap;$scope.triggerDelay=function(topStep){if(!topStep.data.mail_id){return""}var map=getDelayEmailMap();if(!map[topStep.data.mail_id]){map=generateDelayEmailMap()}var delayArray=map[topStep.data.mail_id];var diff=0;if(delayArray&&delayArray.length){diff=getEmailDelayDiff(delayArray)}if(diff===false){return $filter("translate")("Will not be sent","/automation")}else if(diff===0||diff.diff===0){return $filter("translate")("On trigger","/automation")}else{diff.from=diff.from.replace(/^in /,"");return $filter("translate")("{$delay_value} after trigger","/automation").replace("{$delay_value}",diff.from.charAt(0).toUpperCase()+diff.from.slice(1))}};function getEmailDelayDiff(delayArray){var now=moment();var diff=now.clone();delayArray.forEach(function(delay){if(!diff){return}switch(delay.delay_unit){case"next_date":var delayMoment=moment(delay.date+" "+delay.hours+":"+delay.minutes);var dateDiff=delayMoment.diff(diff);if(dateDiff<0){diff=false;return}diff.add(dateDiff,"milliseconds");break;case"next":var nextDelay=diff.clone();nextDelay.hour(delay.hours);nextDelay.minute(delay.minutes);nextDelay.second(0);nextDelay.millisecond(0);if(nextDelay.isBefore(diff)){nextDelay.add(1,"day")}diff=nextDelay;break;case"next_monthday":if(!delay.days||!delay.days.length){diff=false;return}diff.hour(delay.hours);diff.minute(delay.minutes);diff.second(0);diff.millisecond(0);if(isMonthdayToday(diff)){diff.add(1,"day")}var iterations=0;while(!isMonthdayToday(diff)){iterations+=1;if(iterations>100){console.log("iterations overflow");diff=false;return}diff.add(1,"day")}function isMonthdayToday(diff){if(delay.days.indexOf("last_day")!==-1){return diff.daysInMonth()===Number(diff.format("D"))}return delay.days.indexOf(diff.format("D"))!==-1}break;case"next_weekday":if(!delay.days||!delay.days.length){diff=false;return}diff.hour(delay.hours);diff.minute(delay.minutes);diff.second(0);diff.millisecond(0);if(isWeekdayToday(diff)){diff.add(1,"day")}var iterations=0;while(!isWeekdayToday(diff)){iterations+=1;if(iterations>100){console.log("iterations overflow");diff=false;return}diff.add(1,"day")}function isWeekdayToday(diff){return delay.days.indexOf(diff.format("E"))!==-1}break;default:diff.add(delay.value,delay.delay_unit);break}});if(!diff){return false}return{diff:diff.diff(now),from:diff.from(now)}}$scope.updateStepObjectAfterLoad=function(step,objectKey,objectsFromApi,idSelector){idSelector=idSelector||"id";if(!step||!step.data||!step.data[objectKey]||!step.data[objectKey][idSelector]){return}if(!objectsFromApi.length){delete step.data[objectKey];if(step.type==="TRIGGER"){delete step.data.changed}AutomationWorkflowResource.updateStep(step);return}var selectedObjectInApiObjects=objectsFromApi.filter(function(object){return String(object[idSelector])===String(step.data[objectKey][idSelector])});if(!selectedObjectInApiObjects.length){delete step.data[objectKey];if(step.type==="TRIGGER"){delete step.data.changed}AutomationWorkflowResource.updateStep(step);return}var isObjectsEqual=angular.equals(selectedObjectInApiObjects[0],step.data[objectKey]);if(!isObjectsEqual){step.data[objectKey]=selectedObjectInApiObjects[0];if(step.type==="TRIGGER"){delete step.data.changed}AutomationWorkflowResource.updateStep(step)}};$scope.checkMailType=function(step){if(step.data&&!step.data.type&&step.data.mail_id){AutomationWorkflowResource.checkMail({mail_id:step.data.mail_id},function(response){if(response.length){if(response[0].type===null){killMailIdAndOthers()}else{saveMailType(response[0].type)}}else{killMailIdAndOthers()}});function killMailIdAndOthers(){AutomationWorkflowResource.deleteWorkflowMail({mail_id:step.data.mail_id});delete step.data.mail_id;delete step.data.report_id;delete step.data.code;delete step.data.screenshot;delete step.data.screenshot_big;delete step.data.screenshot_big;delete step.data.valid;AutomationWorkflowResource.updateStep(step);countIncompleteSteps()}function saveMailType(type){step.data.type=type;AutomationWorkflowResource.updateStep(step)}}};$scope.closeAllPopovers=window.closeAllPopovers;window.drop_faulty_steps=function(stepIds){AutomationWorkflowResource.dropFaultySteps({ids:stepIds})};$scope.getListOfStepsDataByType=function(type){function recursiveWalk(steps){steps.forEach(function(step){if(step.type===type&&step.data&&typeof step.data==="object"&&step.data.valid==1){step.data.step_id=step.id;list.push(step.data)}var nextStep=step.next;if(nextStep){recursiveWalk(nextStep)}})}var list=[];recursiveWalk($scope.tree);return list};$scope.getListOfStepsDataByTypeWithoutMoveToAnotherStep=function(type){function recursiveWalk(steps){steps.forEach(function(step){if(step.type===type&&step.data&&typeof step.data==="object"&&step.data.valid==1){step.data.step_id=step.id;list.push(step.data)}var nextStep=step.next;if(nextStep){recursiveWalk(nextStep)}})}var list=[];recursiveWalk($scope.tree);if(type==="ACTION"){list=list.filter(function(data){return data.type!=="move_to_another_step"})}return list};$scope.addSubscribersToWorkflow=function(){$scope.sidebar.data.add_subscribers_to_workflow_type="from_beginning";getListOfStepsDataByType=function(type){function recursiveWalk(steps){steps.forEach(function(step){if(step.type===type&&step.data&&typeof step.data==="object"&&step.data.valid==1){step.data.step_id=step.id;list.push(step.data)}var nextStep=step.next;if(nextStep){recursiveWalk(nextStep)}})}var list=[];recursiveWalk($scope.tree);return list};var stepsByType={EMAIL:[],DELAY:[],CONDITION:[],ACTION:[]};stepsByType.EMAIL=getListOfStepsDataByType("EMAIL");stepsByType.DELAY=getListOfStepsDataByType("DELAY");stepsByType.CONDITION=getListOfStepsDataByType("CONDITION");stepsByType.ACTION=getListOfStepsDataByType("ACTION");stepsByType.ACTION=stepsByType.ACTION.filter(function(data){return data.type!=="move_to_another_step"});var stepTypes={DELAY:{code:"DELAY",title:"Delay"},EMAIL:{code:"EMAIL",title:"Email"},CONDITION:{code:"CONDITION",title:"Condition"},ACTION:{code:"ACTION",title:"Action"}};var selectedStep=null;var step_type=null;var selectedStepId=null;var modalInstance=$modal.open({templateUrl:"/views/automation/modals/add_subscribers_to_workflow.html",controller:"ModalInstanceController",resolve:{data:function(){return{count:$scope.nonTriggeredCount,type:$scope.sidebar.data.add_subscribers_to_workflow_type,step_type:step_type,step_types:stepTypes,steps_by_type:stepsByType,selected_step:selectedStep,selected_step_id:selectedStepId,getScreenshot:function(item){if(item.valid&&(item.screenshot||item.fake_screenshot)){var screenshot=item.screenshot||item.fake_screenshot;if(screenshot.charAt(0)!=="/"&&screenshot.substr(0,4)!=="http"){screenshot="/"+screenshot}return screenshot}return"/assets/images/workflow/workflow_screenshot.png"}}}},backdrop:"static",keyboard:false,windowClass:"modal-content-overflow-inherit"});modalInstance.result.then(function(modalResponse){var first_step=null;if(modalResponse.type==="specific_step"&&modalResponse.selected_step_id){first_step=modalResponse.selected_step_id}AutomationResource.triggerNontriggeredSubscribers({workflow_id:$scope.automation.id,first_step_id:first_step},function(){$scope.setNonTriggeredAlertValue(true);$scope.nonTriggeredCount=0})})};$scope.nonTriggeredCount=0;$scope.checkNonTriggeredAlertValue();AutomationResource.getNontriggeredCount({workflow_id:window.automation.id},function(response){$scope.nonTriggeredCount=Number(response.count)});$scope.groups_by_id={};ApiGroups.getAllGroupsAndSegments(function(response){response.forEach(function(group){$scope.groups_by_id[group.id]=group})});$scope.fields_by_id={};ApiFields.query(function(response){response.forEach(function(field){$scope.fields_by_id[field.id]=field})});var shouldNotGoBackBlacklist=["/emails/step2/"];if(false&&typeof window.sessionStorage!=="undefined"){if(window.location&&window.location.origin){var reffererHostInternal=document.referrer.indexOf(window.location.origin)!==-1;var reffererIsBlacklisted=false;shouldNotGoBackBlacklist.forEach(function(item){if(document.referrer.indexOf(item)!==-1){reffererIsBlacklisted=true}});if(reffererHostInternal&&!reffererIsBlacklisted){sessionStorage.setItem("backToAutomationUrl",document.referrer)}}$scope.backToAutomationUrl=window.sessionStorage.getItem("backToAutomationUrl")}if(!$scope.backToAutomationUrl){$scope.backToAutomationUrl="/automation"}$scope.capitalize=function(string){return string.charAt(0).toUpperCase()+string.slice(1)};$scope.displayFormTitleCallback=function(item){return'<div class="title">'+item.name+" ("+$scope.capitalize(item.type)+")"+"</div>"+'<div class="description small">'+item.total+" subscribers"+" • Created on "+item.time_created+"</div>"};$scope.displayGroupTitleCallback=function(item){return'<div class="title">'+item.name+"</div>"+'<div class="description small">'+item.total+" subscribers"+" • Created on "+item.date+"</div>"};$scope.displaySegmentTitleCallback=function(item){return'<div class="title">'+item.name+"</div>"+'<div class="description small">'+item.total+" subscribers"+" • Created on "+item.created_at+"</div>"}}]).controller("AutomationWorkflowTriggerController",["$scope","$http","$timeout","AutomationWorkflowResource","ApiGroups","ApiFields",function($scope,$http,$timeout,automationWorkflowResource,ApiGroups,ApiFields){if(window.shopify_shops&&window.shopify_shops.length==1&&($scope.sidebar.data&&!$scope.sidebar.data.shop_id&&window.shopify_shops[0].id)){$scope.sidebar.data.shop_id=window.shopify_shops[0].id;$scope.sidebar.data.shopify_origin=window.shopify_shops[0].shopify_origin}else if(window.woocommerce_shops&&window.woocommerce_shops.length==1&&($scope.sidebar.data&&!$scope.sidebar.data.shop_id&&window.woocommerce_shops[0].id)){$scope.sidebar.data.shop_id=window.woocommerce_shops[0].id;$scope.sidebar.data.shopify_origin=window.woocommerce_shops[0].shopify_origin}if($scope.sidebar.data&&$scope.sidebar.data.shop_id&&$scope.sidebar.data.shopify_origin==null){$scope.sidebar.data.shopify_origin=true}$scope.productsPicked=function(products,shop){$scope.sidebar.data.ecommerce_product=false;if(products&&products.length&&products[0]&&products[0].id){$scope.sidebar.data.shop_id=shop.id;$timeout(function(){$scope.sidebar.data.ecommerce_product={id:products[0].id,image:products[0].image&&products[0].image.src,title:products[0].title}})}};$scope.$watch("sidebar.data.automation_type",function(new_type,old_type){if(new_type&&old_type&&new_type!==old_type){$scope.sidebar.step.data.valid=false}});$scope.commonTriggerFields=["title","incompleteStepsCount","changed","delayEmailMap","isTriggerSaveConfirmationNeeded","workflowWasActive","automation_type","shop","shop_id","send_once","shop_id","shopify_origin"];$scope.changeWorkflowTrigger=function(newTrigger){if(!$scope.sidebar||!$scope.sidebar.data||typeof $scope.sidebar.data!=="object"){return false}if($scope.sidebar.data.trigger&&(Number($scope.sidebar.data.trigger.id===Number(newTrigger.id))||Number($scope.sidebar.data.type===Number(newTrigger.id)))){return true}Object.keys($scope.sidebar.data).forEach(function(key){if($scope.commonTriggerFields.indexOf(key)===-1){delete $scope.sidebar.data[key]}});$scope.sidebar.data.trigger=newTrigger;$scope.sidebar.data.type=newTrigger.id};$scope.ecommerceCategoriesLoading=true;$scope.ecommerceCategories=[];$scope.ecommerceShopsByIds=[];if($scope.window.shopify_shops){$scope.window.shopify_shops.forEach(function(shop){$scope.ecommerceShopsByIds[shop.id]=shop})}if($scope.window.woocommerce_shops){$scope.window.woocommerce_shops.forEach(function(shop){$scope.ecommerceShopsByIds[shop.id]=shop})}$scope.ecommerceShopsByIds=$scope.ecommerceShopsByIds.filter(function(el){return el!=null});function reloadCategories(){$scope.ecommerceCategoriesLoading=true;$scope.ecommerceCategories=[];$scope.ecommerceCategoriesById={};if($scope.sidebar.data.shop_id){if($scope.sidebar.data.shopify_origin){$http.get("/shopify/shop_categories/"+$scope.sidebar.data.shop_id).success(function(data){$scope.ecommerceCategories=data;data.forEach(function(col){$scope.ecommerceCategoriesById[col.id]=col});$scope.ecommerceCategoriesLoading=false}).error(function(){$scope.ecommerceCategoriesLoading=false})}else{automationWorkflowResource.getWooCommerceShopCategories({shop_id:$scope.sidebar.data.shop_id},function(data){$scope.ecommerceCategories=data.categories;data.categories.forEach(function(col){$scope.ecommerceCategoriesById[col.id]=col});$scope.ecommerceCategoriesLoading=false})}}}$scope.$watch("sidebar.data.shop_id",function(new_id,old_id){$scope.selected_shop=$scope.ecommerceShopsByIds.filter(function(el){if(el.id==$scope.sidebar.data.shop_id){return true}});if($scope.sidebar.data.trigger&&$scope.sidebar.data.trigger.id==="10"){reloadCategories()}if(new_id&&old_id&&new_id!==old_id){$scope.sidebar.data.ecommerce_category_id=undefined;$scope.sidebar.data.ecommerce_category_title=undefined;$scope.sidebar.data.ecommerce_product=false}});$scope.$watch("sidebar.data.trigger.id",function(new_trigger){if(new_trigger==="10"){reloadCategories()}});$scope.loadTriggers=function(){$scope.triggers=[{id:"1",name:"When subscriber joins a group",description:"Workflow triggered when a subscriber joins your subscriber group.",segment:false,automation:false,date:false,order:1,icon:'<span class="icon trigger-group"></span>'},{id:"2",name:"The anniversary of a date",description:"Workflow triggered every year on specific dates (great for birthdays, wedding anniversary, etc.)",segment:false,automation:false,date:true,order:5,icon:'<span class="icon trigger-anniversary"></span>'},{id:"3",name:"The exact match of a date",description:"Workflow triggered on a specific date (great for subscriptions, free trials, etc.)",segment:false,automation:false,date:true,order:6,icon:'<span class="icon trigger-date"></span>'},{id:"6",name:"When subscriber clicks a link",description:"Workflow triggered when a subscriber clicks a link in any campaign or automation workflow.",segment:false,automation:false,date:false,order:3,icon:'<span class="icon trigger-click"></span>'}];if($scope.tags_enabled){$scope.triggers.push({id:"7",name:"Updated field",description:"Workflow triggered when a subscriber field is updated.",group:false,segment:false,automation:false,date:false,order:4,icon:'<span class="icon trigger-field"></span>'})}else{$scope.triggers.push({id:"4",name:"When subscriber joins a segment",description:"Send an email or series of emails when a subscriber joins a new segment.",segment:true,automation:false,date:false,order:7,icon:'<span class="icon trigger-group"></span>'});$scope.triggers.push({id:"5",name:"When subscriber exits a segment",description:"Send an email or series of emails when a subscriber exits an existing segment.",segment:true,automation:false,date:false,order:8,icon:'<span class="icon trigger-group"></span>'})}$scope.triggers.push({id:"8",name:"Purchases any product",description:"Workflow triggered when a shopper purchases on any product in your store.",automation:true,segment:true,date:false,order:11,icon:'<span class="icon trigger-any-product"></span>'});$scope.triggers.push({id:"9",name:"Purchases specific product",description:"Workflow triggered when a shopper purchases a specific product in your store.",automation:true,segment:true,date:false,order:12,icon:'<span class="icon trigger-specific-product"></span>'});$scope.triggers.push({id:"10",name:"Purchase from category",description:"Workflow triggered when a shopper purchases a product from a specific category.",automation:true,segment:true,date:false,order:13,icon:'<span class="icon trigger-category"></span>'});$scope.triggers.push({id:"11",name:"Abandoned checkout",type:"abandoned_checkout",description:"Workflow triggered when a shopper provides their email and leaves before purchasing.",automation:true,segment:true,date:false,order:10,icon:'<span class="icon trigger-abandoned-cart"></span>'});$scope.triggers.push({id:"12",name:"When subscriber completes a form",description:"Workflow triggered when a person subscribes to a form.",automation:false,segment:false,form:false,date:false,order:2,icon:'<span class="icon trigger-form"></span>'});$scope.sidebar.data.type=$scope.sidebar.data.type||0;$scope.sidebar.data.trigger=$scope.sidebar.data.trigger||false};$scope.createANewGroup=function(){if($scope.sidebar.data.newGroupName){$scope.sidebar.data.newGroupNameError=false;$scope.sidebar.data.inlineGroupCreation=false;$scope.groupsLoading=true;ApiGroups.createGroup({name:$scope.sidebar.data.newGroupName},function(newGroup){newGroup.excluded=false;newGroup.total=0;$scope.groups_by_id[newGroup.id]=newGroup;$scope.groups.push(newGroup);$scope.sidebar.data.group=newGroup;$scope.sidebar.data.group_id=newGroup.id;$scope.groupsLoading=false});$scope.sidebar.data.inlineFieldCreation=false}else{$scope.sidebar.data.newGroupNameError=true}};$scope.fieldsTypes={TEXT:{type:"TEXT",title:"Text"},NUMBER:{type:"NUMBER",title:"Number"},DATE:{type:"DATE",title:"Date"}};$scope.fieldsTypesSorted=[];Object.keys($scope.fieldsTypes).forEach(function(key){$scope.fieldsTypesSorted.push($scope.fieldsTypes[key])});$scope.setNewFieldType=function(type){$scope.sidebar.data.newFieldType=type};$scope.createANewField=function(){if($scope.sidebar.data.newFieldName){$scope.sidebar.data.newFieldNameError=false;$scope.sidebar.data.inlineFieldCreation=false;$scope.fieldsLoading=true;ApiFields.create({title:$scope.sidebar.data.newFieldName,type:$scope.sidebar.data.newFieldType},function(field){field={id:field.id,title:field.title,var:field.var,type:field.field_type};$scope.fields.push(field);$scope.sidebar.data.field=field;$scope.sidebar.data.field_id=field.id;$scope.fieldsLoading=false})}else{$scope.sidebar.data.newFieldNameError=true}};$scope.fieldRulesForTextAndNumber={is_equal:{code:"is_equal",title:"is equal"},is_not_equal:{code:"is_not_equal",title:"is not equal"},contains:{code:"contains",title:"contains"},does_not_contain:{code:"does_not_contain",title:"does not contain"},is_provided:{code:"is_provided",title:"is provided"},is_not_provided:{code:"is_not_provided",title:"is not provided"},is_in_array:{code:"is_in_array",title:"is one of"},is_not_in_array:{code:"is_not_in_array",title:"is not one of"}};$scope.fieldRulesForDate={is_after:{code:"is_after",title:"is after"},is_before:{code:"is_before",title:"is before"},is_equal:{code:"is_equal",title:"is equal"},is_provided:{code:"is_provided",title:"is provided"}};$scope.afterSelectECommerceCategory=function(item){$scope.sidebar.data.ecommerce_category_title=item.title};$scope.switchAutomationType=function(type){$scope.sidebar.data.automation_type=type;var differentType="email";if(type==="email"){differentType="ecommerce"}var oldKey="old_"+differentType;var thisOldKey="old_"+type;if($scope[oldKey]==null){$scope[oldKey]=$scope.sidebar.data.trigger}$scope.sidebar.data.trigger=null;if($scope[thisOldKey]){$scope.sidebar.data.trigger=$scope[thisOldKey];$scope[thisOldKey]=null}}}]).controller("AutomationWorkflowEmailController",["$scope","$modal","$filter","EmailsService","ApiReports",function($scope,$modal,$filter,EmailsService,ApiReports){$scope.init=function(){$scope.sidebar.data.from=$scope.sidebar.data.from||window.from||"";$scope.sidebar.data.from_name=$scope.sidebar.data.from_name||window.from_name||"";$scope.account_approved=window.account_approved;if(!$scope.sidebar.data.language){var fallback_language=false;var defaultLanguageArray=$scope.mail_languages.filter(function(item){if(item.code=="en"){fallback_language=item}return item.code==language});if(defaultLanguageArray.length){$scope.sidebar.data.language=defaultLanguageArray[0]}else if(fallback_language){$scope.sidebar.data.language=fallback_language}}};$scope.init();$scope.addField=function(field,i){var merge_tag="{$"+field.var+"}";if($scope.sidebar.data.subject&&$scope.sidebar.data.subject.length){$scope.sidebar.data.subject+=" "+merge_tag}else{$scope.sidebar.data.subject=merge_tag}};$scope.plain_edit=function(){var data=angular.copy($scope.messages.plain_edit);data.textarea=$scope.sidebar.data.plain;var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/textarea.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(modalResponse){var params={id:$scope.sidebar.data.mail_id,type:"drafts"};params.plain=modalResponse.textarea;EmailsService.update(params,function(){$scope.sidebar.data.plain=modalResponse.textarea})})};$scope.loadEmailReport=function(){$scope.reportLoading=true;if(!$scope.sidebar.data.report_id){return}var params={report_id:$scope.sidebar.data.report_id};ApiReports.get(params,function(response){$scope.report=response;$scope.reportLoading=false})};$scope.$on("loadSidebar",function(event,data){if(data==="EMAIL"){$scope.loadEmailReport();$scope.init()}});$scope.send_test=function(mail_id){var data={title:$filter("translate")("Send a test email","/automation"),label:$filter("translate")("Email address:","/automation"),button_ok:$filter("translate")("Send","/automation"),button_cancel:$filter("translate")("Cancel","/automation")};var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/ask_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(modalResponse){if(modalResponse&&modalResponse.input){var params={mail_id:mail_id,test_email:modalResponse.input};EmailsService.send_test_email(params)}})}}]).controller("AutomationWorkflowReportController",["$scope",function($scope){}]).controller("AutomationWorkflowActionController",["$scope","ApiFields","ApiGroups",function($scope,ApiFields,ApiGroups){$scope.highlight=function(data){data.highlight=true;var elementId="#step-id-"+data.step_id;var container=$(".ml-workflow-builder-area");var element=$(elementId);container.stop().animate({scrollTop:container.scrollTop=container.scrollTop()+element.offset().top-container.offset().top-25},{duration:100,specialEasing:{width:"linear",height:"easeOutBounce"}})};$scope.remove_highlight=function(data){data.highlight=false};$scope.getEmailScreenshot=function(item){if(item.valid&&(item.screenshot||item.fake_screenshot)){var screenshot=item.screenshot||item.fake_screenshot;if(screenshot.charAt(0)!=="/"&&screenshot.substr(0,4)!=="http"){screenshot="/"+screenshot}return screenshot}return"/assets/images/workflow/workflow_screenshot.png"};$scope.stepTypes={DELAY:{code:"DELAY",title:"Delay"},EMAIL:{code:"EMAIL",title:"Email"},CONDITION:{code:"CONDITION",title:"Condition"},ACTION:{code:"ACTION",title:"Action"}};$scope.types={update_custom_field:{code:"update_custom_field",title:"Update custom field",description:"Update subscriber field with a custom value."},copy_to_group:{code:"copy_to_group",title:"Copy to a group",description:"Copy subscriber to another group while remaining in the original group."},move_to_group:{code:"move_to_group",title:"Move to a group",description:"Move a subscriber from the selected group to a new group."},remove_from_group:{code:"remove_from_group",title:"Remove from group",description:"Remove a subscriber from a selected group."},mark_as_unsubscribed:{code:"mark_as_unsubscribed",title:"Mark as unsubscribed",description:"Subscriber becomes inactive and is no longer part of the workflow.\n"},move_to_another_step:{code:"move_to_another_step",title:"Move to another step",description:"Move subscriber to a different step in the workflow."}};$scope.typesSorted=[];Object.keys($scope.types).forEach(function(key){$scope.typesSorted.push($scope.types[key])});$scope.prefillRemoveGroupIfNeeded=function(){if($scope.sidebar.data.remove_group){return}if(!$scope.tree[0].data.group||!$scope.tree[0].data.group.id){return}$scope.sidebar.data.remove_group=$scope.tree[0].data.group};$scope.filterObjectOutOfArray=function(objectToBeRemoved){return function(item){if(!objectToBeRemoved||!objectToBeRemoved.id){return true}return Number(item.id)!==Number(objectToBeRemoved.id)}};$scope.actionData={inlineFieldCreation:false,newFieldName:"",newFieldNameError:false,newFieldType:"TEXT",inlineGroupCreation:false,newGroupName:"",newGroupNameError:false,typeSelections:[]};$scope.fieldsTypes={TEXT:{type:"TEXT",title:"Text"},NUMBER:{type:"NUMBER",title:"Number"},DATE:{type:"DATE",title:"Date"}};$scope.fieldsTypesSorted=[];Object.keys($scope.fieldsTypes).forEach(function(key){$scope.fieldsTypesSorted.push($scope.fieldsTypes[key])});$scope.setNewFieldType=function(type){$scope.actionData.newFieldType=type};$scope.createANewField=function(){if($scope.actionData.newFieldName){$scope.actionData.newFieldNameError=false;$scope.actionData.inlineFieldCreation=false;$scope.fieldsLoading=true;ApiFields.create({title:$scope.actionData.newFieldName,type:$scope.actionData.newFieldType},function(field){field={id:field.id,title:field.title,var:field.var,type:field.field_type};$scope.fields.push(field);$scope.sidebar.data.field=field;$scope.sidebar.data.field_id=field.id;$scope.fieldsLoading=false})}else{$scope.actionData.newFieldNameError=true}};$scope.createANewGroup=function(){if($scope.actionData.newGroupName){$scope.actionData.newGroupNameError=false;$scope.actionData.inlineGroupCreation=false;$scope.groupsLoading=true;ApiGroups.createGroup({name:$scope.actionData.newGroupName},function(newGroup){newGroup.excluded=false;newGroup.total=0;$scope.groups_by_id[newGroup.id]=newGroup;$scope.groups.push(newGroup);$scope.sidebar.data.group=newGroup;$scope.sidebar.data.group_id=newGroup.id;$scope.groupsLoading=false});$scope.actionData.inlineFieldCreation=false}else{$scope.actionData.newGroupNameError=true}};$scope.disableInlineFieldCreation=function(){$scope.actionData.inlineFieldCreation=false};$scope.enableInlineFieldCreation=function(){$scope.actionData.inlineFieldCreation=true};$scope.disableInlineGroupCreation=function(){$scope.actionData.inlineGroupCreation=false};$scope.enableInlineGroupCreation=function(){$scope.actionData.inlineGroupCreation=true};$scope.check=function(){console.log($scope.actionData.newFieldName)};$scope.selectStepType=function(type){$scope.sidebar.data.next_step_id=null;$scope.sidebar.data.step_type=type;$scope.actionData.type=type;$scope.actionData.typeSelections=$scope.getListOfStepsDataByTypeWithoutMoveToAnotherStep(type)};$scope.selectUpdatedFieldActionType=function(type){$scope.sidebar.data.updated_field_action_type=type;$scope.sidebar.data.value="";$scope.sidebar.data.valid=0};$scope.rememberScrollLocation=function(){var container=$(".ml-workflow-builder-area");$scope.sidebar.step.scrollLocation=container.scrollTop()}}]).controller("AutomationWorkflowConditionController",["$scope","ApiGroups","EmailsService",function($scope,ApiGroups,EmailsService){$scope.loadSentCampaigns=function(condition,page){page=typeof page!=="undefined"?page:1;if(page==1){condition.temp_sentCampaignsLoading=true;condition.temp_sentCampaigns=[];condition.temp_sentCampaigns_current_page=1;condition.temp_sentCampaigns_total_pages=1}EmailsService.query({type:"sent",limit:50,page:page,order_by:"mails.send",order:"DESC"},function(response){if(page==1){condition.temp_sentCampaigns_total_pages=response.data.pages}condition.temp_sentCampaigns_current_page=page;if(response.data.items.length){response.data.items.forEach(function(mail,index){condition.temp_sentCampaigns.push({mail_id:mail.id,campaign_type:mail.campaign_type,subject:mail.subject})})}condition.temp_sentCampaignsLoading=false})};$scope.resetEmailAndLink=function(){if(!$scope.sidebar.data){return}delete $scope.sidebar.data.mail;delete $scope.sidebar.data.link};$scope.resetLink=function(){if(!$scope.sidebar.data){return}delete $scope.sidebar.data.link};$scope.loadLinks=function(condition){condition.temp_links=[];condition.temp_linksLoading=true;EmailsService.getLinksByMailId({mail_id:condition.mail.mail_id},function(response){if(!response.success){
$scope.linksLoading=false;return}var links=response.report.links;links=links.filter(function(link){return/^http|^\/\//.test(link.title)});condition.temp_links=links;condition.temp_linksLoading=false})};$scope.deleteCondition=function(index){$scope.sidebar.data.conditions.splice(index,1);if($scope.sidebar.data.conditions.length===0){$scope.sidebar.data.valid=0}if($scope.sidebar.data.conditions.length<1){$scope.sidebar.data.conditions.push({})}$scope.listConditionTypes()};$scope.addCondition=function(){$scope.sidebar.data.conditions.push({})};$scope.setAction=function(condition,item){condition.action=item.code};$scope.setConditionType=function(condition,item){condition.type=item.code;$scope.resetEmailAndLink();$scope.listConditionTypes()};$scope.setLink=function(condition,item){condition.link_id=item.id;condition.link=item};$scope.listConditionTypes=function(){var result=[];var list=$scope.sidebar.data.conditions;for(key in list){result.push(list[key]["type"])}return $scope.condition_types_list=result};$scope.setConditionFieldRule=function(condition,item){condition.field_rule=item.code;condition.field_rule_data=item};$scope.fieldRulesForTextAndNumber={is_equal:{code:"is_equal",title:"is equal"},is_not_equal:{code:"is_not_equal",title:"is not equal"},contains:{code:"contains",title:"contains"},does_not_contain:{code:"does_not_contain",title:"does not contain"},is_provided:{code:"is_provided",title:"is provided"},is_not_provided:{code:"is_not_provided",title:"is not provided"},is_in_array:{code:"is_in_array",title:"is one of"},is_not_in_array:{code:"is_not_in_array",title:"is not one of"}};$scope.fieldRulesForDate={is_after:{code:"is_after",title:"is after"},is_before:{code:"is_before",title:"is before"},is_equal:{code:"is_equal",title:"is equal"},is_provided:{code:"is_provided",title:"is provided"}};$scope.actions={opened:{code:"opened",title:"was opened"},not_opened:{code:"not_opened",title:"was not opened"},link_clicked:{code:"link_clicked",title:"had any link clicked"},link_clicked_spec:{code:"link_clicked_spec",title:"had a specific link clicked"},opened_not_clicked:{code:"opened_not_clicked",title:"was opened with no links clicked"},link_not_clicked_spec:{code:"link_not_clicked_spec",title:"was opened and did not have a specific link clicked"}};$scope.conditionTypes={campaign_activity:{code:"campaign_activity",title:"Campaign activity"},workflow_activity:{code:"workflow_activity",title:"Workflow activity"},custom_fields:{code:"custom_fields",title:"Custom fields"},group_membership:{code:"group_membership",title:"Group membership"},segment_member:{code:"segment_member",title:"Segment membership"}};$scope.conditionTypesSorted=[];Object.keys($scope.conditionTypes).forEach(function(key){$scope.conditionTypesSorted.push($scope.conditionTypes[key])})}]).controller("AutomationWorkflowDelayController",["$scope",function($scope){}]);angular.module("MailerliteApp").directive("conditionSearchableList",function(){return{scope:{condition:"=condition",type:"=type",titleDisplay:"=titleDisplay",search:"@",disallow_code:"@"},templateUrl:"/views/automation/sidebar/condition_searchable_list.html",controller:["$scope","$element","EmailsService",function($scope,element,EmailsService){$scope.configs={custom_fields:{items_key:"temp_fields",search_key:"title",resultKey:"field_id",valueKey:"id",display:function(item){return item.title},set:function(item){$scope.condition.field=item;$scope.condition.field_id=item.id}},workflow_activity:{items_key:"temp_emails",search_key:"subject",resultKey:"mail_id",valueKey:"mail_id",display:function(item){return item.subject},set:function(item){$scope.condition.mail_id=item.mail_id;$scope.condition.mail=item}},segment_member:{items_key:"temp_segments",search_key:"name",resultKey:"segment_id",valueKey:"id",display:function(item){return item.name},set:function(item){$scope.condition.segment=item;$scope.condition.segment_id=item.id}},group_membership:{items_key:"temp_groups",search_key:"name",resultKey:"group_id",valueKey:"id",display:function(item){return item.name},set:function(item){$scope.condition.group=item;$scope.condition.group_id=item.id}},campaign_activity:{items_key:"temp_sentCampaigns",search_key:"subject",resultKey:"mail_id",valueKey:"mail_id",display:function(item){return item.subject+" ("+item.campaign_type+")"},set:function(item){$scope.condition.mail=item;$scope.condition.mail_id=item.mail_id}}};$scope.config=$scope.configs[$scope.condition.type];$scope.config.filtered_items_key=$scope.config.items_key+"_filtered";var data=$scope.condition[$scope.config.items_key];if(typeof $scope.condition[$scope.config.items_key]=="object"){data=Object.values($scope.condition[$scope.config.items_key])}$scope.condition[$scope.config.filtered_items_key]=data;$scope.searchConditionFields=function(){var results=[];var data=$scope.condition[$scope.config.items_key];if(typeof $scope.condition[$scope.config.items_key]=="object"){data=Object.values($scope.condition[$scope.config.items_key])}data.forEach(function(item,key){if(item[$scope.config.search_key].match(new RegExp($scope.search,"i"))){results.push(item)}});$scope.condition[$scope.config.filtered_items_key]=results};$scope.resetSearch=function(){$scope.search="";$scope.searchConditionFields();$scope.disallow_code=true};$scope.doSearch=function(){$scope.searchConditionFields();$scope.disallow_code=true};$scope.setConditionData=function(item){$scope.config.set(item);$scope.search="";$scope.searchConditionFields()};$scope.getConditionDisplayText=function(item){if(typeof $scope.titleDisplay==="function"){return $scope.titleDisplay(item)}return $scope.config.display(item)};$(element).parent().on("hide.bs.dropdown",function(e){if($scope.disallow_code===true){$scope.disallow_code=false;return false}});$scope.loadNextCampaignActivityPage=function(condition){$scope.disallow_code=true;$scope.loadSentCampaigns(condition,condition.temp_sentCampaigns_current_page+1)};$scope.loadSentCampaigns=function(condition,page){page=typeof page!=="undefined"?page:1;if(page==1){condition.temp_sentCampaignsLoading=true;condition.temp_sentCampaigns=[];condition.temp_sentCampaigns_current_page=1;condition.temp_sentCampaigns_total_pages=1}EmailsService.query({type:"sent",limit:50,page:page,order_by:"mails.send",order:"DESC"},function(response){if(page==1){condition.temp_sentCampaigns_total_pages=response.data.pages}condition.temp_sentCampaigns_current_page=page;if(response.data.items.length){response.data.items.forEach(function(mail,index){condition.temp_sentCampaigns.push({mail_id:mail.id,campaign_type:mail.campaign_type,subject:mail.subject})})}condition.temp_sentCampaignsLoading=false})}}]}});angular.module("MailerliteApp").directive("searchableList",function(){return{scope:{list:"=list",titleKey:"=titleKey",titleDisplay:"=titleDisplay",uniqueKey:"=uniqueKey",removeItem:"=removeItem",result:"=result",resultId:"=?resultId",filterTerms:"=filter",afterSelect:"=afterSelect",search:"@",disallow_code:"@"},templateUrl:"/views/automation/sidebar/searchable_list.html",controller:["$scope","$element","$timeout",function($scope,element,attrs){$scope.filteredList=$scope.list;$scope.$watch("list",function(){$scope.search="";$scope.searchConditionFields()});$scope.filterObjectOutOfArray=function(objectToBeRemoved){return function(item){if(!objectToBeRemoved||!objectToBeRemoved.id){return true}return Number(item.id)!==Number(objectToBeRemoved.id)}};$scope.searchConditionFields=function(){var results=[];$scope.list.forEach(function(item,key){if(item[$scope.titleKey].match(new RegExp($scope.search,"i"))){results.push(item)}});$scope.filteredList=results};$scope.resetSearch=function(){$scope.search="";$scope.searchConditionFields();$scope.disallow_code=true};$scope.doSearch=function(){$scope.searchConditionFields();$scope.disallow_code=true};$scope.set=function(item){$scope.result=item;try{$scope.resultId=item.id}catch(err){}if(typeof $scope.afterSelect=="function"){$scope.afterSelect(item)}$scope.search="";$scope.searchConditionFields()};$scope.displayText=function(item){if(typeof $scope.titleDisplay==="function"){return $scope.titleDisplay(item)}return item[$scope.titleKey]};$(element).parent().on("hide.bs.dropdown",function(e){if($scope.disallow_code===true){$scope.disallow_code=false;return false}})}]}});angular.module("MailerliteApp").directive("actionStepDescription",function(){return{scope:{data:"=data",type:"=stepType"},templateUrl:"/assets/js/core/views/generate-automation-step-description/step.html",controller:["$scope",function($scope){$scope.step={data:"",type:""};$scope.step.data=$scope.data;$scope.step.type=$scope.type;$scope.$watch("data",function(){$scope.step.data=$scope.data;$scope.step.type=$scope.type});$scope.$watch("stepType",function(){$scope.step.data=$scope.data;$scope.step.type=$scope.type})}]}});function prepareStepWithSidebarForPreview($scope,step){$scope.step=step;$scope.sidebar={include:"",data:{},step:{}};$scope.sidebar.include=$scope.step.type?$scope.step.type.toLowerCase():$scope.step.type;$scope.sidebar.data=$scope.step.data;$scope.sidebar.step=$scope.step}angular.module("MailerliteApp").controller("AutomationWorkflowStepDiffBeforeController",["$scope",function($scope){"use strict";prepareStepWithSidebarForPreview($scope,window.before_step)}]);angular.module("MailerliteApp").controller("AutomationWorkflowStepDiffAfterController",["$scope",function($scope){"use strict";prepareStepWithSidebarForPreview($scope,window.after_step)}]);angular.module("MailerliteApp").controller("AutomationController",["$scope","$modal","$interpolate","$filter","AutomationResource","statisticsService","ApiGroups","ApiFields",function($scope,$modal,$interpolate,$filter,AutomationResource,statisticsService,ApiGroups,ApiFields){$scope.reloadItems=function(params,callback){if(!params||!params.skip_loading){$scope.loading=true}AutomationResource.getAutomationsCount(function(response){if(response&&response.count){$scope.automations_count=response.count}AutomationResource.getAutomationsLimited(function(response){$scope.items=response;prepareFilterFields($scope.items);prepareSortAndFilterFields($scope.items);if(!params||!params.skip_loading){$scope.loading=false}if(typeof callback==="function"){callback()}})})};$scope.items=[];$scope.reloadItems();$scope.workflowStateChange=function(item){if(item.ignoreNextChange){delete item.ignoreNextChange;return}if(item.active){item.activationLoading=true;if(item.trigger.type!=1){performActivationWithActivationType(item,"ignore")}else{AutomationResource.getNontriggeredOnlyNewCount({workflow_id:item.id},function(response){if(Number(response.count)===0){performActivationWithActivationType(item,"ignore")}else{var modalInstance=$modal.open({templateUrl:"/views/automation/modals/automation_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return{count:response.count}}},backdrop:"static",keyboard:false});modalInstance.result.then(function(modalResponse){performActivationWithActivationType(item,modalResponse.activation_type)},function(reason){if(reason==="cancel"){item.ignoreNextChange=true;item.active=false}})}})}}else{item.activationLoading=true;AutomationResource.updateAutomation({workflow_id:item.id,active:item.active},function(){item.activationLoading=false;if(isMigratedAutomation(item.id)){window.reloadAutoresponders()}});var isSaveNeeded=false;if(item.trigger.isTriggerSaveConfirmationNeeded){delete item.trigger.isTriggerSaveConfirmationNeeded}if(item.trigger.changed){delete item.trigger.changed}if(isSaveNeeded){var params={workflow_id:item.id,type:"TRIGGER",parent_id:"0",step_id:item.trigger.trigger_step_id,data:angular.copy(item.trigger)};delete params.data.trigger_step_id;delete params.data.changed;AutomationResource.updateStep(params)}}function performActivationWithActivationType(item,activation_type){item.activationLoading=true;AutomationResource.updateAutomation({workflow_id:item.id,active:item.active,activation_type:activation_type},function(){item.activationLoading=false;if(isMigratedAutomation(item.id)){window.reloadAutoresponders()}});if(!item.trigger.workflowWasActive){item.trigger.workflowWasActive=true;var params={workflow_id:item.id,type:"TRIGGER",parent_id:"0",step_id:item.trigger.trigger_step_id,data:angular.copy(item.trigger)};delete params.data.trigger_step_id;delete params.data.changed;AutomationResource.updateStep(params)}}};$scope.messages={removeMany:{title:$filter("translate")("Please confirm","/automation"),body:$filter("translate")("Do you really want to delete [[count]] automations?","/automation"),button_ok:$filter("translate")("Delete","/automation"),button_ok_class:"btn-danger",button_cancel:$filter("translate")("Cancel","/automation")}};$scope.deleteAutomation=function(item){var tmp={count:1};var data=angular.copy($scope.messages.removeMany);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp(tmp)});var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(){$scope.deleteBatchMethod([item])})};$scope.deleteBatchMethod=function(items){var ids=[];items.forEach(function(item){ids.push(item.id)});var params={ids:ids};AutomationResource.deleteBatch(params,function(){items.forEach(function(item){var index=$scope.items.indexOf(item);if(index!=-1){$scope.items.splice(index,1)}})})};$scope.duplicateAutomation=function(item){var params={workflow_id:item.id};item.loading=true;AutomationResource.duplicateAutomation(params,function(response){$scope.reloadItems({skip_loading:true},function(){});statisticsService.track({feature:"Automation duplicate",version:"success"})},function(err){statisticsService.track({feature:"Automation duplicate",version:"error",info:{err:err}});$("#sessionExpired").modal("show")})};$scope.filterGroups=[];$scope.filterGroups.push({id:0,name:"Any"});$scope.groupFilter=$scope.filterGroups[0];function prepareFilterFields(items){var addedGroupIds=[];items.forEach(function(item){if(item.trigger&&item.trigger.group&&addedGroupIds.indexOf(item.trigger.group.id)===-1){$scope.filterGroups.push(item.trigger.group);addedGroupIds.push(item.trigger.group.id)}})}$scope.sortOptions=[{title:"Date Added",field:"created_at_date"},{title:"Name",field:"title"},{title:"Trigger",field:"trigger_group_name"},{title:"Status",field:"active"},{title:"Emails Sent",field:"stats_sent"},{title:"Open Rate",field:"stats_opened_rate"},{title:"Click Rate",field:"stats_clicked_rate"}];$scope.statusFilterOptions=[{name:"All",filter:null},{name:"Active",filter:true},{name:"Paused",filter:false}];$scope.statusFilter=$scope.statusFilterOptions[0];function prepareSortAndFilterFields(items){items.forEach(function(item){try{item.created_at_date=item.created_at.date}catch(e){}try{item.trigger_group_id=item.trigger.group.id}catch(e){item.trigger_group_id=false}try{item.trigger_group_name=item.trigger.group.name}catch(e){item.trigger_group_name=false}try{item.stats_sent=item.stats.sent}catch(e){}try{item.stats_opened_rate=item.stats.opened.rate}catch(e){}try{item.stats_clicked_rate=item.stats.clicked.rate}catch(e){}})}$scope.folderParams={folder_type:"automations"};$scope.createAutomation=function(){if($scope.creatingNewAutomation){return false}$scope.creatingNewAutomation=true;var workflow_number=$scope.items.length+1;while($scope.items.filter(function(item){return item.title==="Workflow "+workflow_number}).length){workflow_number++}var newTitle="Workflow "+workflow_number;var params={title:newTitle,type:1,send_once:1,steps:[{type:"TRIGGER",data:{title:newTitle},next:[]}]};AutomationResource.createAutomation(params,function(response){if(response&&response.id){window.location="/automation/workflow/"+response.id}else{$scope.creatingNewAutomation=false}},function(){$scope.creatingNewAutomation=false})};$scope.active_tab=window.location.hash?window.location.hash.substring(1):"automation";$scope.startMigration=function(){$scope.migrationLoading=true;AutomationResource.migrate(function(response){$scope.migration_result=response;$scope.migrationDone=true;$scope.migrationLoading=false;$scope.reloadItems();$scope.getMigratedAutomations()})};$scope.getMigratedAutomations=function(){AutomationResource.getMigratedAutomations(function(response){$scope.migratedAutomations=response})};$scope.migratedAutomations=[];$scope.getMigratedAutomations();function isMigratedAutomation(automation_id){return $scope.migratedAutomations.indexOf(automation_id)!==-1}$scope.groups_by_id={};ApiGroups.getAllGroupsAndSegments(function(response){response.forEach(function(group){$scope.groups_by_id[group.id]=group})});$scope.fields_by_id={};ApiFields.query(function(response){response.forEach(function(field){$scope.fields_by_id[field.id]=field})})}]);angular.module("MailerliteApp").controller("MailerliteController",["$scope","$window",function($scope,$window){$scope.window=$window;$scope.current_location=$window.location.href;$scope.in_array=function(needle,haystack){angular.forEach(haystack,function(value){if(value==needle)return true});return false}}]).filter("urlEncode",[function(){return window.encodeURIComponent}]).controller("MailerliteHeaderController",["$scope","$compile","$timeout",function($scope){}]);angular.module("MailerliteCore").controller("ApiItemsController",["$scope","$interpolate","$filter","$timeout","$http","$modal",function($scope,$interpolate,$filter,$timeout,$http,$modal){function loadCount(callback){var fn=$scope.options.countFn;fn(angular.extend({},$scope.options.commonParams,$scope.options.countParams),callback)}function loadChunk(callback){var fn=$scope.options.queryFn;fn(angular.extend({},$scope.options.commonParams,$scope.options.queryParams,{offset:$scope.items_data.offset,limit:$scope.items_data.limit}),callback)}$scope.init=function(options){$scope.options=options;$scope.messages=options.messages||{removeSelected:{body:"Are you sure?",title:"Please confirm"},remove:{body:"Are you sure?",title:"Please confirm"}};$scope.items_data={loader:true,items:options.settings.items||[],offset:options.settings.offset||0,limit:options.settings.limit||20,count:options.settings.count||0};$scope.$watch("options.commonParams",function(newParams,oldParams){if(newParams){$scope.items_data.items=[];$scope.items_data.count=0;$scope.items_data.offset=0;$scope.items_data.loader=true;loadCount(function(response){$scope.items_data.count=response.count||0;if($scope.items_data.count){loadChunk(function(items){if(items.length){$scope.items_data.items=$scope.items_data.items.concat(items)}$scope.items_data.loader=false})}else{$scope.items_data.loader=false}})}},true);$scope.$watch("options.queryParams",function(newParams,oldParams){if(newParams!==oldParams){$scope.items_data.items=[];$scope.items_data.offset=0;$scope.items_data.loader=true;if($scope.items_data.count){loadChunk(function(items){if(items.length){$scope.items_data.items=$scope.items_data.items.concat(items)}$scope.items_data.loader=false})}}},true);$scope.nextPage=function(){$scope.items_data.offset=$scope.items_data.offset+$scope.items_data.limit;if($scope.items_data.offset<$scope.items_data.count){$scope.items_data.loader=true;loadChunk(function(items){if(items.length){$scope.items_data.items=$scope.items_data.items.concat(items)}$scope.items_data.loader=false})}};$scope.remove=function(item){var $index=$scope.items_data.items.indexOf(item);var data=angular.copy($scope.messages.remove);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp(item)});var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(){$scope.options.removeFn({id:$scope.items_data.items[$index].id},function(){$scope.items_data.items.splice($index,1);$scope.items_data.count--;$scope.$emit("items:remove",item)})})}}}]);angular.module("MailerliteCore").controller("ChooseGroupModalController",["$scope","$modalInstance","data","GroupsService",function($scope,$modalInstance,data,GroupsService){$scope.data=data;if($scope.data&&$scope.data.options&&$scope.data.options.length){$scope.data.options.sort(function(a,b){if(a.value===0){return-1}if(b.value===0){return 1}return a.label.toUpperCase()>b.label.toUpperCase()?1:b.label.toUpperCase()>a.label.toUpperCase()?-1:0})}$scope.ok=function(){$scope.data.error=false;if(!$scope.data.input&&!$scope.data.select_value){$scope.data.error=true}else{if(!$scope.data.select_value){GroupsService.create({name:$scope.data.input},function(response){response.data.id,$modalInstance.close(angular.extend($scope.data,{select_value:response.data.id,newGroup:response.data}))})}else{$modalInstance.close($scope.data)}}};$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);angular.module("MailerliteCore").controller("FancySubscriberTableController",["$scope","$interpolate","$sce","$filter","$compile","$timeout","$http","$modal","$location","SubscribersService","ApiFields","ApiLinks",function($scope,$interpolate,$sce,$filter,$compile,$timeout,$http,$modal,$location,SubscribersService,ApiFields,ApiLinks){var ItemsService=ApiLinks;var additionalParams={};$scope.setAdditionalParam=function(key,value){additionalParams[key]=value};prepareDataSettings();$scope.items_data={loader:true,items:[]};$scope.nextPage=function(){if(!$scope.isLastPage()){$scope.settings.page++}};$scope.prevPage=function(){if(!$scope.isFirstPage()){$scope.settings.page--}};$scope.isFirstPage=function(){return!$scope.getPageCount()||$scope.settings.page===1};$scope.isLastPage=function(){return!$scope.getPageCount()||$scope.settings.page===$scope.getPageCount()};$scope.getPageRange=function(){var range1;var delimiter=" - ";var range2;range1=($scope.settings.page-1)*$scope.settings.limit+1;range2=$scope.settings.page*$scope.settings.limit;var totalItemsCount=$scope.getTotalItemsCount();range1=totalItemsCount<range1?totalItemsCount:range1;range2=totalItemsCount<range2?totalItemsCount:range2;return range1+delimiter+range2};$scope.getTotalItemsCount=function(){var type;if($scope.settings.search){type="search"}else{type=$scope.type}return $scope.totals[type]};$scope.getPageCount=function(){return Math.ceil($scope.getTotalItemsCount()/$scope.settings.limit)};var refreshItemsTimeout;var refreshItems=function(){$scope.items_data.loader=true;if(refreshItemsTimeout){$timeout.cancel(refreshItemsTimeout)}var refreshPage=$scope.settings.page;refreshItemsTimeout=$timeout(function(){var params=prepareRefreshParams();ItemsService.getSubscribers(angular.extend({},params,additionalParams),function(response){if(refreshPage!==$scope.settings.page){return}$scope.items_data.items=response.data.items;$scope.items_data.loader=false;var type;if($scope.settings.search){type="search"}else{type=$scope.type}$scope.totals[type]=response.data.count;$scope.items_data.loader=false})},150)};$scope.$on("refreshSubscribersItems",function(){refreshItems()});function prepareRefreshParams(){params=angular.copy($scope.settings);params.offset=(params.page-1)*params.limit;delete params.page;delete params.total;delete params.type;var tmp=params.order;var tmp2=params.order_by;delete params.order;delete params.order_by;params["order["+tmp2+"]"]=tmp;return params}function isValidEmail(email){return/^[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z0-9\-]{2,40}$/i.test(email)}function storeSettingsToStorage(){if(typeof Storage==="undefined"){return false}var settingsStringify=JSON.stringify({limit:$scope.settings.limit});localStorage.setItem("subscribersList:settings",settingsStringify)}function storeSettingsToHash(){$location.search("page",$scope.settings.page);$location.search("limit",$scope.settings.limit);$location.search("order_by",$scope.settings.order_by);$location.search("order",$scope.settings.order);$location.search("type",$scope.settings.type);$location.search("search",$scope.settings.search)}function storeColumnsToStorage(){if(typeof Storage==="undefined"){return false}var columnsStringify=JSON.stringify($scope.columns);localStorage.setItem("subscribersList_reports_subscribersActivity:columns",columnsStringify)}$scope.columnsSortableOptions={handle:".handle",axis:"y"};$scope.$watch("columns",function(newVal,oldVal){storeColumnsToStorage()},true);$scope.isActiveColumns=function(){var result=false;if($scope.columns){$scope.columns.forEach(function(column){if(column.active){result=true}})}return result};function prepareDataSettings(){var settingsFromHash=angular.copy($location.search());if(!Object.keys(settingsFromHash).length){settingsFromHash=false}var settingsFromStorage=false;var columnsFromStorage=false;if(typeof Storage!=="undefined"){try{if(localStorage["subscribersList:settings"]){settingsFromStorage=JSON.parse(localStorage["subscribersList:settings"])}if(localStorage["subscribersList_reports_subscribersActivity:columns"]){columnsFromStorage=JSON.parse(localStorage["subscribersList_reports_subscribersActivity:columns"])}}catch(exception){}}$scope.data.settings={report_id:$scope.data.settings.report_id||0,link_id:$scope.data.settings.link_id||0,page:$scope.data.settings.page||1,order:$scope.data.settings.order||"DESC",order_by:$scope.data.settings.order_by||"report_links.date",type:$scope.data.settings.type||"clicked",limit:$scope.data.settings.limit||50,total:$scope.data.settings.total||1,search:$scope.data.settings.search||""};$scope.settings=$scope.data.settings;$scope.$watch("settings",function(newVal,oldVal){if(oldVal.page==newVal.page){$scope.settings.page=1}refreshItems();storeSettingsToStorage();storeSettingsToHash()},true);$timeout(function(){if(settingsFromStorage&&settingsFromStorage.limit){$scope.data.settings.limit=settingsFromStorage.limit}if(settingsFromHash&&settingsFromHash.limit){$scope.data.settings.limit=settingsFromHash.limit}if(settingsFromHash&&settingsFromHash.order_by){$scope.data.settings.order_by=settingsFromHash.order_by}if(settingsFromHash&&settingsFromHash.order){$scope.data.settings.order=settingsFromHash.order}if(settingsFromHash&&settingsFromHash.page){$scope.data.settings.page=settingsFromHash.page}if(settingsFromHash&&settingsFromHash.search){$scope.data.settings.search=settingsFromHash.search;$scope.data.search_input=settingsFromHash.search}});$scope.columns=[];window.columns=$scope.columns;var fieldsBlacklist=["email"];ApiFields.query(function(fields){fields=fields.filter(function(field){return fieldsBlacklist.indexOf(field.field)===-1});fields.forEach(function(field){$scope.columns.push({active:false,type:field.field_type,var:field.var,custom_field:field.var!="name"?true:false,title:field.title})});syncColumnsWithStorage()});function syncColumnsWithStorage(){if(!columnsFromStorage.length){return true}$scope.columns=$scope.columns.reverse();var newColumns=[];$scope.columns.forEach(function(column){var columnFromStorage=columnsFromStorage.filter(function(columnFromStorage){return column.key===columnFromStorage.key});if(!columnFromStorage.length){newColumns.push(column);var index=$scope.columns.indexOf(column);$scope.columns.splice(index,1)}});columnsFromStorage.forEach(function(columnFromStorage){var columnFromScope=$scope.columns.filter(function(obj){return!!(obj.key===columnFromStorage.key&&obj.custom_field===columnFromStorage.custom_field)});if(columnFromScope.length){var index=$scope.columns.indexOf(columnFromScope[0]);$scope.columns.splice(index,1);columnFromScope[0].active=columnFromStorage.active;$scope.columns.unshift(columnFromScope[0])}});$scope.columns=$scope.columns.reverse();$scope.columns.push.apply($scope.columns,newColumns)}}$scope.search=function(){$scope.data.settings.search=$scope.data.search_input;$scope.data.select_all=false;$scope.data.selected_items={}}}]);angular.module("MailerliteCore").controller("FoldersController",["$scope","$rootScope","$interpolate","ApiFolders","$modal",function($scope,$rootScope,$interpolate,ApiFolders,$modal){$scope.allChecked=function(){if(!$scope.filtered_items||!$scope.filtered_items.length){return false}return angular.equals($scope.getSelectedItems(),$scope.filtered_items)};$scope.noneChecked=function(){return!$scope.getSelectedItems().length};$scope.checkAll=function(){var checkValue=true;if($scope.allChecked()){checkValue=false}if($scope.filtered_items){$scope.filtered_items.forEach(function(item){item.checked=checkValue})}};$scope.getSelectedItems=function(){var result=[];if($scope.filtered_items){$scope.filtered_items.forEach(function(item){if(item.checked){result.push(item)}})}return result};$scope.deleteSelected=function(){var item={count:$scope.getSelectedItems().length};var data=angular.copy($scope.messages.removeMany);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp(item)});var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(){$scope.deleteBatchMethod($scope.getSelectedItems())})};$scope.getSort=function(){if(!$scope.sort){$scope.sort=$scope.sortOptions[0]}return $scope.sort};$scope.setSort=function(sort){$scope.sort=sort};$scope.getSortDirection=function(){if(!$scope.sortDirection){return"DESC"}return $scope.sortDirection};$scope.setSortDirection=function(direction){$scope.sortDirection=direction};$scope.invertSortDirection=function(){if($scope.getSortDirection()==="ASC"){$scope.setSortDirection("DESC")}else{$scope.setSortDirection("ASC")}};$rootScope.getSortWithDirection=function(){var result=$scope.getSort()&&$scope.getSort().field?$scope.getSort().field:"";if(result!==""&&$scope.getSortDirection()==="DESC"){result="-"+result}return result};$rootScope.doGroupFilter=function(item){if(!$scope.groupFilter||!$scope.groupFilter.id){return true}return item.trigger_group_id==$scope.groupFilter.id};$rootScope.doStatusFilter=function(item){if(!$scope.statusFilter||$scope.statusFilter.filter===null){return true}return item.active===$scope.statusFilter.filter};$rootScope.doFolderFilter=function(item){if(!$scope.active_folder||!$scope.active_folder.id){return true}return item.folder_id==$scope.active_folder.id};$rootScope.applyFilters=function(){$("#drop-status").removeClass("open")};$rootScope.filtersActive=function(){if($scope.statusFilter&&$scope.statusFilter.filter!==null){return true}if($scope.groupFilter&&$scope.groupFilter.id){return true}return false};$rootScope.resetFilters=function(){$scope.statusFilter=$scope.statusFilterOptions[0];$scope.groupFilter=$scope.filterGroups[0];$("#drop-status").removeClass("open")};$rootScope.getGroupFilter=function(){return $scope.groupFilter};$rootScope.getStatusFilter=function(){return $scope.statusFilter};$scope.folders=[];$scope.folders.push({id:0,name:"All"});$scope.active_folder=$scope.folders[0];ApiFolders.get($scope.folderParams,function(response){response.forEach(function(item){$scope.folders.push(item)})});$scope.createFolder=function($event){$event.stopPropagation();var newFolder={name:"New folder",edit_mode:true,just_created:true};var params=angular.copy($scope.folderParams);params["name"]=newFolder["name"];$scope.folders.push(newFolder);ApiFolders.post(params,function(response){newFolder.id=response.id});return false};$scope.editFolders=function($event){$event.stopPropagation();$scope.folder_options=true};$scope.doneEditFolders=function($event){$event.stopPropagation();$scope.folder_options=false};$scope.editFolder=function(folder,$event){$event.stopPropagation();folder.edit_mode=true};$scope.saveFolder=function(folder,$event){if($event){$event.stopPropagation()}var params=angular.copy($scope.folderParams);params["folder_id"]=folder["id"];params["name"]=folder["name"];ApiFolders.put(params);folder.edit_mode=false;folder.just_created=false};$scope.deleteFolder=function(folder,$event){$event.stopPropagation();var params=angular.copy($scope.folderParams);params["folder_id"]=folder["id"];ApiFolders.delete(params);var deleteIndex=$scope.folders.indexOf(folder);if(deleteIndex!=-1){
$scope.folders.splice(deleteIndex,1)}};$scope.activateFolder=function(folder){$scope.active_folder=folder;$("#drop-folders.open").removeClass("open")};$scope.countFolderItems=function(folder){if(!folder.id){return $scope.items.length}var folder_items=$scope.items.filter(function(item){return item.folder_id==folder.id});return folder_items.length};$scope.moveSelectedTo=function(folder){if(!folder.id){return}var items_to_move=$scope.getSelectedItems();var itemsIds=[];items_to_move.forEach(function(item){itemsIds.push(item.id);item.folder_id=folder.id});var params=angular.copy($scope.folderParams);params["folder_id"]=folder["id"];params["automations"]=itemsIds;ApiFolders.batchMove(params);$scope.active_folder=folder}}]).directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){if(event.which===13){scope.$apply(function(){scope.$eval(attrs.ngEnter)});event.preventDefault()}})}});angular.module("MailerliteCore").controller("GroupController",["$scope","$interpolate","$sce","$filter","$compile","$timeout","$http","$modal","$window","SelectionService","GroupsService",function($scope,$interpolate,$sce,$filter,$compile,$timeout,$http,$modal,$window,SelectionService,GroupsService){$scope.group=$scope.group||{};$scope.group_header_data={};$scope.split=function(){var item=$scope.group;var data=angular.copy($scope.group_header_data.messages.splitGroup);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp(item)});data.options=[];for(var i=2;i<=10;i++){data.options.push({value:i,label:i})}data.select_value=2;var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/choose_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(modalResponse){var ids=[];var items_to_push=[];for(var i=1;i<=modalResponse.select_value;i++){var name=item.name+" ("+i+")";GroupsService.create({name:name},function(response){if(response.success){var new_group=response.data;new_group.updating=1;new_group.selected=false;items_to_push.push(new_group);ids.push(new_group.id);if(ids.length==modalResponse.select_value){SelectionService.create({values:ids},function(selection){GroupsService.split({selection_id:selection.id,id:item.id},function(){$window.location="/groups"})})}}})}})};$scope.remove=function(){var data=angular.copy($scope.group_header_data.messages.removeGroup);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp($scope.group)});data.default_value=$scope.group.name;var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(modalResponse){GroupsService.remove({id:$scope.group.id},function(response){if(response.success)$window.location="/groups"})})};$scope.rename=function(){var data=angular.copy($scope.group_header_data.messages.renameGroup);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp($scope.group)});data.default_value=$scope.group.name;var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/ask_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(modalResponse){GroupsService.update({id:$scope.group.id,name:modalResponse.input},function(response){if(response.success)$scope.group.name=modalResponse.input})})}}]);angular.module("MailerliteApp").controller("InviteNotificationController",["$scope","InviteCodeResource","HideNotificationResource",function($scope,InviteCodeResource,HideNotificationResource){$scope.hide_notification=true;var now=Math.floor(Date.now()/1e3);if(localStorage.getItem("hide_invites_notification")<now){InviteCodeResource.get({},function(success){$scope.hide_notification=success.hide_notification;if(success.hide_notification){localStorage.setItem("hide_invites_notification",now+3600*24*7)}},function(failure){console.error("Something went wrong with invite url.")})}$scope.later=function(){$scope.hide_notification=true;HideNotificationResource.post({},function(success){},function(failure){console.error(failure)})}}]);angular.module("MailerliteCore").controller("ItemsController",["$scope","$interpolate","$sce","$filter","$compile","$timeout","$http","$modal","SelectionService",function($scope,$interpolate,$sce,$filter,$compile,$timeout,$http,$modal,SelectionService){var ItemsService=null;$scope.refresh_callback=false;$scope.prependItem=function(item){$scope.items_data.items.unshift(item)};$scope.settings={page:0,limit:0};$scope.messages={removeSelected:{body:"Are you sure?",title:"Please confirm"},remove:{body:"Are you sure?",title:"Please confirm"}};$scope.nextPage=function(){if($scope.settings.page<$scope.items_data.num_pages)$scope.settings.page++};$scope.items_data={loader:true,items:[],num_pages:1};$scope.items_data.total_text="";$scope.$watch("items_data.total",function(newVal){$scope.items_data.total_text=$scope.items_data.total!==undefined?"("+$scope.items_data.total+")":""});$scope.init=function(Service,settings,messages){ItemsService=Service;$scope.settings=settings;$scope.messages=messages};var clearItems=function(){while($scope.items_data.items.length>0)$scope.items_data.items.pop()};$scope.$watch("settings",function(newVal,oldVal){if(oldVal.page==newVal.page){clearItems();$scope.settings.page=1;refreshItems(true)}else{if(newVal.page>oldVal.page)refreshItems(false)}},true);var refreshItems=function(clear_items){$scope.items_data.loader=true;var params=angular.copy($scope.settings);if($scope.settings.page==1){params.total=1}ItemsService.query(params,function(response){if(Array.isArray(response)){response={data:{items:response,total:response.length}}}if(clear_items)clearItems();if(response.data.total!==undefined){angular.forEach(response.data.items,function(val,key){response.data.items[key].stats={avg_opens:val.sent>0?val.opened/val.sent*100:0,avg_clicks:val.sent>0?val.clicked/val.sent*100:0}});$scope.items_data.total=response.data.total;$scope.items_data.num_pages=Math.ceil(response.data.total/$scope.settings.limit);$scope.$emit("totalChanged",response.data.total)}$scope.$emit("chunkLoaded",response.data.items);$scope.items_data.items=$scope.items_data.items.concat(response.data.items);$scope.items_data.loader=false;if($scope.refresh_callback){$scope.refresh_callback(response.data.items)}})};var last_select_index=null;$scope.shiftDown=false;document.addEventListener("keydown",function(evt){var e=window.event||evt;var key=e.which||e.keyCode;if(16==key){$scope.$apply(function(){$scope.shiftDown=true})}},false);document.addEventListener("keyup",function(evt){var e=window.event||evt;var key=e.which||e.keyCode;if(16==key){$scope.$apply(function(){$scope.shiftDown=false})}},false);$scope.toggleSelect=function(item){var index=$scope.items_data.items.indexOf(item);var select_value=!item.selected;if(!$scope.shiftDown||last_select_index===null){last_select_index=index}for(var i=Math.min(index,last_select_index);i<=Math.max(index,last_select_index);i++){var item=$scope.items_data.items[i];item.selected=select_value;$scope.$emit("toggleSelect",{select_value:select_value,item:item})}last_select_index=index};$scope.atLeastSelected=function(num){return $filter("filter")($scope.items_data.items,{selected:true}).length>=num};$scope.atLeastOneSelected=function(){return $filter("filter")($scope.items_data.items,{selected:true}).length};$scope.allSelected=function(){return $filter("filter")($scope.items_data.items,{selected:true}).length===$scope.items_data.items.length};$scope.toggleAllSelect=function(){var select_value=true;if($scope.allSelected()){select_value=false}angular.forEach($scope.items_data.items,function(item){item.selected=select_value});$scope.$emit("toggleAllSelect",select_value)};$scope.doWithSelected=function(callback){callback($filter("filter")($scope.items_data.items,{selected:true}))};$scope.getScope=function(){return $scope};var spliceSelected=function(){for(k=$scope.items_data.items.length-1;k>=0;k--){var item=$scope.items_data.items[k];if(item.selected){$scope.$emit("removingItem",$scope.items_data.items[k]);$scope.items_data.items.splice(k,1);$scope.items_data.total--}}};$scope.$on("setTotal",function(event,total){$scope.items_data.total=total});$scope.$on("doWithSelected",function(event,callback){$scope.doWithSelected(callback)});$scope.$on("spliceSelected",function(){spliceSelected()});$scope.removeSelected=function(){var data=angular.copy($scope.messages.removeSelected);var items=$filter("filter")($scope.items_data.items,{selected:true});var item={count:items.length,items:items};angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp(item)});var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(){var items=$filter("filter")($scope.items_data.items,{selected:true});var remove_arr=[];angular.forEach(items,function(item){ItemsService.remove({id:item.id})});$scope.$emit("removeSelected",items);spliceSelected()},function(){})};$scope.remove=function(item,fast){var $index=$scope.items_data.items.indexOf(item);var data=angular.copy($scope.messages.remove);angular.forEach(data,function(value,key){var exp=$interpolate(value);data[key]=exp(item)});var modalInstance=$modal.open({templateUrl:"/assets/js/core/views/confirm_modal.html",controller:"ModalInstanceController",resolve:{data:function(){return data}}});modalInstance.result.then(function(){ItemsService.remove({id:$scope.items_data.items[$index].id},function(){if(!fast){$scope.items_data.items.splice($index,1);$scope.items_data.total--;$scope.$emit("remove",item)}});if(fast){$scope.items_data.items.splice($index,1);$scope.items_data.total--;$scope.$emit("remove",item)}},function(){})}}]);angular.module("MailerliteCore").controller("ModalInstanceController",["$scope","$modalInstance","data",function($scope,$modalInstance,data){$scope.data=data;$scope.ok=function(){$modalInstance.close($scope.data)};$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);angular.module("MailerliteCore").controller("PreviewController",["$scope","$timeout",function($scope,$timeout){}]);angular.module("MailerliteCore").controller("RecipientsByCampaignFilter",["$scope","$q","ApiGroups","ApiTimezones","ApiCountries","ApiSegments","EmailsService","ApiAutoresponders",function($scope,$q,ApiGroups,ApiTimezones,ApiCountries,ApiSegments,EmailsService,ApiAutoresponders){"use strict";var promises=[];promises.push(ApiGroups.query().$promise);promises.push(ApiSegments.get().$promise);promises.push(ApiTimezones.get().$promise);promises.push(ApiCountries.get().$promise);promises.push(EmailsService.query({type:"sent",limit:50,page:1,order:"DESC",order_by:"mails.send"}).$promise);promises.push(ApiAutoresponders.getAutomations().$promise);$scope["Groups"]=[];$scope["Segments"]=[];$scope["Time zone"]=[];$scope["Location"]=[];$scope["Campaigns"]=[];$scope["Automation workflows"]=[];$q.all(promises).then(function(responses){$scope["Groups"]=responses[0];$scope["Segments"]=responses[1].data;$scope["Time zone"]=responses[2];$scope["Location"]=responses[3];$scope["Campaigns"]=responses[4].data.items;$scope["Automation workflows"]=responses[5]});if($scope.filter&&$scope.filter.conditionSets){$scope.filter.conditionSets=JSON.parse($scope.filter.conditionSets)}$scope.translateOperator=function(operator){switch(operator){case"email_equals":return"equals";case"email_not_equal":return"does not equal";case"email_contains":return"contains";case"email_not_contain":return"does not contain";case"name_equals":return"equals";case"name_not_equal":return"does not equal";case"name_contains":return"contains";case"name_not_contain":return"does not contain";case"name_set":return"is set";case"name_not_set":return"is not set";case"text_field_equals":return"equals";case"text_field_not_equal":return"does not equal";case"text_field_contains":return"contains";case"text_field_not_contain":return"does not contain";case"text_field_set":return"is set";case"text_field_not_set":return"is not set";case"numeric_field_less":return"is less than";case"numeric_field_less_or_equal":return"is less than or equal to";case"numeric_field_greater":return"is greater than";case"numeric_field_greater_or_equal":return"is greater than or equal to";case"numeric_field_equals":return"equals";case"numeric_field_not_equal":return"does not equal";case"numeric_field_set":return"is set";case"numeric_field_not_set":return"is not set";case"date_field_less":return"is before";case"date_field_less_or_equal":return"is on or before";case"date_field_greater":return"is after";case"date_field_greater_or_equal":return"is on or after";case"date_field_equals":return"is on";case"date_field_not_equal":return"is not on";case"date_field_set":return"is set";case"date_field_not_set":return"is not set";case"date_field_in_last":return"is in the last";case"date_field_after":return"is after";case"less":return"is less than";case"greater":return"is greater than";case"equals":return"equals";case"in_group":return"belongs to";case"out_of_group":return"does not belong to";case"in_all_groups":return"belongs to all";case"out_of_all_groups":return"does not belong to all";case"in_any_group":return"belongs to any";case"out_of_any_group":return"does not belong to any";case"no_groups":return"no groups";case"in_any_segment":return"belongs to";case"out_of_any_segment":return"does not belong to";case"in_all_segments":return"belongs to all";case"out_of_all_segments":return"does not belongs to all";case"signup_source_in":return"is";case"signup_source_not_in":return"is not";case"timezone_id_in":return"is";case"timezone_id_not_in":return"is not";case"timezone_id_set":return"is set";case"timezone_id_not_set":return"is not set";case"country_id_in":return"is";case"country_id_not_in":return"is not";case"country_id_set":return"is set";case"country_id_not_set":return"is not set";case"signup_before":return"is before";case"signup_after":return"is after";case"signup_in_last":return"is in the last";case"campaigns_sent":return"was sent";case"campaigns_not_sent":return"was not sent";case"campaigns_opened":return"was opened";case"campaigns_not_opened":return"was not opened";case"campaigns_clicked":return"was clicked";case"campaigns_not_clicked":return"was not clicked";case"automations_active":return"active in";case"automations_not_active":return"not active in";case"automations_completed":return"has completed";case"automations_not_completed":return"has not completed";case"automations_never_started":return"never active in";default:return operator}};$scope.joinArgsByType=function(originalArgs,conditionType){var translatedArgs=[];originalArgs.forEach(function(arg){if(arg==="*"&&conditionType==="Campaigns"){translatedArgs.push("Any campaign");return}else if(arg==="*"&&conditionType==="Automation workflows"){translatedArgs.push("Any automation");return}var argTranslate=$scope[conditionType].filter(function(filterItem){return filterItem.campaign_id?filterItem.campaign_id==arg:filterItem.id==arg});if(argTranslate.length>0){var result_translate=argTranslate[0].name||argTranslate[0].title||argTranslate[0].subject;if(conditionType==="Time zone"&&argTranslate[0].gmt){result_translate="("+argTranslate[0].gmt+") "+result_translate}translatedArgs.push(result_translate)}});return translatedArgs.join(", ")}}]);angular.module("MailerliteApp").controller("PreviewWindowController",["$scope","$timeout","$sce","ApiTemplates",function($scope,$timeout,$sce,ApiTemplates){$scope.previewTemplates=[];$scope.$watch("templates",function(newTemplates){if(newTemplates&&newTemplates.length){$scope.previewTemplates=[];if($scope.previewTemplates.length<4&&$scope.templates.length){$scope.previewTemplates=[].concat($scope.templates);while($scope.previewTemplates.length<4){for(var i=0;i<$scope.templates.length;i++){var t=$scope.templates[i];$scope.previewTemplates.push(angular.copy(t))}}}}});$scope.preview=function(template){changeMainTemplate(template);previewAnimation();$("body").css("overflow","hidden");$scope.showTemplatePreview=true};$scope.hide=function(){hideAnimation();$("body").css("overflow","auto");$scope.showTemplatePreview=false};$scope.prev=function(){prevAnimation();var prevTemplate=getPrevTemplate($scope.mainTemplate);changeMainTemplate(prevTemplate)};$scope.next=function(){nextAnimation();var nextTemplate=getNextTemplate($scope.mainTemplate);changeMainTemplate(nextTemplate)};function keymap(e){if($scope.showTemplatePreview){switch(e.keyCode){case 27:$scope.hide();break;case 37:$scope.prev();break;case 39:$scope.next();break}}}window.addEventListener("keydown",function(e){$timeout(function(){keymap(e)})},false);$scope.iframeLoaded=function(template){$timeout(function(){template.iframeLoaded=true;loadTemplateCallback(template)})};function loadTemplateIfNotLoaded(template){if(!isTemplateLoaded(template)){loadTemplate(template)}else{loadTemplateCallback(template)}}function isTemplateLoaded(template){return template.iframeSrc!==""}function loadTemplate(template){template.iframeLoaded=false;template.iframeSrc=template.previewUrl}function loadTemplateCallback(template){if(template.loadSideTemplates){var prevTemplate=getPrevTemplate(template);var nextTemplate=getNextTemplate(template);prevTemplate.loadSideTemplates=false;nextTemplate.loadSideTemplates=false;loadTemplateIfNotLoaded(prevTemplate);loadTemplateIfNotLoaded(nextTemplate)}}function getNextTemplate(template){var nextTemplateIndex=getNextTemplateIndex(template);return $scope.previewTemplates[nextTemplateIndex]}function getNextTemplateIndex(template){var templateIndex=$scope.previewTemplates.indexOf(template);var nextTemplateIndex=templateIndex+1;if(nextTemplateIndex==$scope.previewTemplates.length){nextTemplateIndex=0}return nextTemplateIndex}function getPrevTemplate(template){var prevTemplateIndex=getPrevTemplateIndex(template);return $scope.previewTemplates[prevTemplateIndex]}function getPrevTemplateIndex(template){var templateIndex=$scope.previewTemplates.indexOf(template);var prevTemplateIndex=templateIndex-1;if(prevTemplateIndex<0){prevTemplateIndex=$scope.previewTemplates.length-1}return prevTemplateIndex}function changeMainTemplate(template){template.loadSideTemplates=true;loadTemplateIfNotLoaded(template);$scope.mainTemplate=template}function prevAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var prevPrevTemplate=getPrevTemplate(prevTemplate);var nextTemplate=getNextTemplate(mainTemplate);prevPrevTemplate.cssClass="prev";prevTemplate.cssClass="main";mainTemplate.cssClass="next";nextTemplate.cssClass=""}function nextAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var nextTemplate=getNextTemplate(mainTemplate);var nextNextTemplate=getNextTemplate(nextTemplate);prevTemplate.cssClass="";mainTemplate.cssClass="prev";nextTemplate.cssClass="main";nextNextTemplate.cssClass="next"}function previewAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var nextTemplate=getNextTemplate(mainTemplate);prevTemplate.cssClass="prev";mainTemplate.cssClass="main";nextTemplate.cssClass="next"}function hideAnimation(){var mainTemplate=$scope.mainTemplate;var prevTemplate=getPrevTemplate(mainTemplate);var nextTemplate=getNextTemplate(mainTemplate);prevTemplate.cssClass="";mainTemplate.cssClass="";nextTemplate.cssClass=""}}]);angular.module("MailerliteCore").controller("UnsubscribeController",["$scope","$timeout","$window",function($scope,$timeout,$window){$scope.window=$window}]);angular.module("MailerliteApp").filter("capitalize",function(){return function(token){return token.charAt(0).toUpperCase()+token.slice(1)}});angular.module("MailerliteCore").filter("int",["$filter",function($filter){return function(input){return Math.round(input)}}]);angular.module("MailerliteCore").filter("nl2br",function($sce){return function(msg,is_xhtml){var is_xhtml=is_xhtml||true;var breakTag=is_xhtml?"<br />":"<br>";var msg=(msg+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2");return $sce.trustAsHtml(msg)}});angular.module("MailerliteCore").filter("percentage",["$filter",function($filter){return function(input,decimals){return $filter("number")(input*100,decimals)}}]);angular.module("MailerliteCore").filter("wrap",["$filter","$window",function($filter,$window){return function(input,length,separator){if(!length)length=100;if(angular.isUndefined(input)||input==null)return"";if($window.innerWidth<1e3)length=length*($window.innerWidth/1e3);if(input.length>length){if(!separator)separator="...";return $filter("limitTo")(input,length)+separator}else{return input}}}]);angular.module("MailerliteApp").filter("convert_currency",function(){return function(input,rate,symbol){input=input||"0";rate=rate||1;symbol=symbol||"";return symbol+Math.ceil(input*rate,2)}});angular.module("MailerliteCore").filter("emoji",[function(){return function(input){if(input){return emojione.toImage(input)}}}]);angular.module("MailerliteCore").directive("emojiToImg",[function(){return function(scope,element,attrs){$(element).html(emojione.toImage($(element).html()))}}]);
