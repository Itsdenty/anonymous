angular.module("productPickerApp",["ngResource","ngCookies"]).config(["$httpProvider",function(a){a.defaults.headers.common["X-MailerLite-Account"]=X_MAILER_ACCOUNT,a.defaults.headers.common["X-MailerLite-Token"]=X_MAILER_TOKEN}]).run(["$rootScope",function(a){a.translateCategory="productpicker"}]),angular.module("productPickerApp").controller("productpickerController",["$scope","$http","$cookies","$timeout","productPickerService","productPicker","productsResource",function(a,b,c,d,e,f,g){a.page=1,a.noMoreProducts=!1,a.loadMoreClicked=!1;var h=function(){var a=window.localStorage;return a||(a={getItem:function(a){return a&&this.hasOwnProperty(a)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(a){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[a])},setItem:function(a,b){a&&(document.cookie=escape(a)+"="+escape(b)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(a){a&&this.hasOwnProperty(a)&&(document.cookie=escape(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(a){return new RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},a.length=(document.cookie.match(/\=/g)||a).length),a}(),i=!1;if(a.deactivate=function(a,b){return!i&&(i=!0,e.deactivate(a,b),!0)},a.submit=function(){a.deactivate(a.selectedItems,a.data.shop)},a.shops=[],window.shopify_shops)for(var j=0;j<window.shopify_shops.length;j++)a.shops.push(window.shopify_shops[j]);if(window.woocommerce_shops)for(var k=0;k<window.woocommerce_shops.length;k++)a.shops.push(window.woocommerce_shops[k]);a.items=[],a.selectedItems=[],a.selectedItemsById={},a.loading=!0,a.data={},a.data.limit=3,a.data.shop=a.shops[0]||a.woo_commerce_shops||!1,a.$watch("data.shop",function(){h.setItem("mailerlite:productpicker:shopid",a.data.shop.id)});var l=h.getItem("mailerlite:productpicker:shopid")||!1;l&&a.shops.forEach(function(b){b.id==l&&(a.data.shop=b)}),a.refresh=function(c){a.loadMoreClicked=1==c,a.loading=!0,0!=c||a.data.shop.shopify_origin||(a.items=[],a.page=1),a.data.shop&&a.data.shop.id&&(a.data.shop.shopify_origin?b.get("/shopify/shop_products/"+a.data.shop.id,{params:{title:a.data.title}}).then(function(b){b&&b.data&&(a.items=b.data),a.loading=!1},function(){a.loading=!1}):(a.page+=c,g.getProducts({shop_id:a.data.shop.id,title:a.data.title,page:a.page},function(b){1==a.page&&(a.items=[]),b.length<100&&(a.noMoreProducts=!0),b.forEach(function(b){a.items.push(b)}),a.loading=!1,a.loadMoreClicked=!1})))};var m;a.$watch("data.title",function(){m&&(d.cancel(m),m=!1),m=d(function(){a.refresh(0)},300)});!function(b,c,d){b=b||3,c=c||[],a.data.limit=b,a.data.title="",a.selectedItems=[],a.selectedItemsById={},c.forEach(function(b){b.id&&(a.selectedItems.push(b),a.selectedItemsById[b.id]=b)}),d&&a.shops.forEach(function(b){b.id==d&&(a.data.shop=b)}),a.refresh(0)}(a.initLimit||3,a.initSelectedItems||[],a.initShopId||!1),a.checkItem=function(b){return 1==a.data.limit&&a.selectedItems.forEach(a.uncheckItem),!(a.selectedItems.length>=a.data.limit)&&(a.selectedItems.push(b),a.selectedItemsById[b.id]=b,!0)},a.uncheckItem=function(b){var c=a.selectedItems.indexOf(b);a.selectedItems.splice(c,1),delete a.selectedItemsById[b.id]}}]),angular.module("productPickerApp").directive("mlProductPicker",["$timeout","productPickerService",function(a,b){return{scope:{mlProductPicker:"=",mlProductPickerSuccess:"&"},link:function(a,c,d,e){$(c).on("click",function(){b.activate({initLimit:a.mlProductPicker.limit||3,initSelectedItems:a.mlProductPicker.selectedItems||[],initShopId:a.mlProductPicker.shopId||!1},function(b,c){b&&c&&a.mlProductPickerSuccess&&a.mlProductPickerSuccess({products:b,shop:c})})})}}}]),angular.module("productPickerApp").factory("productsResource",["$resource",function(a){return a(CLIENT_API_BASE_URL+"/master/images/:id",{id:"@id"},{update:{method:"PUT"},count:{method:"GET",url:CLIENT_API_BASE_URL+"/master/images/count"},remove:{method:"DELETE",headers:{"Content-Type":"application/json"},transformRequest:function(a,b){return b=angular.extend(b,{"Content-Type":"application/json"}),angular.toJson(a)}},getProducts:{isArray:!0,method:"GET",url:CLIENT_API_BASE_URL+"/v2/woocommerce/products/:shop_id/:page?title=:title",headers:{"X-MailerLite-Account":X_MAILER_ACCOUNT,"X-MailerLite-Token":X_MAILER_TOKEN}}})}]),angular.module("productPickerApp").provider("productPicker",function(){var a=this;return a.path="/assets/plugins/productpicker/views/",{setPath:function(b){a.path=b},$get:function(){return{path:a.path}}}}),angular.module("productPickerApp").factory("productPickerService",["$rootScope","$animate","$timeout","$q","$http","$document","$compile","$controller","$rootScope","productPicker",function(a,b,c,d,e,f,g,h,a,i){function j(c,d){return q=d,n.then(function(d){if(d=d.data,!o){if(o=angular.element(d),0===o.length)throw new Error("The template contains no elements; you need to wrap text nodes");m=a.$new(),c=c||{},m.initLimit=c.initLimit||3,m.initShopId=c.initShopId||!1,m.initSelectedItems=c.initSelectedItems||[],c.$scope=m;h("productpickerController",c);return o=g(d)(m),b.enter(o,p)}return!0})}function k(a,c){if(!o)return d.when();q&&q(a,c);var e=function(){m.$destroy(),m=null,o.remove(),o=null},f=b.leave(o,e);return f&&f.then&&f.then(e),!0}function l(){return!!o}var m,n,o,p=angular.element(document.body);n=e.get(i.path+"layout.html",{cache:!0});var q;return $(document).keyup(function(b){l()&&27==b.keyCode&&a.$apply(function(){k()})}),{activate:j,deactivate:k,active:l}}]);