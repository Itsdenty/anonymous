!function(t){function i(i,e){this.element=i,this.$el=t(i),this.settings=t.extend({},a,e),this.$container=t(this.settings.container),this.settings.width=parseInt(this.settings.width),this.settings.height=parseInt(this.settings.height),this.settings.width>=c?this.settings.width=c:this.settings.width<h&&(this.settings.width=h),this.settings.height>=l?this.settings.height=l:this.settings.height<d&&(this.settings.height=d);var s=["left","right"];-1==t.inArray(this.settings.position,s)&&(this.settings.position=a.position),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.init()}function e(){var i=[],e=[{name:"people",symbol:"grinning"},{name:"nature",symbol:"seedling"},{name:"food_and_drink",symbol:"tomato"},{name:"celebration",symbol:"ribbon"},{name:"activity",symbol:"runner"},{name:"travel_and_places",symbol:"train"},{name:"objects_and_symbols",symbol:"watch"}],s={};t.each(t.fn.emojiPicker.emojis,function(t,i){var e=i.category;s[e]=s[e]||[],s[e].push(i)}),i.push('<div class="emojiPicker">'),i.push("<nav>");for(var n in e)i.push('<div class="tab'+(0==n?" active":"")+'" data-tab="'+e[n].name+'"><div class="emoji emoji-'+e[n].symbol+'"></div></div>');i.push("</nav>");for(var n in e){i.push('<section class="'+e[n].name+(0==n?"":" hidden")+'">');for(var o in s[e[n].name]){var r=s[e[n].name][o];i.push('<div class="emoji emoji-'+r.shortcode+'"></div>')}i.push("</section>")}return i.push("</div>"),i.join("\n")}function s(i){for(var e=t.fn.emojiPicker.emojis,s=0;s<e.length;s++)if(e[s].shortcode==i)return e[s]}function n(i,e){if(t(i).is(":input"))if(document.selection){i.focus();var s=document.selection.createRange();s.text=e,i.focus()}else if(i.selectionStart||"0"==i.selectionStart){var n=i.selectionStart,o=i.selectionEnd,r=i.scrollTop;i.value=i.value.substring(0,n)+e+i.value.substring(o,i.value.length),i.focus(),i.selectionStart=n+e.length,i.selectionEnd=n+e.length,i.scrollTop=r}else i.focus(),i.value+=e;else{var a=t(i).data("lastCaretPosition"),h=replaceImgToAltAndRemoveHtml(i),c=h.substring(0,a)+e+h.substring(a,h.length);a+=e.length,t(i).data("lastCaretPosition",a),t(i).text(c),t(i).trigger("emoji.added"),t(i).trigger("emoji.track",e)}}function o(t){var i=t.split("-").map(function(t,i){return parseInt(t,16)});return String.fromCodePoint.apply(null,i)}var r="emojiPicker",a={width:"200",height:"350",position:"right",iconColor:"black",iconBackgroundColor:"#eee",container:"body",button:!0},h=200,c=600,d=100,l=350,g=50;t.extend(i.prototype,{init:function(){this.active=!1,this.addPickerIcon(),this.createPicker(),this.listen()},addPickerIcon:function(){if(this.settings.button){var i=this.$el.outerHeight(),e=i>g?g:i;this.$wrapper=this.$el.wrap("<div class='emojiPickerIconWrap'></div>").parent(),this.$icon=t('<div class="emojiPickerIcon"></div>').height(e).width(e).addClass(this.settings.iconColor).css("backgroundColor",this.settings.iconBackgroundColor),this.$wrapper.append(this.$icon)}},createPicker:function(){this.$picker=t(e()).appendTo(this.$container).width(this.settings.width).height(this.settings.height).css("z-index",1e4),this.$picker.find("section").height(parseInt(this.settings.height)-40),this.settings.width<240&&this.$picker.find(".emoji").css({width:"1em",height:"1em"})},listen:function(){this.settings.button&&this.$wrapper.find(".emojiPickerIcon").click(t.proxy(this.iconClicked,this)),this.$picker.find("section div").click(t.proxy(this.emojiClicked,this)),this.$picker.find("nav .tab").click(t.proxy(this.emojiCategoryClicked,this)),this.$picker.click(t.proxy(this.pickerClicked,this)),t(document.body).click(t.proxy(this.clickOutside,this)),t(window).resize(t.proxy(this.updatePosition,this))},updatePosition:function(){var t=this.$el.parent().find(".emojiPickerIcon"),i=this.$picker.offsetParent(),e=i.offset(),s=t.offset();"right"==this.settings.position&&(s.left+=t.outerWidth()-this.settings.width),s.top+=t.outerHeight();var n={top:s.top-e.top,left:s.left-e.top};return this.$picker.css({top:n.top,left:n.left}),this},hide:function(){this.$picker.hide(1,function(){this.active=!1}.bind(this))},show:function(){this.updatePosition(),this.$picker.show(1,function(){this.active=!0}.bind(this))},iconClicked:function(t){this.$picker.is(":hidden")?this.show():this.hide()},emojiClicked:function(i){var e=t(i.target).attr("class").split("emoji-")[1],r=o(s(e).unicode);n(this.element,r),t(this.element).trigger("keyup")},emojiCategoryClicked:function(i){var e="";this.$picker.find("nav .tab").removeClass("active"),t(i.target).parent().hasClass("tab")?(e=t(i.target).parent().attr("data-tab"),t(i.target).parent(".tab").addClass("active")):(e=t(i.target).attr("data-tab"),t(i.target).addClass("active")),this.$picker.find("section").addClass("hidden"),this.$picker.find("section."+e).removeClass("hidden")},pickerClicked:function(t){t.stopPropagation()},clickOutside:function(t){this.active&&this.hide()}}),t.fn[r]=function(e){return"string"==typeof e?(this.each(function(){var i=t.data(this,r);switch(e){case"toggle":i.iconClicked()}}),this):(this.each(function(){t.data(this,r)||t.data(this,r,new i(this,e))}),this)},String.fromCodePoint||(String.fromCodePoint=function(){var t,i,e,s,n=[];for(s=0;s<arguments.length;++s)t=arguments[s],i=t-65536,e=t>65535?[55296+(i>>10),56320+(1023&i)]:[t],n.push(String.fromCharCode.apply(null,e));return n.join("")})}(jQuery);